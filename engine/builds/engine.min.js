"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.emptyState=emptyState,exports.reduce=reduce,exports.replay=replay,exports.render=render,exports.parseAideHtml=parseAideHtml;const SCALAR_TYPES=new Set(["string","int","float","bool","date","datetime"]);function isNullable(e){return"string"==typeof e&&e.endsWith("?")}function baseType(e){return"string"==typeof e?e.replace(/\?$/,""):"object"==typeof e&&"enum"in e?"enum":"object"==typeof e&&"list"in e?"list":"unknown"}function isValidType(e){return"string"==typeof e?SCALAR_TYPES.has(e.replace(/\?$/,"")):"object"==typeof e&&"enum"in e?Array.isArray(e.enum)&&e.enum.length>0:"object"==typeof e&&"list"in e&&SCALAR_TYPES.has(e.list)}function validateValue(e,t){if(null==e)return isNullable(t);switch(baseType(t)){case"string":return"string"==typeof e;case"int":return"number"==typeof e&&Number.isInteger(e);case"float":return"number"==typeof e;case"bool":return"boolean"==typeof e;case"date":return"string"==typeof e&&/^\d{4}-\d{2}-\d{2}$/.test(e);case"datetime":return"string"==typeof e&&!isNaN(Date.parse(e));case"enum":return"object"==typeof t&&"enum"in t&&t.enum.includes(e);case"list":if(!Array.isArray(e))return!1;const n="object"==typeof t&&"list"in t?t.list:"string";return e.every(e=>validateValue(e,n));default:return!1}}function emptyState(){return{version:1,meta:{},collections:{},relationships:[],relationship_types:{},constraints:[],blocks:{block_root:{type:"root",children:[],props:{}}},views:{},styles:{},annotations:[]}}function ok(e,t=[]){return{snapshot:e,applied:!0,warnings:t,error:null}}function reject(e,t,n){return{snapshot:e,applied:!1,warnings:[],error:`${t}: ${n}`}}function warn(e,t){return{code:e,message:t}}function getColl(e,t){const n=e.collections[t];return!n||n._removed?[null,"COLLECTION_NOT_FOUND"]:[n,null]}function deepClone(e){return JSON.parse(JSON.stringify(e))}function reduce(e,t){const n=deepClone(e),{type:i,payload:r,sequence:o}=t,a=REDUCERS[i];return a?a(n,r,o??0,t):reject(n,"UNKNOWN_PRIMITIVE",`Unknown type: ${i}`)}function replay(e){let t=emptyState();for(const n of e){t=reduce(t,n).snapshot}return t}function checkConstraints(e,t,n){const i=[];for(const r of e.constraints)if("collection_max_entities"===r.rule&&"entity.create"===t){if(r.collection!==n)continue;const t=e.collections[r.collection];if(!t)continue;if(Object.values(t.entities).filter(e=>!e._removed).length>(r.value??1/0)){const e=r.strict?"STRICT_CONSTRAINT_VIOLATED":"CONSTRAINT_VIOLATED";i.push(warn(e,r.message||`Max ${r.value} entities exceeded`))}}else if("unique_field"===r.rule&&("entity.create"===t||"entity.update"===t)){if(r.collection!==n)continue;const t=e.collections[r.collection];if(!t||!r.field)continue;const o=Object.values(t.entities).filter(e=>!e._removed&&null!=e[r.field]).map(e=>String(e[r.field]));if(o.length!==new Set(o).size){const e=r.strict?"STRICT_CONSTRAINT_VIOLATED":"CONSTRAINT_VIOLATED";i.push(warn(e,r.message||`Duplicate values in ${r.field}`))}}return i}const entityCreate=(e,t,n)=>{const[i,r]=getColl(e,t.collection);if(r)return reject(e,r,t.collection);const o=t.id||`${t.collection}_${Object.keys(i.entities).length+1}`,a=i.entities[o];if(a&&!a._removed)return reject(e,"ENTITY_ALREADY_EXISTS",o);const s=t.fields||{},c=i.schema,l=[],d={};for(const[t,n]of Object.entries(c))if(t in s){if(!validateValue(s[t],n))return reject(e,"TYPE_MISMATCH",`${t}: expected ${JSON.stringify(n)}`);d[t]=s[t]}else{if(!isNullable(n))return reject(e,"REQUIRED_FIELD_MISSING",t);d[t]=null}for(const e of Object.keys(s))e in c||l.push(warn("UNKNOWN_FIELD_IGNORED",e));d._removed=!1,d._created_seq=n,i.entities[o]=d;const p=checkConstraints(e,"entity.create",t.collection);l.push(...p);const f=p.find(e=>"STRICT_CONSTRAINT_VIOLATED"===e.code);return f?(delete i.entities[o],reject(e,"STRICT_CONSTRAINT_VIOLATED",f.message)):ok(e,l)},entityUpdate=(e,t,n)=>{if(t.filter)return entityUpdateFilter(e,t,n);const i=(t.ref||"").split("/",2);if(2!==i.length)return reject(e,"ENTITY_NOT_FOUND",t.ref);const[r,o]=i,[a,s]=getColl(e,r);if(s)return reject(e,s,r);const c=a.entities[o];if(!c)return reject(e,"ENTITY_NOT_FOUND",o);if(c._removed)return reject(e,"ENTITY_NOT_FOUND",`${o} (removed)`);for(const[n,i]of Object.entries(t.fields||{})){const t=a.schema[n];if(t&&!validateValue(i,t))return reject(e,"TYPE_MISMATCH",`${n}: expected ${JSON.stringify(t)}`);c[n]=i}return c._updated_seq=n,ok(e)},entityUpdateFilter=(e,t,n)=>{const i=t.filter,[r,o]=getColl(e,i.collection);if(o)return reject(e,o,i.collection);const a=i.where||{},s=t.fields||{};let c=0;for(const t of Object.values(r.entities))if(!t._removed&&Object.entries(a).every(([e,n])=>t[e]===n)){for(const[n,i]of Object.entries(s)){const o=r.schema[n];if(o&&!validateValue(i,o))return reject(e,"TYPE_MISMATCH",`${n}: expected ${JSON.stringify(o)}`);t[n]=i}t._updated_seq=n,c++}return ok(e,[warn("ENTITIES_AFFECTED",`${c} entities updated`)])},entityRemove=(e,t,n)=>{const i=(t.ref||"").split("/",2);if(2!==i.length)return reject(e,"ENTITY_NOT_FOUND",t.ref);const[r,o]=i,[a,s]=getColl(e,r);if(s)return reject(e,s,r);const c=a.entities[o];return c?c._removed?ok(e,[warn("ALREADY_REMOVED",o)]):(c._removed=!0,c._removed_seq=n,e.relationships=e.relationships.filter(e=>e.from!==t.ref&&e.to!==t.ref),ok(e)):reject(e,"ENTITY_NOT_FOUND",o)},collectionCreate=(e,t,n)=>{const i=e.collections[t.id];if(i&&!i._removed)return reject(e,"COLLECTION_ALREADY_EXISTS",t.id);const r=t.schema||{};for(const[t,n]of Object.entries(r))if(!isValidType(n))return reject(e,"TYPE_MISMATCH",`Unknown type: ${JSON.stringify(n)}`);return e.collections[t.id]={id:t.id,name:t.name||t.id,schema:r,settings:t.settings||{},entities:{},_removed:!1,_created_seq:n},ok(e)},collectionUpdate=(e,t,n)=>{const[i,r]=getColl(e,t.id);if(r)return reject(e,r,t.id);if(void 0!==t.name&&(i.name=t.name),t.settings)for(const[e,n]of Object.entries(t.settings))null===n?delete i.settings[e]:i.settings[e]=n;return ok(e)},collectionRemove=(e,t,n)=>{const i=e.collections[t.id];if(!i)return reject(e,"COLLECTION_NOT_FOUND",t.id);if(i._removed)return ok(e,[warn("ALREADY_REMOVED",t.id)]);i._removed=!0;for(const e of Object.values(i.entities))e._removed=!0;for(const[n,i]of Object.entries(e.views))i.source===t.id&&delete e.views[n];return ok(e)},COMPAT_PAIRS=new Set(["string→int","string→float","string→bool","string→enum","string→date","int→string","int→float","int→bool","int→enum","float→string","float→int","float→enum","bool→string","bool→int","bool→enum","enum→string","enum→enum","date→string","date→date"]),CHECK_CONVERT=new Set(["string→int","string→float","string→bool","string→date","string→enum"]),fieldAdd=(e,t,n)=>{const[i,r]=getColl(e,t.collection);if(r)return reject(e,r,t.collection);if(t.name in i.schema)return reject(e,"FIELD_ALREADY_EXISTS",t.name);if(!isValidType(t.type))return reject(e,"TYPE_MISMATCH",`Unknown type: ${JSON.stringify(t.type)}`);const o=t.default??null,a=Object.values(i.entities).some(e=>!e._removed);if(!isNullable(t.type)&&null===o&&a)return reject(e,"REQUIRED_FIELD_NO_DEFAULT",t.name);i.schema[t.name]=t.type;for(const e of Object.values(i.entities))e[t.name]=o;return ok(e)},fieldUpdate=(e,t,n)=>{const[i,r]=getColl(e,t.collection);if(r)return reject(e,r,t.collection);if(!(t.name in i.schema))return reject(e,"FIELD_NOT_FOUND",t.name);const o=[];if(void 0!==t.type){const n=baseType(i.schema[t.name]),r=baseType(t.type);if(n!==r){if("list"===n||"list"===r)return reject(e,"INCOMPATIBLE_TYPE_CHANGE",`${n} → ${r}`);if(!COMPAT_PAIRS.has(`${n}→${r}`))return reject(e,"INCOMPATIBLE_TYPE_CHANGE",`${n} → ${r}`);if("float"===n&&"int"===r&&o.push(warn("LOSSY_TYPE_CONVERSION","float → int")),CHECK_CONVERT.has(`${n}→${r}`))for(const n of Object.values(i.entities)){if(n._removed)continue;const i=n[t.name];if(null!=i){if("int"===r&&("string"!=typeof i||isNaN(parseInt(i))))return reject(e,"INCOMPATIBLE_TYPE_CHANGE",`value '${i}' can't convert to int`);if("float"===r&&("string"!=typeof i||isNaN(parseFloat(i))))return reject(e,"INCOMPATIBLE_TYPE_CHANGE",`value '${i}' can't convert to float`);if("bool"===r&&!["true","false","0","1","True","False"].includes(String(i)))return reject(e,"INCOMPATIBLE_TYPE_CHANGE",`value '${i}' can't convert to bool`);if("date"===r&&!/^\d{4}-\d{2}-\d{2}$/.test(String(i)))return reject(e,"INCOMPATIBLE_TYPE_CHANGE",`value '${i}' can't convert to date`)}}if("enum"===r&&"object"==typeof t.type&&"enum"in t.type){const n=t.type.enum;for(const r of Object.values(i.entities)){if(r._removed)continue;const i=r[t.name];if(null!=i&&!n.includes(i))return reject(e,"INCOMPATIBLE_TYPE_CHANGE",`value '${i}' not in [${n}]`)}}}i.schema[t.name]=t.type}if(void 0!==t.rename){if(t.rename in i.schema)return reject(e,"FIELD_ALREADY_EXISTS",t.rename);i.schema[t.rename]=i.schema[t.name],delete i.schema[t.name];for(const e of Object.values(i.entities))t.name in e&&(e[t.rename]=e[t.name],delete e[t.name])}return ok(e,o)},fieldRemove=(e,t,n)=>{const[i,r]=getColl(e,t.collection);if(r)return reject(e,r,t.collection);if(!(t.name in i.schema))return reject(e,"FIELD_NOT_FOUND",t.name);delete i.schema[t.name];for(const e of Object.values(i.entities))delete e[t.name];const o=[];for(const n of Object.values(e.views)){const e=n.config;for(const i of["show_fields","hide_fields"])Array.isArray(e[i])&&e[i].includes(t.name)&&(e[i]=e[i].filter(e=>e!==t.name),o.push(warn("VIEW_FIELD_MISSING",`${n.id}.${i}`)));e.sort_by===t.name&&delete e.sort_by,e.group_by===t.name&&delete e.group_by}return ok(e,o)},relationshipSet=(e,t,n)=>{const{from:i,to:r,type:o}=t;for(const t of[i,r]){if(!t)continue;const n=t.split("/",2);if(2===n.length){const[i,r]=n,o=e.collections[i];if(!o||o._removed)return reject(e,"COLLECTION_NOT_FOUND",i);const a=o.entities[r];if(!a||a._removed)return reject(e,"ENTITY_NOT_FOUND",t)}}let a=t.cardinality||"many_to_one";return e.relationship_types[o]?a=e.relationship_types[o].cardinality:e.relationship_types[o]={cardinality:a},"many_to_one"===a?e.relationships=e.relationships.filter(e=>!(e.from===i&&e.type===o)):"one_to_one"===a&&(e.relationships=e.relationships.filter(e=>!(e.from===i&&e.type===o||e.to===r&&e.type===o))),e.relationships.push({from:i,to:r,type:o,data:t.data||{},_seq:n}),ok(e)},relationshipConstrain=(e,t,n)=>(e.constraints.push({id:t.id,rule:t.rule,entities:t.entities||[],relationship_type:t.relationship_type,value:t.value,message:t.message||"",strict:t.strict??!1}),ok(e)),blockSet=(e,t,n)=>{const i=t.id;if(i in e.blocks){const n=e.blocks[i];if(t.props&&Object.assign(n.props,t.props),void 0!==t.parent){for(const t of Object.values(e.blocks)){const e=t.children.indexOf(i);-1!==e&&t.children.splice(e,1)}const n=e.blocks[t.parent];n&&(null!=t.position?n.children.splice(t.position,0,i):n.children.push(i))}}else{if(!t.type)return reject(e,"BLOCK_TYPE_MISSING",i);const n=t.parent||"block_root",r=e.blocks[n];if(!r)return reject(e,"BLOCK_NOT_FOUND",n);e.blocks[i]={type:t.type,children:[],props:t.props||{}},null!=t.position?r.children.splice(t.position,0,i):r.children.push(i)}return ok(e)},blockRemove=(e,t,n)=>{const i=t.id;if("block_root"===i)return reject(e,"CANT_REMOVE_ROOT","");if(!(i in e.blocks))return reject(e,"BLOCK_NOT_FOUND",i);const r=t=>[t,...(e.blocks[t]?.children||[]).flatMap(r)],o=r(i);for(const t of Object.values(e.blocks)){const e=t.children.indexOf(i);-1!==e&&t.children.splice(e,1)}for(const t of o)delete e.blocks[t];return ok(e)},blockReorder=(e,t,n)=>{const i=e.blocks[t.parent];if(!i)return reject(e,"BLOCK_NOT_FOUND",t.parent);const r=t.children||[],o=i.children,a=o.filter(e=>!r.includes(e));return i.children=[...r.filter(e=>o.includes(e)),...a],ok(e)},viewCreate=(e,t,n)=>{if(t.id in e.views)return reject(e,"VIEW_ALREADY_EXISTS",t.id);const[,i]=getColl(e,t.source);return i?reject(e,i,t.source):(e.views[t.id]={id:t.id,type:t.type||"table",source:t.source,config:t.config||{}},ok(e))},viewUpdate=(e,t,n)=>{const i=e.views[t.id];return i?(void 0!==t.type&&(i.type=t.type),t.config&&Object.assign(i.config,t.config),ok(e)):reject(e,"VIEW_NOT_FOUND",t.id)},viewRemove=(e,t,n)=>t.id in e.views?(delete e.views[t.id],ok(e)):reject(e,"VIEW_NOT_FOUND",t.id),styleSet=(e,t,n)=>{for(const[n,i]of Object.entries(t))null===i?delete e.styles[n]:e.styles[n]=i;return ok(e)},styleSetEntity=(e,t,n)=>{const i=(t.ref||"").split("/",2);if(2!==i.length)return reject(e,"ENTITY_NOT_FOUND",t.ref);const[r,o]=i,[a,s]=getColl(e,r);if(s)return reject(e,s,r);const c=a.entities[o];return!c||c._removed?reject(e,"ENTITY_NOT_FOUND",t.ref):(c._styles={...c._styles||{},...t.styles||{}},ok(e))},metaUpdate=(e,t,n)=>(Object.assign(e.meta,t),ok(e)),metaAnnotate=(e,t,n,i)=>(e.annotations.push({note:t.note||"",pinned:t.pinned??!1,seq:n,timestamp:i.timestamp||""}),ok(e)),metaConstrain=(e,t,n)=>{const i=e.constraints.findIndex(e=>e.id===t.id);return i>=0?e.constraints[i]=t:e.constraints.push(t),ok(e)},REDUCERS={"entity.create":entityCreate,"entity.update":entityUpdate,"entity.remove":entityRemove,"collection.create":collectionCreate,"collection.update":collectionUpdate,"collection.remove":collectionRemove,"field.add":fieldAdd,"field.update":fieldUpdate,"field.remove":fieldRemove,"relationship.set":relationshipSet,"relationship.constrain":relationshipConstrain,"block.set":blockSet,"block.remove":blockRemove,"block.reorder":blockReorder,"view.create":viewCreate,"view.update":viewUpdate,"view.remove":viewRemove,"style.set":styleSet,"style.set_entity":styleSetEntity,"meta.update":metaUpdate,"meta.annotate":metaAnnotate,"meta.constrain":metaConstrain};function esc(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;")}function inline(e){let t=esc(e);return t=t.replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>"),t=t.replace(/\*(.+?)\*/g,"<em>$1</em>"),t=t.replace(/\[(.+?)\]\((https?:\/\/[^\)]+)\)/g,'<a href="$2">$1</a>'),t}function displayName(e){return e.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())}function fmtValue(e,t){if(null==e)return'<span class="aide-null">&mdash;</span>';const n=baseType(t);if("bool"===n)return e?"&#10003;":"&#9675;";if("date"===n&&"string"==typeof e){const t=new Date(e+"T00:00:00Z");if(!isNaN(t.getTime()))return esc(t.toLocaleDateString("en-US",{month:"short",day:"numeric",timeZone:"UTC"}))}if("datetime"===n&&"string"==typeof e){const t=new Date(e);if(!isNaN(t.getTime()))return esc(t.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit",timeZone:"UTC"}))}return"enum"===n?esc(String(e).replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())):"list"===n&&Array.isArray(e)?esc(e.join(", ")):esc("int"===n&&"number"==typeof e?e.toLocaleString("en-US"):"float"===n&&"number"==typeof e?e.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}):String(e))}function deriveDesc(e){const t=e.blocks.block_root;for(const n of t?.children||[]){const t=e.blocks[n];if("text"===t?.type)return(t.props.content||"").slice(0,160)}for(const t of Object.values(e.collections)){if(t._removed)continue;const e=Object.values(t.entities).filter(e=>!e._removed).length;return`${t.name||t.id}: ${e} items`}return e.meta.title||"A living page"}function applySort(e,t){const n=t.sort_by;if(!n)return e;const i="desc"===t.sort_order;return[...e].sort((e,t)=>{const r=e[n],o=t[n],a=null==r?1:0,s=null==o?1:0;return a!==s?a-s:r<o?i?1:-1:r>o?i?-1:1:0})}function applyFilter(e,t){const n=t.filter;return n?e.filter(e=>Object.entries(n).every(([t,n])=>e[t]===n)):e}function renderBlock(e,t){const n=t.blocks[e];if(!n)return"";const{type:i,props:r}=n;let o="";switch(i){case"root":break;case"heading":{const e=r.level||1;o=`    <h${e} class="aide-heading aide-heading--${e}">${inline(r.content||"")}</h${e}>\n`;break}case"text":o=`    <p class="aide-text">${inline(r.content||"")}</p>\n`;break;case"metric":o=`    <div class="aide-metric"><span class="aide-metric__label">${esc(r.label||"")}</span><span class="aide-metric__value">${esc(r.value||"")}</span></div>\n`;break;case"divider":o='    <hr class="aide-divider">\n';break;case"callout":o=`    <div class="aide-callout">${inline(r.content||"")}</div>\n`;break;case"image":{const e=r.caption?`<figcaption class="aide-image__caption">${esc(r.caption)}</figcaption>`:"";o=`    <figure class="aide-image"><img src="${esc(r.src||"")}" alt="${esc(r.alt||"")}" loading="lazy">${e}</figure>\n`;break}case"collection_view":o=renderCollectionView(r,t);break;case"column_list":o='    <div class="aide-columns">\n';break;case"column":{const e=r.width;o=`    <div class="aide-column"${e?` style="flex:0 0 ${e}"`:""}>\n`;break}}const a=n.children.map(e=>renderBlock(e,t)).join("");return"column_list"===i||"column"===i?o+a+"    </div>\n":o+a}function renderCollectionView(e,t){const n=e.view_id||e.view,i=t.views[n];if(!i)return"";const r=i.source||e.source,o=t.collections[r];if(!o||o._removed)return"";let a=Object.values(o.entities).filter(e=>!e._removed);const s=i.config||{};a=applySort(a,s),a=applyFilter(a,s);const c=s.show_fields||Object.keys(o.schema).filter(e=>!e.startsWith("_"));return"list"===i.type?renderList(a,o.schema,c):renderTable(a,o.schema,c)}function renderTable(e,t,n){if(!e.length&&!n.length)return'    <p class="aide-collection-empty">No items yet.</p>\n';return`    <div class="aide-table-wrap"><table class="aide-table"><thead><tr>${n.map(e=>`<th>${esc(displayName(e))}</th>`).join("")}</tr></thead><tbody>${e.map(e=>`<tr>${n.map(n=>`<td class="aide-table__td--${baseType(t[n]||"string")}">${fmtValue(e[n],t[n]||"string")}</td>`).join("")}</tr>`).join("")}</tbody></table></div>\n`}function renderList(e,t,n){if(!e.length)return'    <p class="aide-collection-empty">No items yet.</p>\n';return`    <ul class="aide-list">${e.map(e=>`<li class="aide-list__item">${n.map(n=>`<span class="aide-list__field">${fmtValue(e[n],t[n]||"string")}</span>`).join("")}</li>`).join("")}</ul>\n`}function renderAnnotations(e){if(!e.annotations.length)return"";return`    <section class="aide-annotations"><h3 class="aide-heading aide-heading--3">Notes</h3>${[...e.annotations.filter(e=>e.pinned),...e.annotations.filter(e=>!e.pinned).reverse()].map(e=>{const t=(e.timestamp||"").slice(0,10);return`<div class="aide-annotation${e.pinned?" aide-annotation--pinned":""}"><span class="aide-annotation__text">${esc(e.note)}</span><span class="aide-annotation__meta">${t}</span></div>`}).join("")}</section>\n`}function render(e,t,n=[],i={}){const r=esc(e.meta.title||"AIde"),o=esc(deriveDesc(e)),a=void 0!==i.footer?i.footer:"Made with AIde",s=JSON.stringify(t,null,2),c=JSON.stringify(e,null,2),l=JSON.stringify(n,null,2),d=renderBlock("block_root",e),p=renderAnnotations(e),f=(new Date).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),u=a?`    <footer class="aide-footer">\n      <a href="https://toaide.com" class="aide-footer__link">${esc(a)}</a>\n      <span class="aide-footer__sep">&middot;</span>\n      <span>Updated ${f}</span>\n    </footer>`:"";return`<!DOCTYPE html>\n<html lang="en">\n<head>\n  <meta charset="utf-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1">\n  <title>${r}</title>\n  <meta property="og:title" content="${r}">\n  <meta property="og:type" content="website">\n  <meta property="og:description" content="${o}">\n  <meta name="description" content="${o}">\n  <script type="application/aide-blueprint+json" id="aide-blueprint">\n${s}\n  <\/script>\n  <script type="application/aide+json" id="aide-state">\n${c}\n  <\/script>\n  <script type="application/aide-events+json" id="aide-events">\n${l}\n  <\/script>\n  <link rel="preconnect" href="https://fonts.googleapis.com">\n  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>\n  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,500;0,600;1,400&family=IBM+Plex+Sans:wght@300;400;500&display=swap" rel="stylesheet">\n  <style>${CSS}</style>\n</head>\n<body>\n  <main class="aide-page">\n${d}${p}${u}\n  </main>\n</body>\n</html>`}function parseAideHtml(e){const t=t=>{const n=new RegExp(`<script type="${t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}"[^>]*>([\\s\\S]*?)<\/script>`),i=e.match(n);return i?JSON.parse(i[1]):null};return{blueprint:t("application/aide-blueprint+json")||{},snapshot:t("application/aide+json")||emptyState(),events:t("application/aide-events+json")||[]}}const CSS="*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}\n:root{--font-serif:'Cormorant Garamond',Georgia,serif;--font-sans:'IBM Plex Sans',-apple-system,sans-serif;--text-primary:#2d3748;--text-secondary:#4a5568;--text-tertiary:#a0aec0;--text-slate:#4a5568;--bg-primary:#fafaf9;--bg-cream:#faf5ef;--border:#e2e8f0;--border-light:#edf2f7;--accent-steel:#4a6fa5;--accent-navy:#2c5282;--accent-forest:#48bb78;--radius-sm:4px;--space-1:4px;--space-2:8px;--space-3:12px;--space-4:16px;--space-5:20px;--space-6:24px;--space-8:32px;--space-10:40px;--space-12:48px;--space-16:64px}\nbody{font-family:var(--font-sans);font-size:16px;font-weight:300;line-height:1.65;color:var(--text-primary);background:var(--bg-primary);-webkit-font-smoothing:antialiased}\n.aide-page{max-width:720px;margin:0 auto;padding:var(--space-12) var(--space-8)}\n@media(max-width:640px){.aide-page{padding:var(--space-8) var(--space-5)}}\n.aide-heading{margin-bottom:var(--space-4)}\n.aide-heading--1{font-family:var(--font-serif);font-size:clamp(32px,4.5vw,42px);font-weight:400;line-height:1.2}\n.aide-heading--2{font-family:var(--font-serif);font-size:clamp(24px,3.5vw,32px);font-weight:400;line-height:1.25;margin-top:var(--space-8)}\n.aide-heading--3{font-family:var(--font-sans);font-size:18px;font-weight:500;line-height:1.4}\n.aide-text{font-size:16px;font-weight:300;line-height:1.65;color:var(--text-secondary);margin-bottom:var(--space-4)}\n.aide-text strong{font-weight:500;color:var(--text-primary)}\n.aide-text a{color:var(--accent-steel);text-decoration:underline;text-decoration-color:var(--border);text-underline-offset:2px}\n.aide-text a:hover{text-decoration-color:var(--accent-steel)}\n.aide-metric{display:flex;align-items:baseline;gap:var(--space-2);padding:var(--space-3) 0}\n.aide-metric__label{font-size:15px;font-weight:400;color:var(--text-secondary)}\n.aide-metric__label::after{content:':'}\n.aide-metric__value{font-size:15px;font-weight:500;color:var(--text-primary)}\n.aide-divider{border:none;border-top:1px solid var(--border-light);margin:var(--space-6) 0}\n.aide-callout{background:var(--bg-cream);border-left:3px solid var(--border);padding:var(--space-4) var(--space-5);margin:var(--space-4) 0;border-radius:0 var(--radius-sm) var(--radius-sm) 0;font-size:15px;line-height:1.55;color:var(--text-slate)}\n.aide-image{margin:var(--space-6) 0}\n.aide-image img{max-width:100%;height:auto;border-radius:var(--radius-sm)}\n.aide-image__caption{font-size:13px;color:var(--text-tertiary);margin-top:var(--space-2)}\n.aide-columns{display:flex;gap:var(--space-6)}\n@media(max-width:640px){.aide-columns{flex-direction:column}}\n.aide-column{flex:1}\n.aide-table-wrap{overflow-x:auto;margin:var(--space-4) 0}\n.aide-table{width:100%;border-collapse:collapse;font-size:15px}\n.aide-table th{font-size:11px;font-weight:500;letter-spacing:.08em;text-transform:uppercase;color:var(--text-tertiary);text-align:left;padding:var(--space-2) var(--space-3);border-bottom:2px solid var(--border)}\n.aide-table td{padding:var(--space-3);border-bottom:1px solid var(--border-light);color:var(--text-slate);vertical-align:top}\n.aide-table tr:last-child td{border-bottom:none}\n.aide-table__td--int,.aide-table__td--float{text-align:right;font-variant-numeric:tabular-nums}\n.aide-table__td--bool{text-align:center}\n.aide-list{list-style:none;padding:0}\n.aide-list__item{display:flex;align-items:baseline;gap:var(--space-3);padding:var(--space-3) 0;border-bottom:1px solid var(--border-light);font-size:15px;line-height:1.5}\n.aide-list__item:last-child{border-bottom:none}\n.aide-list__field{color:var(--text-secondary)}\n.aide-null{color:var(--text-tertiary);font-style:italic}\n.aide-collection-empty{color:var(--text-tertiary);font-size:15px;padding:var(--space-8) 0;text-align:center}\n.aide-annotations{margin-top:var(--space-10)}\n.aide-annotation{padding:var(--space-3) 0;border-bottom:1px solid var(--border-light)}\n.aide-annotation:last-child{border-bottom:none}\n.aide-annotation__text{font-size:15px;color:var(--text-slate);line-height:1.5}\n.aide-annotation__meta{font-size:12px;color:var(--text-tertiary);margin-left:var(--space-3)}\n.aide-annotation--pinned{border-left:3px solid var(--accent-navy);padding-left:var(--space-4)}\n.aide-highlight{background-color:rgba(31,42,68,.04)}\n.aide-group{margin-bottom:var(--space-6)}\n.aide-group__header{font-size:11px;font-weight:500;letter-spacing:.1em;text-transform:uppercase;color:var(--text-tertiary);margin-bottom:var(--space-3);padding-bottom:var(--space-2);border-bottom:1px solid var(--border-light)}\n.aide-footer{margin-top:var(--space-16);padding-top:var(--space-6);border-top:1px solid var(--border-light);font-size:12px;color:var(--text-tertiary);text-align:center}\n.aide-footer a{color:var(--text-tertiary);text-decoration:none}\n.aide-footer a:hover{color:var(--text-secondary)}\n.aide-footer .aide-footer__sep{margin:0 var(--space-2)}";