{
  "id": "chessboard",
  "name": "Chessboard",
  "description": "Track a chess game with board state, pieces, and move history",
  "complexity": "advanced",
  "primitives_exercised": [
    "schema.create",
    "entity.create",
    "entity.update",
    "block.set",
    "style.set_entity",
    "meta.update",
    "meta.annotate"
  ],
  "notes": "Uses _shape: [8, 8] with r_c keys. file_labels (a-h) for columns, rank_labels (1-8) for rows. e4 = file e (col 4), rank 4 (row 3) = key 3_4.",
  "turns": [
    {
      "turn": 1,
      "user_message": "Let's play chess! Set up the board.",
      "expected_schemas": [
        {
          "type": "schema.create",
          "payload": {
            "id": "ChessGame",
            "interface": "interface ChessGame { white_player: string; black_player: string; status: \"in_progress\" | \"white_wins\" | \"black_wins\" | \"draw\"; current_turn: \"white\" | \"black\"; file_labels: string[]; rank_labels: string[]; squares: Record<string, Square>; moves: Record<string, Move>; }",
            "render_html": "<div class=\"chess-game\"><div class=\"players\">{{white_player}} vs {{black_player}}</div><div class=\"status\">{{status}} - {{current_turn}}'s turn</div></div>",
            "render_text": "{{white_player}} (White) vs {{black_player}} (Black)\nStatus: {{status}} | Turn: {{current_turn}}"
          }
        },
        {
          "type": "schema.create",
          "payload": {
            "id": "Square",
            "interface": "interface Square { piece: string | null; color: \"light\" | \"dark\"; }",
            "render_html": "<div class=\"square {{color}}\">{{#piece}}<span class=\"piece\">{{piece}}</span>{{/piece}}</div>",
            "render_text": "{{#piece}}{{piece}}{{/piece}}{{^piece}}.{{/piece}}"
          }
        },
        {
          "type": "schema.create",
          "payload": {
            "id": "Move",
            "interface": "interface Move { notation: string; from: string; to: string; piece: string; captured: string | null; }",
            "render_html": "<span class=\"move\">{{notation}}</span>",
            "render_text": "{{notation}}"
          }
        }
      ],
      "expected_entities": [
        {
          "type": "entity.create",
          "payload": {
            "id": "chess_game",
            "_schema": "ChessGame",
            "white_player": "Player 1",
            "black_player": "Player 2",
            "status": "in_progress",
            "current_turn": "white",
            "file_labels": ["a", "b", "c", "d", "e", "f", "g", "h"],
            "rank_labels": ["1", "2", "3", "4", "5", "6", "7", "8"],
            "squares": {
              "_shape": [8, 8],
              "0_0": { "piece": "♖", "color": "light" },
              "0_1": { "piece": "♘", "color": "dark" },
              "0_2": { "piece": "♗", "color": "light" },
              "0_3": { "piece": "♕", "color": "dark" },
              "0_4": { "piece": "♔", "color": "light" },
              "0_5": { "piece": "♗", "color": "dark" },
              "0_6": { "piece": "♘", "color": "light" },
              "0_7": { "piece": "♖", "color": "dark" },
              "1_0": { "piece": "♙", "color": "dark" },
              "1_1": { "piece": "♙", "color": "light" },
              "1_2": { "piece": "♙", "color": "dark" },
              "1_3": { "piece": "♙", "color": "light" },
              "1_4": { "piece": "♙", "color": "dark" },
              "1_5": { "piece": "♙", "color": "light" },
              "1_6": { "piece": "♙", "color": "dark" },
              "1_7": { "piece": "♙", "color": "light" },
              "6_0": { "piece": "♟", "color": "light" },
              "6_1": { "piece": "♟", "color": "dark" },
              "6_2": { "piece": "♟", "color": "light" },
              "6_3": { "piece": "♟", "color": "dark" },
              "6_4": { "piece": "♟", "color": "light" },
              "6_5": { "piece": "♟", "color": "dark" },
              "6_6": { "piece": "♟", "color": "light" },
              "6_7": { "piece": "♟", "color": "dark" },
              "7_0": { "piece": "♜", "color": "dark" },
              "7_1": { "piece": "♞", "color": "light" },
              "7_2": { "piece": "♝", "color": "dark" },
              "7_3": { "piece": "♛", "color": "light" },
              "7_4": { "piece": "♚", "color": "dark" },
              "7_5": { "piece": "♝", "color": "light" },
              "7_6": { "piece": "♞", "color": "dark" },
              "7_7": { "piece": "♜", "color": "light" }
            },
            "moves": {}
          },
          "notes": "Standard chess labels: files a-h (cols 0-7), ranks 1-8 (rows 0-7). a1=0_0, e4=3_4, h8=7_7."
        }
      ],
      "expected_blocks": [
        {
          "type": "block.set",
          "payload": {
            "id": "block_header",
            "type": "heading",
            "parent": "block_root",
            "position": 1.0,
            "props": { "level": 1, "content": "Chess Game" }
          }
        },
        {
          "type": "block.set",
          "payload": {
            "id": "block_board",
            "type": "entity_view",
            "parent": "block_root",
            "position": 2.0,
            "props": { "source": "chess_game/squares" }
          }
        },
        {
          "type": "block.set",
          "payload": {
            "id": "block_moves_header",
            "type": "heading",
            "parent": "block_root",
            "position": 3.0,
            "props": { "level": 2, "content": "Move History" }
          }
        },
        {
          "type": "block.set",
          "payload": {
            "id": "block_moves",
            "type": "entity_view",
            "parent": "block_root",
            "position": 4.0,
            "props": { "source": "chess_game/moves" }
          }
        }
      ],
      "expected_meta": [
        {
          "type": "meta.update",
          "payload": {
            "title": "Chess Game",
            "identity": "Interactive chess game tracker"
          }
        }
      ]
    },
    {
      "turn": 2,
      "user_message": "e4",
      "notes": "e4: file e (col 4), rank 4 (row 3). Pawn moves from e2 (1_4) to e4 (3_4).",
      "expected_entities": [
        {
          "type": "entity.update",
          "payload": {
            "id": "chess_game",
            "current_turn": "black",
            "squares": {
              "1_4": { "piece": null },
              "3_4": { "piece": "♙", "color": "light" }
            },
            "moves": {
              "move_1": {
                "notation": "e4",
                "from": "e2",
                "to": "e4",
                "piece": "♙",
                "captured": null,
                "_pos": 1.0
              }
            }
          }
        }
      ]
    },
    {
      "turn": 3,
      "user_message": "e5",
      "notes": "e5: file e (col 4), rank 5 (row 4). Black pawn moves from e7 (6_4) to e5 (4_4).",
      "expected_entities": [
        {
          "type": "entity.update",
          "payload": {
            "id": "chess_game",
            "current_turn": "white",
            "squares": {
              "6_4": { "piece": null },
              "4_4": { "piece": "♟", "color": "light" }
            },
            "moves": {
              "move_2": {
                "notation": "e5",
                "from": "e7",
                "to": "e5",
                "piece": "♟",
                "captured": null,
                "_pos": 2.0
              }
            }
          }
        }
      ]
    },
    {
      "turn": 4,
      "user_message": "Nf3",
      "notes": "Nf3: Knight to f3. From g1 (0_6) to f3 (2_5).",
      "expected_entities": [
        {
          "type": "entity.update",
          "payload": {
            "id": "chess_game",
            "current_turn": "black",
            "squares": {
              "0_6": { "piece": null },
              "2_5": { "piece": "♘", "color": "dark" }
            },
            "moves": {
              "move_3": {
                "notation": "Nf3",
                "from": "g1",
                "to": "f3",
                "piece": "♘",
                "captured": null,
                "_pos": 3.0
              }
            }
          }
        }
      ]
    },
    {
      "turn": 5,
      "user_message": "Nc6",
      "notes": "Nc6: Black knight to c6. From b8 (7_1) to c6 (5_2).",
      "expected_entities": [
        {
          "type": "entity.update",
          "payload": {
            "id": "chess_game",
            "current_turn": "white",
            "squares": {
              "7_1": { "piece": null },
              "5_2": { "piece": "♞", "color": "light" }
            },
            "moves": {
              "move_4": {
                "notation": "Nc6",
                "from": "b8",
                "to": "c6",
                "piece": "♞",
                "captured": null,
                "_pos": 4.0
              }
            }
          }
        }
      ]
    },
    {
      "turn": 6,
      "user_message": "Bb5 - the Ruy Lopez!",
      "notes": "Bb5: Bishop to b5. From f1 (0_5) to b5 (4_1).",
      "expected_entities": [
        {
          "type": "entity.update",
          "payload": {
            "id": "chess_game",
            "current_turn": "black",
            "squares": {
              "0_5": { "piece": null },
              "4_1": { "piece": "♗", "color": "dark" }
            },
            "moves": {
              "move_5": {
                "notation": "Bb5",
                "from": "f1",
                "to": "b5",
                "piece": "♗",
                "captured": null,
                "_pos": 5.0
              }
            }
          }
        }
      ],
      "expected_meta": [
        {
          "type": "meta.annotate",
          "payload": {
            "note": "Ruy Lopez opening (Spanish Game)",
            "pinned": false
          }
        }
      ]
    },
    {
      "turn": 7,
      "user_message": "I'm playing as white, my friend Bob is black",
      "expected_entities": [
        {
          "type": "entity.update",
          "payload": {
            "id": "chess_game",
            "white_player": "Me",
            "black_player": "Bob"
          }
        }
      ]
    },
    {
      "turn": 8,
      "user_message": "Highlight the last move",
      "expected_styles": [
        {
          "type": "style.set_entity",
          "payload": {
            "id": "chess_game/squares/4_1",
            "styles": {
              "highlight": true,
              "bg_color": "#bbf7d0"
            }
          }
        },
        {
          "type": "style.set_entity",
          "payload": {
            "id": "chess_game/squares/0_5",
            "styles": {
              "highlight": true,
              "bg_color": "#fef3c7"
            }
          }
        }
      ]
    },
    {
      "turn": 9,
      "type": "query",
      "user_message": "Whose turn is it?",
      "expected_primitives": [],
      "expected_response": {
        "type": "text",
        "content": "It's Black's turn (Bob). The position after 5 moves is the Ruy Lopez opening.",
        "notes": "Simple query about game state."
      }
    },
    {
      "turn": 10,
      "type": "query",
      "user_message": "What moves have been played?",
      "expected_primitives": [],
      "expected_response": {
        "type": "text",
        "content": "1. e4 e5\n2. Nf3 Nc6\n3. Bb5\n\nThis is the Ruy Lopez (Spanish Game) opening.",
        "notes": "Query uses algebraic notation labels."
      }
    },
    {
      "turn": 11,
      "type": "query",
      "user_message": "What piece is on b5?",
      "expected_primitives": [],
      "expected_response": {
        "type": "text",
        "content": "White's bishop (♗) is on b5.",
        "notes": "Query about specific square using algebraic notation."
      }
    },
    {
      "turn": 12,
      "type": "error",
      "user_message": "e4",
      "expected_primitives": [],
      "expected_response": {
        "type": "clarification",
        "content": "e4 is already occupied by a white pawn. It's Black's turn - did you mean a different move for Black?",
        "notes": "Error: invalid move (square occupied, wrong turn)."
      }
    },
    {
      "turn": 13,
      "type": "error",
      "user_message": "Kh4",
      "expected_primitives": [],
      "expected_response": {
        "type": "clarification",
        "content": "The king on e8 cannot move to h4 - that's not a legal king move. Did you mean a different piece or square?",
        "notes": "Error: illegal move. Kings can only move one square."
      }
    },
    {
      "turn": 14,
      "type": "error",
      "user_message": "Move the rook",
      "expected_primitives": [],
      "expected_response": {
        "type": "clarification",
        "content": "Which rook and where? Black has rooks on a8 and h8. Please specify the move in algebraic notation (e.g., Ra6, Rh6) or describe the destination square.",
        "notes": "Error: ambiguous move instruction."
      }
    }
  ],
  "final_state_assertions": {
    "move_count": 5,
    "white_pieces_captured": 0,
    "black_pieces_captured": 0,
    "opening": "Ruy Lopez"
  }
}
