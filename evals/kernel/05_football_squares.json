{
  "id": "football_squares",
  "name": "Football Squares",
  "description": "Super Bowl squares betting pool with 10x10 grid, claims, and payouts",
  "complexity": "advanced",
  "primitives_exercised": [
    "schema.create",
    "entity.create",
    "entity.update",
    "block.set",
    "style.set_entity",
    "meta.update",
    "meta.constrain"
  ],
  "notes": "Uses _shape: [10, 10] with r_c keys. Adds row_labels/col_labels for user-friendly addressing (Q-A instead of 0_0).",
  "turns": [
    {
      "turn": 1,
      "user_message": "Setting up Super Bowl squares! Chiefs vs Eagles. $10 per square.",
      "expected_schemas": [
        {
          "type": "schema.create",
          "payload": {
            "id": "SquaresPool",
            "interface": "interface SquaresPool { afc_team: string; nfc_team: string; price_per_square: number; row_labels: string[] | null; col_labels: string[] | null; afc_digits: number[] | null; nfc_digits: number[] | null; squares: Record<string, Square>; winners: Record<string, Winner>; }",
            "render_html": "<div class=\"squares-pool\"><h2>{{afc_team}} vs {{nfc_team}}</h2><p>${{price_per_square}} per square</p></div>",
            "render_text": "{{afc_team}} vs {{nfc_team}}\n${{price_per_square}}/square"
          }
        },
        {
          "type": "schema.create",
          "payload": {
            "id": "Square",
            "interface": "interface Square { owner: string | null; }",
            "render_html": "<div class=\"square {{#owner}}claimed{{/owner}}\">{{#owner}}{{owner}}{{/owner}}{{^owner}}&nbsp;{{/owner}}</div>",
            "render_text": "{{#owner}}{{owner}}{{/owner}}{{^owner}}-{{/owner}}"
          }
        },
        {
          "type": "schema.create",
          "payload": {
            "id": "Winner",
            "interface": "interface Winner { quarter: string; afc_score: number; nfc_score: number; afc_digit: number; nfc_digit: number; winner_name: string; payout: number; }",
            "render_html": "<tr><td>{{quarter}}</td><td>{{afc_score}}-{{nfc_score}}</td><td>{{winner_name}}</td><td>${{payout}}</td></tr>",
            "render_text": "{{quarter}}: {{afc_score}}-{{nfc_score}} → {{winner_name}} (${{payout}})"
          }
        }
      ],
      "expected_entities": [
        {
          "type": "entity.create",
          "payload": {
            "id": "squares_pool",
            "_schema": "SquaresPool",
            "afc_team": "Chiefs",
            "nfc_team": "Eagles",
            "price_per_square": 10,
            "row_labels": null,
            "col_labels": null,
            "afc_digits": null,
            "nfc_digits": null,
            "squares": {
              "_shape": [10, 10]
            },
            "winners": {}
          },
          "notes": "Squares collection uses _shape for sparse representation. Missing keys default to { owner: null }."
        }
      ],
      "expected_blocks": [
        {
          "type": "block.set",
          "payload": {
            "id": "block_header",
            "type": "heading",
            "parent": "block_root",
            "position": 1.0,
            "props": { "level": 1, "content": "Super Bowl Squares" }
          }
        },
        {
          "type": "block.set",
          "payload": {
            "id": "block_matchup",
            "type": "text",
            "parent": "block_root",
            "position": 2.0,
            "props": { "content": "Chiefs vs Eagles | $10/square" }
          }
        },
        {
          "type": "block.set",
          "payload": {
            "id": "block_grid",
            "type": "entity_view",
            "parent": "block_root",
            "position": 3.0,
            "props": { "source": "squares_pool/squares" }
          }
        },
        {
          "type": "block.set",
          "payload": {
            "id": "block_winners_header",
            "type": "heading",
            "parent": "block_root",
            "position": 4.0,
            "props": { "level": 2, "content": "Winners" }
          }
        },
        {
          "type": "block.set",
          "payload": {
            "id": "block_winners",
            "type": "entity_view",
            "parent": "block_root",
            "position": 5.0,
            "props": { "source": "squares_pool/winners" }
          }
        }
      ],
      "expected_meta": [
        {
          "type": "meta.update",
          "payload": {
            "title": "Super Bowl Squares",
            "identity": "Football squares betting pool"
          }
        }
      ]
    },
    {
      "turn": 2,
      "user_message": "Label the rows Q through Z and the columns A through J",
      "expected_entities": [
        {
          "type": "entity.update",
          "payload": {
            "id": "squares_pool",
            "row_labels": ["Q", "R", "S", "T", "U", "V", "W", "X", "Y", "Z"],
            "col_labels": ["A", "B", "C", "D", "E", "F", "G", "H", "I", "J"]
          }
        }
      ],
      "notes": "Now users can reference squares as Q-A (0_0), R-B (1_1), Z-J (9_9), etc."
    },
    {
      "turn": 3,
      "user_message": "Mike wants Q-A through Q-E. Sarah wants R-A through R-E.",
      "notes": "Q=row 0, R=row 1. A-E=cols 0-4. Maps to 0_0-0_4 and 1_0-1_4.",
      "expected_entities": [
        {
          "type": "entity.update",
          "payload": {
            "id": "squares_pool",
            "squares": {
              "0_0": { "owner": "Mike" },
              "0_1": { "owner": "Mike" },
              "0_2": { "owner": "Mike" },
              "0_3": { "owner": "Mike" },
              "0_4": { "owner": "Mike" },
              "1_0": { "owner": "Sarah" },
              "1_1": { "owner": "Sarah" },
              "1_2": { "owner": "Sarah" },
              "1_3": { "owner": "Sarah" },
              "1_4": { "owner": "Sarah" }
            }
          }
        }
      ]
    },
    {
      "turn": 4,
      "user_message": "Dave claims S-D, V-H, and Y-B",
      "notes": "S=row 2, V=row 5, Y=row 8. D=col 3, H=col 7, B=col 1. Maps to 2_3, 5_7, 8_1.",
      "expected_entities": [
        {
          "type": "entity.update",
          "payload": {
            "id": "squares_pool",
            "squares": {
              "2_3": { "owner": "Dave" },
              "5_7": { "owner": "Dave" },
              "8_1": { "owner": "Dave" }
            }
          }
        }
      ]
    },
    {
      "turn": 5,
      "user_message": "Grid is full, assign random digits. Chiefs for rows, Eagles for columns.",
      "expected_entities": [
        {
          "type": "entity.update",
          "payload": {
            "id": "squares_pool",
            "afc_digits": [3, 7, 1, 9, 4, 0, 6, 2, 8, 5],
            "nfc_digits": [8, 2, 5, 0, 7, 3, 9, 1, 4, 6]
          },
          "notes": "Digits shuffled 0-9. Row Q (0) = Chiefs digit 3, Col A (0) = Eagles digit 8, etc."
        }
      ]
    },
    {
      "turn": 6,
      "user_message": "Q1 score: Chiefs 7, Eagles 3",
      "notes": "Chiefs 7 → row where afc_digits=7 → R (row 1). Eagles 3 → col where nfc_digits=3 → F (col 5). Winner at R-F (1_5).",
      "expected_entities": [
        {
          "type": "entity.update",
          "payload": {
            "id": "squares_pool",
            "winners": {
              "winner_q1": {
                "quarter": "Q1",
                "afc_score": 7,
                "nfc_score": 3,
                "afc_digit": 7,
                "nfc_digit": 3,
                "winner_name": "Sarah",
                "payout": 250,
                "_pos": 1.0
              }
            }
          }
        }
      ],
      "expected_styles": [
        {
          "type": "style.set_entity",
          "payload": {
            "id": "squares_pool/squares/1_5",
            "styles": {
              "highlight": true,
              "bg_color": "#bbf7d0"
            }
          }
        }
      ]
    },
    {
      "turn": 7,
      "user_message": "Halftime: Chiefs 14, Eagles 10",
      "notes": "Chiefs 14 → digit 4 → U (row 4). Eagles 10 → digit 0 → D (col 3). Winner at U-D (4_3).",
      "expected_entities": [
        {
          "type": "entity.update",
          "payload": {
            "id": "squares_pool",
            "winners": {
              "winner_q2": {
                "quarter": "Halftime",
                "afc_score": 14,
                "nfc_score": 10,
                "afc_digit": 4,
                "nfc_digit": 0,
                "winner_name": "Unknown",
                "payout": 250,
                "_pos": 2.0
              }
            }
          },
          "notes": "Square U-D (4_3) was unclaimed in this abbreviated scenario."
        }
      ],
      "expected_styles": [
        {
          "type": "style.set_entity",
          "payload": {
            "id": "squares_pool/squares/4_3",
            "styles": {
              "highlight": true,
              "bg_color": "#bbf7d0"
            }
          }
        }
      ]
    },
    {
      "turn": 8,
      "user_message": "Mike sold Q-C to Lisa",
      "notes": "Q-C = row Q (0), col C (2) = 0_2.",
      "expected_entities": [
        {
          "type": "entity.update",
          "payload": {
            "id": "squares_pool",
            "squares": {
              "0_2": { "owner": "Lisa" }
            }
          }
        }
      ]
    },
    {
      "turn": 9,
      "type": "query",
      "user_message": "What squares does Mike have?",
      "expected_primitives": [],
      "expected_response": {
        "type": "text",
        "content": "Mike has 4 squares: Q-A, Q-B, Q-D, Q-E. He sold Q-C to Lisa.",
        "notes": "Query uses labels in response."
      }
    },
    {
      "turn": 10,
      "type": "query",
      "user_message": "Who won so far?",
      "expected_primitives": [],
      "expected_response": {
        "type": "text",
        "content": "Winners so far:\n- Q1: Sarah won $250 at R-F (Chiefs 7, Eagles 3)\n- Halftime: Unclaimed square U-D won $250 (Chiefs 14, Eagles 10)\n\nTotal payouts: $500. Remaining pot: $500 (Q3 and Final).",
        "notes": "Uses labels in response."
      }
    },
    {
      "turn": 11,
      "type": "query",
      "user_message": "What's at S-D?",
      "expected_primitives": [],
      "expected_response": {
        "type": "text",
        "content": "S-D is owned by Dave. It corresponds to Chiefs digit 1 and Eagles digit 0.",
        "notes": "Query about specific labeled square."
      }
    },
    {
      "turn": 12,
      "type": "error",
      "user_message": "Give Q-A to Tom",
      "expected_primitives": [],
      "expected_response": {
        "type": "clarification",
        "content": "Q-A is already claimed by Mike. Did you mean Tom is buying it from Mike, or did you want a different square?",
        "notes": "Error using labels."
      }
    },
    {
      "turn": 13,
      "type": "error",
      "user_message": "Give A-Q to Tom",
      "expected_primitives": [],
      "expected_response": {
        "type": "clarification",
        "content": "A-Q isn't a valid square. Rows are Q-Z and columns are A-J. Did you mean Q-A?",
        "notes": "Error: swapped row/col labels."
      }
    }
  ],
  "final_state_assertions": {
    "squares_claimed": 13,
    "winners_count": 2,
    "total_payouts": 500,
    "pot_remaining": 500
  }
}
