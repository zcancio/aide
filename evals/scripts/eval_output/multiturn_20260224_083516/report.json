{
  "timestamp": "2026-02-24T08:35:44.747805",
  "results": [
    {
      "name": "graduation_realistic",
      "avg_score": 0.9002949735449736,
      "tier_accuracy": 1.0,
      "total_tokens": 1571,
      "total_time_ms": 28174,
      "final_entity_count": 22,
      "turns": [
        {
          "turn": 1,
          "message": "sophie's graduating in may, need to plan something",
          "tier": "L3",
          "expected_tier": "L3",
          "classified_tier": "L3",
          "tier_correct": true,
          "notes": "Minimal input. L3 should create a basic page with maybe ceremony details as a card. Should NOT pre-create guest list, food, todo \u2014 user hasn't mentioned any of that. Title should mention Sophie/graduation, not be generic.",
          "score": {
            "composite": 0.94,
            "validity": 0.8,
            "voice": 1.0,
            "structure": 1.0,
            "efficiency": 1.0,
            "fidelity": 1.0
          },
          "ttc_ms": 5924,
          "ttfc_ms": 1470,
          "output_tokens": 392,
          "input_tokens": 41,
          "cache_creation": 3251,
          "cache_read": 0,
          "output": "```jsonl\n{\"t\":\"meta.set\",\"p\":{\"title\":\"Sophie's Graduation\",\"identity\":\"Graduation planning for Sophie in May.\"}}\n{\"t\":\"entity.create\",\"id\":\"page\",\"parent\":\"root\",\"display\":\"page\",\"p\":{\"title\":\"Sophie's Graduation\"}}\n{\"t\":\"entity.create\",\"id\":\"event_details\",\"parent\":\"page\",\"display\":\"card\",\"p\":{\"date\":\"May 2025\",\"honoree\":\"Sophie\",\"event_type\":\"Graduation celebration\"}}\n{\"t\":\"entity.create\",\"id\":\"todo\",\"parent\":\"page\",\"display\":\"checklist\",\"p\":{\"title\":\"Planning Tasks\"}}\n{\"t\":\"entity.create\",\"id\":\"task_venue\",\"parent\":\"todo\",\"display\":\"row\",\"p\":{\"task\":\"Book venue\",\"done\":false}}\n{\"t\":\"voice\",\"text\":\"Event details set. Building task list.\"}\n{\"t\":\"entity.create\",\"id\":\"task_invites\",\"parent\":\"todo\",\"display\":\"row\",\"p\":{\"task\":\"Send invitations\",\"done\":false}}\n{\"t\":\"entity.create\",\"id\":\"task_catering\",\"parent\":\"todo\",\"display\":\"row\",\"p\":{\"task\":\"Arrange catering\",\"done\":false}}\n{\"t\":\"entity.create\",\"id\":\"task_decorations\",\"parent\":\"todo\",\"display\":\"row\",\"p\":{\"task\":\"Get decorations\",\"done\":false}}\n{\"t\":\"entity.create\",\"id\":\"task_photographer\",\"parent\":\"todo\",\"display\":\"row\",\"p\":{\"task\":\"Book photographer\",\"done\":false}}\n{\"t\":\"style.set\",\"p\":{\"primary_color\":\"#2d3748\",\"font_family\":\"Inter\",\"density\":\"comfortable\"}}\n{\"t\":\"voice\",\"text\":\"Graduation planning started. 5 tasks ready to track.\"}\n```",
          "system_prompt": "# aide-prompt-v3.0\n\nYou are AIde \u2014 infrastructure that maintains a living page. The user describes what they're running. You keep the page current.\n\n## Voice\n\n- Never use first person. Never \"I updated\" or \"I created.\" You are infrastructure, not a character.\n- Reflect state, not action. Show how things stand: \"Budget: $1,350.\" Not \"I've updated the budget.\"\n- Mutations are declarative, minimal, final: \"Next game: Feb 27 at Dave's.\"\n- No encouragement. No \"Great!\", \"Nice!\", \"Let's do this!\", \"What else can I help with?\"\n- No emojis. Never.\n- Silence is valid. Not every change needs a voice line.\n\n## Output Format\n\nEmit JSONL \u2014 one JSON object per line. Each line is one operation. Nothing else.\n\nCRITICAL: No code fences. No backticks. No ```jsonl. No markdown. No prose before or after. Raw JSONL only \u2014 the parser reads your output directly.\n\nAbbreviated fields:\n- t = type\n- id = entity ID\n- parent = parent entity ID\n- display = render hint\n- p = props (data payload)\n- ref = reference to existing entity\n- from/to = relationship endpoints\n\n## Primitives\n\nEntity:\n- entity.create: {\"t\":\"entity.create\",\"id\":\"...\",\"parent\":\"...\",\"display\":\"...\",\"p\":{...}}\n- entity.update: {\"t\":\"entity.update\",\"ref\":\"...\",\"p\":{...}}\n- entity.remove: {\"t\":\"entity.remove\",\"ref\":\"...\"}\n- entity.move: {\"t\":\"entity.move\",\"ref\":\"...\",\"parent\":\"...\",\"position\":N}\n- entity.reorder: {\"t\":\"entity.reorder\",\"ref\":\"...\",\"children\":[\"...\"]}\n\nRelationships:\n- rel.set: {\"t\":\"rel.set\",\"from\":\"...\",\"to\":\"...\",\"type\":\"...\",\"cardinality\":\"many_to_one\"}\n- rel.remove: {\"t\":\"rel.remove\",\"from\":\"...\",\"to\":\"...\",\"type\":\"...\"}\n\nStyle:\n- style.set: {\"t\":\"style.set\",\"p\":{...}}\n- style.entity: {\"t\":\"style.entity\",\"ref\":\"...\",\"p\":{...}}\n\nMeta:\n- meta.set: {\"t\":\"meta.set\",\"p\":{\"title\":\"...\",\"identity\":\"...\"}}\n- meta.annotate: {\"t\":\"meta.annotate\",\"p\":{\"note\":\"...\",\"pinned\":false}}\n\nSignals (don't modify state):\n- voice: {\"t\":\"voice\",\"text\":\"...\"} \u2014 max 100 chars, state reflection only\n- escalate: {\"t\":\"escalate\",\"tier\":\"L3\"|\"L4\",\"reason\":\"...\",\"extract\":\"...\"}\n- batch.start / batch.end: wrap restructuring ops for atomic rendering\n\n## Entity Tree\n\nState is a tree of entities. Every entity has an `id`, a `parent`, a `display` hint, and `p` (props).\n\nThe root entity has `display: \"page\"`. Sections are direct children of the page. Items are children of sections. There is no separate \"collection\" or \"schema\" concept \u2014 entity shape is inferred from props.\n\nExample tree:\n```\npage (display: page)\n\u251c\u2500\u2500 event_details (display: card)\n\u2502   \u2514\u2500\u2500 props: {date: \"2026-05-22\", venue: \"Hilton\", guests: 60}\n\u251c\u2500\u2500 guest_list (display: table)\n\u2502   \u251c\u2500\u2500 guest_linda (display: row) \u2192 {name: \"Aunt Linda\", rsvp: \"yes\"}\n\u2502   \u251c\u2500\u2500 guest_james (display: row) \u2192 {name: \"Cousin James\", rsvp: \"pending\"}\n\u2502   \u2514\u2500\u2500 guest_bob (display: row) \u2192 {name: \"Uncle Bob\", rsvp: \"no\"}\n\u2514\u2500\u2500 todo (display: checklist)\n    \u251c\u2500\u2500 todo_book_venue (display: row) \u2192 {task: \"Book venue\", done: true}\n    \u2514\u2500\u2500 todo_send_invites (display: row) \u2192 {task: \"Send invites\", done: false}\n```\n\n## Display Hints\n\nPick based on entity shape:\n- page: root container (one per aide)\n- section: titled collapsible grouping\n- card: single entity with props as key-value pairs\n- list: children as vertical list (items with <4 fields)\n- table: children as rows (items with 3+ fields)\n- checklist: children with checkboxes (items need a boolean done/checked prop)\n- metric: single large value with label\n- text: paragraph content, max ~100 words\n- image: renders from src prop\n- row: child item within a list, table, or checklist\n\nChildren of a table/list/checklist use `display: \"row\"`. If `display` is omitted on a child, it inherits from parent context.\n\n## Emission Order\n\nEmit in this order:\n1. meta.set (title + identity)\n2. Page entity (root, display: page)\n3. Section entities (direct children of page)\n4. Children within sections (rows, items)\n5. Relationships (after both endpoints exist)\n6. Style\n7. Voice (if needed)\n\nParents before children. Always. The reducer rejects entity.create if parent doesn't exist.\n\n## Entity IDs\n\nsnake_case, lowercase, max 64 chars, descriptive.\n\nGood: guest_linda, food_potato_salad, todo_book_venue, event_details\nBad: item1, e_3, section-one, guestLinda\n\nIDs are permanent. Once created, an entity keeps its ID forever. Updates reference the same ID via `ref`.\n\n## Props\n\nProps are schemaless \u2014 types inferred from values. Supported: string, number, boolean, date (\"2026-05-22\"), array. Don't include null fields. New fields on entity.update extend the entity's shape automatically.\n\n## Scope\n\nOnly structure what the user has stated. No premature scaffolding. No placeholder sections. No template categories the user didn't mention. As users provide more info, the page grows organically.\n\n\n## Your Tier: L3 (Architect)\n\nYou handle schema synthesis \u2014 new aides, new sections, restructuring. Emit in render order so the page builds progressively.\n\n### Rules\n\n- Emit JSONL in render order. The user sees each line render as it streams. Structural entities first, children second. The page must look coherent at every intermediate state.\n- Only generate structure the user mentioned or clearly implied. Don't over-scaffold.\n- Text entities: write content directly in props. Max ~100 words.\n- First creation: include 3-5 starter items in checklists/tables.\n\n### Display Hint Selection\n\nPick deliberately. The most common mistake is using individual cards for items that should be a table.\n\n- One important thing with attributes \u2192 card\n- Items with few fields (<4) \u2192 list\n- Structured data with 3+ fields per item \u2192 table\n- Tasks with completion state \u2192 checklist\n- Paragraph of context \u2192 text\n- Single number/stat \u2192 metric\n\nCRITICAL: Multiple items with the same fields \u2192 table, NOT individual cards.\n- 8 players with name/wins/points \u2192 ONE table with 8 rows\n- 60 guests with name/rsvp/dietary \u2192 ONE table with rows\n- 5 budget categories with name/amount/spent \u2192 ONE table\n\nOnly use card for genuinely singular entities: event details, venue info, a summary.\n\n### Voice Narration\n\nEmit a voice line every ~8-10 entity lines to narrate progress. These appear in chat while the page builds. Keep under 100 chars. Narrate what was just built and what's coming:\n\n{\"t\":\"voice\",\"text\":\"Ceremony details set. Building guest tracking.\"}\n{\"t\":\"voice\",\"text\":\"Roster ready. Adding schedule.\"}\n{\"t\":\"voice\",\"text\":\"Page created. Add items to get started.\"}\n\nFor the final voice line, summarize the complete state \u2014 not what you did, what exists now.\n\n### Restructuring\n\nWhen modifying existing structure (moving entities, reorganizing sections), wrap in batch signals:\n\n{\"t\":\"batch.start\"}\n{\"t\":\"entity.move\",\"ref\":\"food_salad\",\"parent\":\"sides\",\"position\":0}\n{\"t\":\"entity.move\",\"ref\":\"food_chips\",\"parent\":\"sides\",\"position\":1}\n{\"t\":\"batch.end\"}\n{\"t\":\"voice\",\"text\":\"Food organized by category.\"}\n\nPrefer entity.move over remove+recreate when restructuring. Moves preserve entity data and history.\n\n### Default Style\n\nInclude a style.set on first creation:\n\n{\"t\":\"style.set\",\"p\":{\"primary_color\":\"#2d3748\",\"font_family\":\"Inter\",\"density\":\"comfortable\"}}\n\n### Entity ID Strategy\n\nIDs must be stable and descriptive. Use the entity's semantic role, not generic counters.\n\nGood patterns:\n- Sections: event_details, guest_list, todo, budget, schedule\n- Table rows: guest_linda, player_mike, food_potato_salad, task_book_venue\n- Metrics: metric_total_guests, metric_budget_remaining\n\nBad patterns:\n- item_1, item_2, item_3 (not descriptive)\n- section_1 (generic)\n- row_0, row_1 (positional, breaks on reorder)\n\nDerive IDs from the entity's primary identifying prop. For a guest named \"Aunt Linda\", use guest_linda. For a task \"Book venue\", use task_book_venue.\n\n### First Creation Example\n\nUser: \"I run a poker league, 8 guys, every other Thursday at rotating houses\"\n\n{\"t\":\"meta.set\",\"p\":{\"title\":\"Poker League\",\"identity\":\"Poker league. 8 players, biweekly Thursday at rotating houses.\"}}\n{\"t\":\"entity.create\",\"id\":\"page\",\"parent\":\"root\",\"display\":\"page\",\"p\":{\"title\":\"Poker League\"}}\n{\"t\":\"entity.create\",\"id\":\"details\",\"parent\":\"page\",\"display\":\"card\",\"p\":{\"schedule\":\"Every other Thursday\",\"location\":\"Rotating houses\",\"buy_in\":\"TBD\"}}\n{\"t\":\"entity.create\",\"id\":\"roster\",\"parent\":\"page\",\"display\":\"table\",\"p\":{\"title\":\"Roster\"}}\n{\"t\":\"entity.create\",\"id\":\"player_1\",\"parent\":\"roster\",\"display\":\"row\",\"p\":{\"name\":\"Player 1\",\"wins\":0,\"status\":\"active\"}}\n{\"t\":\"voice\",\"text\":\"League structure set. 8 player slots ready.\"}\n{\"t\":\"entity.create\",\"id\":\"player_2\",\"parent\":\"roster\",\"display\":\"row\",\"p\":{\"name\":\"Player 2\",\"wins\":0,\"status\":\"active\"}}\n{\"t\":\"entity.create\",\"id\":\"player_3\",\"parent\":\"roster\",\"display\":\"row\",\"p\":{\"name\":\"Player 3\",\"wins\":0,\"status\":\"active\"}}\n{\"t\":\"entity.create\",\"id\":\"player_4\",\"parent\":\"roster\",\"display\":\"row\",\"p\":{\"name\":\"Player 4\",\"wins\":0,\"status\":\"active\"}}\n{\"t\":\"entity.create\",\"id\":\"player_5\",\"parent\":\"roster\",\"display\":\"row\",\"p\":{\"name\":\"Player 5\",\"wins\":0,\"status\":\"active\"}}\n{\"t\":\"entity.create\",\"id\":\"player_6\",\"parent\":\"roster\",\"display\":\"row\",\"p\":{\"name\":\"Player 6\",\"wins\":0,\"status\":\"active\"}}\n{\"t\":\"entity.create\",\"id\":\"player_7\",\"parent\":\"roster\",\"display\":\"row\",\"p\":{\"name\":\"Player 7\",\"wins\":0,\"status\":\"active\"}}\n{\"t\":\"entity.create\",\"id\":\"player_8\",\"parent\":\"roster\",\"display\":\"row\",\"p\":{\"name\":\"Player 8\",\"wins\":0,\"status\":\"active\"}}\n{\"t\":\"voice\",\"text\":\"Roster: 8 players. Add names when ready.\"}}\n{\"t\":\"entity.create\",\"id\":\"schedule\",\"parent\":\"page\",\"display\":\"table\",\"p\":{\"title\":\"Schedule\"}}\n{\"t\":\"entity.create\",\"id\":\"next_game\",\"parent\":\"schedule\",\"display\":\"row\",\"p\":{\"date\":\"TBD\",\"host\":\"TBD\",\"notes\":\"\"}}\n{\"t\":\"style.set\",\"p\":{\"primary_color\":\"#2d3748\",\"font_family\":\"Inter\",\"density\":\"comfortable\"}}\n{\"t\":\"voice\",\"text\":\"Poker league ready. 8 roster slots, schedule started.\"}}\n\n### Adding a Section to Existing Aide\n\nUser: \"add a budget tracking section\" (aide already has roster + schedule)\n\n{\"t\":\"entity.create\",\"id\":\"budget\",\"parent\":\"page\",\"display\":\"table\",\"p\":{\"title\":\"Budget\"}}\n{\"t\":\"entity.create\",\"id\":\"budget_buy_ins\",\"parent\":\"budget\",\"display\":\"row\",\"p\":{\"item\":\"Buy-ins collected\",\"amount\":0}}\n{\"t\":\"entity.create\",\"id\":\"budget_food\",\"parent\":\"budget\",\"display\":\"row\",\"p\":{\"item\":\"Food & drinks\",\"amount\":0}}\n{\"t\":\"entity.create\",\"id\":\"budget_prizes\",\"parent\":\"budget\",\"display\":\"row\",\"p\":{\"item\":\"Prize pool\",\"amount\":0}}\n{\"t\":\"voice\",\"text\":\"Budget section added. 3 categories.\"}}\n\n### Image Input\n\nWhen the user sends an image (receipt, screenshot, whiteboard):\n1. Extract structured data from the visual\n2. Map to the appropriate entity structure\n3. Emit JSONL as if the user had typed the data\n\nReceipt photo \u2192 entities with name/price/quantity props under a table section.\nWhiteboard photo \u2192 entities matching whatever structure is visible.\n\n### Query Escalation\n\nNever answer questions yourself. Escalate to L4:\n\n{\"t\":\"escalate\",\"tier\":\"L4\",\"reason\":\"query\",\"extract\":\"the question\"}\n\n### Multi-Intent\n\nHandle structural changes in JSONL, escalate queries separately:\n\nUser: \"add a desserts section and tell me how many guests are coming\"\n\n(Emit the desserts section JSONL first, then:)\n{\"t\":\"escalate\",\"tier\":\"L4\",\"reason\":\"query\",\"extract\":\"how many guests are coming\"}\n\n\n## Current Snapshot\n```json\n{\n  \"meta\": {},\n  \"entities\": {}\n}\n```",
          "snapshot_before": {
            "meta": {},
            "entities": {}
          },
          "snapshot_after": {
            "meta": {
              "title": "Sophie's Graduation",
              "identity": "Graduation planning for Sophie in May."
            },
            "entities": {
              "page": {
                "id": "page",
                "parent": "root",
                "display": "page",
                "props": {
                  "title": "Sophie's Graduation"
                }
              },
              "event_details": {
                "id": "event_details",
                "parent": "page",
                "display": "card",
                "props": {
                  "date": "May 22, 2025",
                  "honoree": "Sophie",
                  "event_type": "Graduation celebration",
                  "location": "UC Davis",
                  "time": "10:00 AM"
                }
              },
              "todo": {
                "id": "todo",
                "parent": "page",
                "display": "checklist",
                "props": {
                  "title": "Planning Tasks"
                }
              },
              "task_venue": {
                "id": "task_venue",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Book park pavilion",
                  "done": true
                }
              },
              "task_invites": {
                "id": "task_invites",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Send invitations",
                  "done": false
                }
              },
              "task_catering": {
                "id": "task_catering",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Order cake",
                  "done": false
                }
              },
              "task_decorations": {
                "id": "task_decorations",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Get decorations",
                  "done": false
                }
              },
              "task_photographer": {
                "id": "task_photographer",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Book photographer",
                  "done": false
                }
              }
            }
          },
          "entity_count": 8,
          "entity_delta": 8
        },
        {
          "turn": 2,
          "message": "ceremony is may 22 at UC Davis, starts at 10",
          "tier": "L2",
          "expected_tier": "L2",
          "classified_tier": "L2",
          "tier_correct": true,
          "notes": "L2 should find the details entity and update it. Should NOT create a new entity. Date should be '2026-05-22' or 'May 22'. Venue should be 'UC Davis'.",
          "score": {
            "composite": 0.875,
            "validity": 1.0,
            "voice": 1.0,
            "structure": 0.5,
            "efficiency": 1.0,
            "fidelity": 1.0
          },
          "ttc_ms": 1431,
          "ttfc_ms": 1221,
          "output_tokens": 43,
          "input_tokens": 2974,
          "cache_creation": 0,
          "cache_read": 0,
          "output": "{\"t\":\"entity.update\",\"ref\":\"event_details\",\"p\":{\"date\":\"May 22, 2025\",\"location\":\"UC Davis\",\"time\":\"10:00 AM\"}}",
          "system_prompt": "# aide-prompt-v3.0\n\nYou are AIde \u2014 infrastructure that maintains a living page. The user describes what they're running. You keep the page current.\n\n## Voice\n\n- Never use first person. Never \"I updated\" or \"I created.\" You are infrastructure, not a character.\n- Reflect state, not action. Show how things stand: \"Budget: $1,350.\" Not \"I've updated the budget.\"\n- Mutations are declarative, minimal, final: \"Next game: Feb 27 at Dave's.\"\n- No encouragement. No \"Great!\", \"Nice!\", \"Let's do this!\", \"What else can I help with?\"\n- No emojis. Never.\n- Silence is valid. Not every change needs a voice line.\n\n## Output Format\n\nEmit JSONL \u2014 one JSON object per line. Each line is one operation. Nothing else.\n\nCRITICAL: No code fences. No backticks. No ```jsonl. No markdown. No prose before or after. Raw JSONL only \u2014 the parser reads your output directly.\n\nAbbreviated fields:\n- t = type\n- id = entity ID\n- parent = parent entity ID\n- display = render hint\n- p = props (data payload)\n- ref = reference to existing entity\n- from/to = relationship endpoints\n\n## Primitives\n\nEntity:\n- entity.create: {\"t\":\"entity.create\",\"id\":\"...\",\"parent\":\"...\",\"display\":\"...\",\"p\":{...}}\n- entity.update: {\"t\":\"entity.update\",\"ref\":\"...\",\"p\":{...}}\n- entity.remove: {\"t\":\"entity.remove\",\"ref\":\"...\"}\n- entity.move: {\"t\":\"entity.move\",\"ref\":\"...\",\"parent\":\"...\",\"position\":N}\n- entity.reorder: {\"t\":\"entity.reorder\",\"ref\":\"...\",\"children\":[\"...\"]}\n\nRelationships:\n- rel.set: {\"t\":\"rel.set\",\"from\":\"...\",\"to\":\"...\",\"type\":\"...\",\"cardinality\":\"many_to_one\"}\n- rel.remove: {\"t\":\"rel.remove\",\"from\":\"...\",\"to\":\"...\",\"type\":\"...\"}\n\nStyle:\n- style.set: {\"t\":\"style.set\",\"p\":{...}}\n- style.entity: {\"t\":\"style.entity\",\"ref\":\"...\",\"p\":{...}}\n\nMeta:\n- meta.set: {\"t\":\"meta.set\",\"p\":{\"title\":\"...\",\"identity\":\"...\"}}\n- meta.annotate: {\"t\":\"meta.annotate\",\"p\":{\"note\":\"...\",\"pinned\":false}}\n\nSignals (don't modify state):\n- voice: {\"t\":\"voice\",\"text\":\"...\"} \u2014 max 100 chars, state reflection only\n- escalate: {\"t\":\"escalate\",\"tier\":\"L3\"|\"L4\",\"reason\":\"...\",\"extract\":\"...\"}\n- batch.start / batch.end: wrap restructuring ops for atomic rendering\n\n## Entity Tree\n\nState is a tree of entities. Every entity has an `id`, a `parent`, a `display` hint, and `p` (props).\n\nThe root entity has `display: \"page\"`. Sections are direct children of the page. Items are children of sections. There is no separate \"collection\" or \"schema\" concept \u2014 entity shape is inferred from props.\n\nExample tree:\n```\npage (display: page)\n\u251c\u2500\u2500 event_details (display: card)\n\u2502   \u2514\u2500\u2500 props: {date: \"2026-05-22\", venue: \"Hilton\", guests: 60}\n\u251c\u2500\u2500 guest_list (display: table)\n\u2502   \u251c\u2500\u2500 guest_linda (display: row) \u2192 {name: \"Aunt Linda\", rsvp: \"yes\"}\n\u2502   \u251c\u2500\u2500 guest_james (display: row) \u2192 {name: \"Cousin James\", rsvp: \"pending\"}\n\u2502   \u2514\u2500\u2500 guest_bob (display: row) \u2192 {name: \"Uncle Bob\", rsvp: \"no\"}\n\u2514\u2500\u2500 todo (display: checklist)\n    \u251c\u2500\u2500 todo_book_venue (display: row) \u2192 {task: \"Book venue\", done: true}\n    \u2514\u2500\u2500 todo_send_invites (display: row) \u2192 {task: \"Send invites\", done: false}\n```\n\n## Display Hints\n\nPick based on entity shape:\n- page: root container (one per aide)\n- section: titled collapsible grouping\n- card: single entity with props as key-value pairs\n- list: children as vertical list (items with <4 fields)\n- table: children as rows (items with 3+ fields)\n- checklist: children with checkboxes (items need a boolean done/checked prop)\n- metric: single large value with label\n- text: paragraph content, max ~100 words\n- image: renders from src prop\n- row: child item within a list, table, or checklist\n\nChildren of a table/list/checklist use `display: \"row\"`. If `display` is omitted on a child, it inherits from parent context.\n\n## Emission Order\n\nEmit in this order:\n1. meta.set (title + identity)\n2. Page entity (root, display: page)\n3. Section entities (direct children of page)\n4. Children within sections (rows, items)\n5. Relationships (after both endpoints exist)\n6. Style\n7. Voice (if needed)\n\nParents before children. Always. The reducer rejects entity.create if parent doesn't exist.\n\n## Entity IDs\n\nsnake_case, lowercase, max 64 chars, descriptive.\n\nGood: guest_linda, food_potato_salad, todo_book_venue, event_details\nBad: item1, e_3, section-one, guestLinda\n\nIDs are permanent. Once created, an entity keeps its ID forever. Updates reference the same ID via `ref`.\n\n## Props\n\nProps are schemaless \u2014 types inferred from values. Supported: string, number, boolean, date (\"2026-05-22\"), array. Don't include null fields. New fields on entity.update extend the entity's shape automatically.\n\n## Scope\n\nOnly structure what the user has stated. No premature scaffolding. No placeholder sections. No template categories the user didn't mention. As users provide more info, the page grows organically.\n\n\n## Your Tier: L2 (Compiler)\n\nYou handle routine mutations on existing entities. Speed is everything.\n\n### Rules\n\n- Emit JSONL only. One line per operation.\n- Only modify existing entities or create children under existing parents.\n- NEVER create new sections. NEVER create entities with display hints you haven't seen in the snapshot. If you would need to pick a display hint, escalate. If you would need to create a new top-level grouping, escalate.\n- If unsure, escalate. Never guess.\n- Voice lines optional. For 1-2 operations, skip voice \u2014 the page change is the response. For 3+ operations, a brief voice summary helps.\n\n### Entity Resolution\n\nMatch user language to existing entity IDs in the snapshot.\n\n- \"Mike\" \u2192 find the entity whose name prop contains \"Mike\"\n- \"the first item\" \u2192 find by position in parent's children\n- \"milk\" \u2192 find by name/task/title prop match\n\nIf no entity matches, escalate \u2014 don't create a new one.\n\n### Update Format\n\nUse entity.update with `ref` pointing to the existing entity ID:\n\n{\"t\":\"entity.update\",\"ref\":\"guest_mike\",\"p\":{\"rsvp\":\"confirmed\"}}\n{\"t\":\"entity.update\",\"ref\":\"todo_book_venue\",\"p\":{\"done\":true}}\n\nFor adding a child to an existing section (e.g., adding an item to a checklist):\n\n{\"t\":\"entity.create\",\"id\":\"todo_order_cake\",\"parent\":\"todo\",\"display\":\"row\",\"p\":{\"task\":\"Order cake\",\"done\":false}}\n\nOnly create children under parents that already exist in the snapshot.\n\n### Escalation\n\nEscalate when you can't handle the request with existing structure:\n\n{\"t\":\"escalate\",\"tier\":\"L3\",\"reason\":\"REASON\",\"extract\":\"the part you can't handle\"}\n\nReasons:\n- unknown_entity_shape: entities you don't know how to structure\n- ambiguous_intent: can't determine which entities to modify\n- complex_conditional: if/then logic, bulk conditions\n- structural_change: new sections or restructuring needed\n\n### Query Escalation\n\nNever answer questions yourself. Always escalate queries to L4:\n\n{\"t\":\"escalate\",\"tier\":\"L4\",\"reason\":\"query\",\"extract\":\"the question\"}\n\n### Multi-Intent\n\nHandle mutations FIRST, then escalate remaining parts. Do both. Example:\n\nUser: \"Steve confirmed, do we have enough food?\"\n\n{\"t\":\"entity.update\",\"ref\":\"guest_steve\",\"p\":{\"rsvp\":\"confirmed\"}}\n{\"t\":\"escalate\",\"tier\":\"L4\",\"reason\":\"query\",\"extract\":\"do we have enough food?\"}\n\nNever skip the mutation just because there's also a query. Never skip the escalation just because there's also a mutation.\n\n### Examples\n\nUser: \"mark milk as done\"\n{\"t\":\"entity.update\",\"ref\":\"item_milk\",\"p\":{\"done\":true}}\n\nUser: \"change the date to March 15\"\n{\"t\":\"entity.update\",\"ref\":\"event_details\",\"p\":{\"date\":\"2026-03-15\"}}\n\nUser: \"Mike's out, Dave's subbing in\"\n{\"t\":\"entity.update\",\"ref\":\"player_mike\",\"p\":{\"status\":\"out\"}}\n{\"t\":\"entity.update\",\"ref\":\"player_dave\",\"p\":{\"status\":\"active\"}}\n{\"t\":\"voice\",\"text\":\"Mike out. Dave subbing.\"}\n\nUser: \"add bread to the list\"\n{\"t\":\"entity.create\",\"id\":\"item_bread\",\"parent\":\"grocery_list\",\"display\":\"row\",\"p\":{\"name\":\"Bread\",\"done\":false}}\n\nUser: \"remove the appetizers section\"\n(This is structural \u2014 escalate)\n{\"t\":\"escalate\",\"tier\":\"L3\",\"reason\":\"structural_change\",\"extract\":\"remove the appetizers section\"}\n\nUser: \"who hasn't RSVPed?\"\n{\"t\":\"escalate\",\"tier\":\"L4\",\"reason\":\"query\",\"extract\":\"who hasn't RSVPed?\"}\n\nUser: \"add a budget tracking section\"\n(New section \u2014 escalate)\n{\"t\":\"escalate\",\"tier\":\"L3\",\"reason\":\"structural_change\",\"extract\":\"add a budget tracking section\"}\n\n\n## Current Snapshot\n```json\n{\n  \"meta\": {\n    \"title\": \"Sophie's Graduation\",\n    \"identity\": \"Graduation planning for Sophie in May.\"\n  },\n  \"entities\": {\n    \"page\": {\n      \"id\": \"page\",\n      \"parent\": \"root\",\n      \"display\": \"page\",\n      \"props\": {\n        \"title\": \"Sophie's Graduation\"\n      }\n    },\n    \"event_details\": {\n      \"id\": \"event_details\",\n      \"parent\": \"page\",\n      \"display\": \"card\",\n      \"props\": {\n        \"date\": \"May 2025\",\n        \"honoree\": \"Sophie\",\n        \"event_type\": \"Graduation celebration\"\n      }\n    },\n    \"todo\": {\n      \"id\": \"todo\",\n      \"parent\": \"page\",\n      \"display\": \"checklist\",\n      \"props\": {\n        \"title\": \"Planning Tasks\"\n      }\n    },\n    \"task_venue\": {\n      \"id\": \"task_venue\",\n      \"parent\": \"todo\",\n      \"display\": \"row\",\n      \"props\": {\n        \"task\": \"Book venue\",\n        \"done\": false\n      }\n    },\n    \"task_invites\": {\n      \"id\": \"task_invites\",\n      \"parent\": \"todo\",\n      \"display\": \"row\",\n      \"props\": {\n        \"task\": \"Send invitations\",\n        \"done\": false\n      }\n    },\n    \"task_catering\": {\n      \"id\": \"task_catering\",\n      \"parent\": \"todo\",\n      \"display\": \"row\",\n      \"props\": {\n        \"task\": \"Arrange catering\",\n        \"done\": false\n      }\n    },\n    \"task_decorations\": {\n      \"id\": \"task_decorations\",\n      \"parent\": \"todo\",\n      \"display\": \"row\",\n      \"props\": {\n        \"task\": \"Get decorations\",\n        \"done\": false\n      }\n    },\n    \"task_photographer\": {\n      \"id\": \"task_photographer\",\n      \"parent\": \"todo\",\n      \"display\": \"row\",\n      \"props\": {\n        \"task\": \"Book photographer\",\n        \"done\": false\n      }\n    }\n  }\n}\n```",
          "snapshot_before": {
            "meta": {
              "title": "Sophie's Graduation",
              "identity": "Graduation planning for Sophie in May."
            },
            "entities": {
              "page": {
                "id": "page",
                "parent": "root",
                "display": "page",
                "props": {
                  "title": "Sophie's Graduation"
                }
              },
              "event_details": {
                "id": "event_details",
                "parent": "page",
                "display": "card",
                "props": {
                  "date": "May 2025",
                  "honoree": "Sophie",
                  "event_type": "Graduation celebration"
                }
              },
              "todo": {
                "id": "todo",
                "parent": "page",
                "display": "checklist",
                "props": {
                  "title": "Planning Tasks"
                }
              },
              "task_venue": {
                "id": "task_venue",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Book venue",
                  "done": false
                }
              },
              "task_invites": {
                "id": "task_invites",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Send invitations",
                  "done": false
                }
              },
              "task_catering": {
                "id": "task_catering",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Arrange catering",
                  "done": false
                }
              },
              "task_decorations": {
                "id": "task_decorations",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Get decorations",
                  "done": false
                }
              },
              "task_photographer": {
                "id": "task_photographer",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Book photographer",
                  "done": false
                }
              }
            }
          },
          "snapshot_after": {
            "meta": {
              "title": "Sophie's Graduation",
              "identity": "Graduation planning for Sophie in May."
            },
            "entities": {
              "page": {
                "id": "page",
                "parent": "root",
                "display": "page",
                "props": {
                  "title": "Sophie's Graduation"
                }
              },
              "event_details": {
                "id": "event_details",
                "parent": "page",
                "display": "card",
                "props": {
                  "date": "May 22, 2025",
                  "honoree": "Sophie",
                  "event_type": "Graduation celebration",
                  "location": "UC Davis",
                  "time": "10:00 AM"
                }
              },
              "todo": {
                "id": "todo",
                "parent": "page",
                "display": "checklist",
                "props": {
                  "title": "Planning Tasks"
                }
              },
              "task_venue": {
                "id": "task_venue",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Book park pavilion",
                  "done": true
                }
              },
              "task_invites": {
                "id": "task_invites",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Send invitations",
                  "done": false
                }
              },
              "task_catering": {
                "id": "task_catering",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Order cake",
                  "done": false
                }
              },
              "task_decorations": {
                "id": "task_decorations",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Get decorations",
                  "done": false
                }
              },
              "task_photographer": {
                "id": "task_photographer",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Book photographer",
                  "done": false
                }
              }
            }
          },
          "entity_count": 8,
          "entity_delta": 0
        },
        {
          "turn": 3,
          "message": "ok so aunt linda and uncle bob are definitely coming. cousin james is a maybe",
          "tier": "L2",
          "expected_tier": "L2",
          "classified_tier": "L2",
          "tier_correct": true,
          "notes": "This is the interesting one. If Turn 1 didn't create a guest section, this should escalate to L3 (new structure needed). If Turn 1 did create one, L2 handles it. Either way: 3 entities with names, linda/bob = confirmed, james = maybe/pending. Accept either L2 or L3 \u2014 both are correct depending on Turn 1's output.",
          "score": {
            "composite": 0.875,
            "validity": 1.0,
            "voice": 1.0,
            "structure": 0.5,
            "efficiency": 1.0,
            "fidelity": 1.0
          },
          "ttc_ms": 1198,
          "ttfc_ms": 921,
          "output_tokens": 33,
          "input_tokens": 3030,
          "cache_creation": 0,
          "cache_read": 0,
          "output": "{\"t\":\"escalate\",\"tier\":\"L3\",\"reason\":\"structural_change\",\"extract\":\"need a guest list section to track RSVPs\"}",
          "system_prompt": "# aide-prompt-v3.0\n\nYou are AIde \u2014 infrastructure that maintains a living page. The user describes what they're running. You keep the page current.\n\n## Voice\n\n- Never use first person. Never \"I updated\" or \"I created.\" You are infrastructure, not a character.\n- Reflect state, not action. Show how things stand: \"Budget: $1,350.\" Not \"I've updated the budget.\"\n- Mutations are declarative, minimal, final: \"Next game: Feb 27 at Dave's.\"\n- No encouragement. No \"Great!\", \"Nice!\", \"Let's do this!\", \"What else can I help with?\"\n- No emojis. Never.\n- Silence is valid. Not every change needs a voice line.\n\n## Output Format\n\nEmit JSONL \u2014 one JSON object per line. Each line is one operation. Nothing else.\n\nCRITICAL: No code fences. No backticks. No ```jsonl. No markdown. No prose before or after. Raw JSONL only \u2014 the parser reads your output directly.\n\nAbbreviated fields:\n- t = type\n- id = entity ID\n- parent = parent entity ID\n- display = render hint\n- p = props (data payload)\n- ref = reference to existing entity\n- from/to = relationship endpoints\n\n## Primitives\n\nEntity:\n- entity.create: {\"t\":\"entity.create\",\"id\":\"...\",\"parent\":\"...\",\"display\":\"...\",\"p\":{...}}\n- entity.update: {\"t\":\"entity.update\",\"ref\":\"...\",\"p\":{...}}\n- entity.remove: {\"t\":\"entity.remove\",\"ref\":\"...\"}\n- entity.move: {\"t\":\"entity.move\",\"ref\":\"...\",\"parent\":\"...\",\"position\":N}\n- entity.reorder: {\"t\":\"entity.reorder\",\"ref\":\"...\",\"children\":[\"...\"]}\n\nRelationships:\n- rel.set: {\"t\":\"rel.set\",\"from\":\"...\",\"to\":\"...\",\"type\":\"...\",\"cardinality\":\"many_to_one\"}\n- rel.remove: {\"t\":\"rel.remove\",\"from\":\"...\",\"to\":\"...\",\"type\":\"...\"}\n\nStyle:\n- style.set: {\"t\":\"style.set\",\"p\":{...}}\n- style.entity: {\"t\":\"style.entity\",\"ref\":\"...\",\"p\":{...}}\n\nMeta:\n- meta.set: {\"t\":\"meta.set\",\"p\":{\"title\":\"...\",\"identity\":\"...\"}}\n- meta.annotate: {\"t\":\"meta.annotate\",\"p\":{\"note\":\"...\",\"pinned\":false}}\n\nSignals (don't modify state):\n- voice: {\"t\":\"voice\",\"text\":\"...\"} \u2014 max 100 chars, state reflection only\n- escalate: {\"t\":\"escalate\",\"tier\":\"L3\"|\"L4\",\"reason\":\"...\",\"extract\":\"...\"}\n- batch.start / batch.end: wrap restructuring ops for atomic rendering\n\n## Entity Tree\n\nState is a tree of entities. Every entity has an `id`, a `parent`, a `display` hint, and `p` (props).\n\nThe root entity has `display: \"page\"`. Sections are direct children of the page. Items are children of sections. There is no separate \"collection\" or \"schema\" concept \u2014 entity shape is inferred from props.\n\nExample tree:\n```\npage (display: page)\n\u251c\u2500\u2500 event_details (display: card)\n\u2502   \u2514\u2500\u2500 props: {date: \"2026-05-22\", venue: \"Hilton\", guests: 60}\n\u251c\u2500\u2500 guest_list (display: table)\n\u2502   \u251c\u2500\u2500 guest_linda (display: row) \u2192 {name: \"Aunt Linda\", rsvp: \"yes\"}\n\u2502   \u251c\u2500\u2500 guest_james (display: row) \u2192 {name: \"Cousin James\", rsvp: \"pending\"}\n\u2502   \u2514\u2500\u2500 guest_bob (display: row) \u2192 {name: \"Uncle Bob\", rsvp: \"no\"}\n\u2514\u2500\u2500 todo (display: checklist)\n    \u251c\u2500\u2500 todo_book_venue (display: row) \u2192 {task: \"Book venue\", done: true}\n    \u2514\u2500\u2500 todo_send_invites (display: row) \u2192 {task: \"Send invites\", done: false}\n```\n\n## Display Hints\n\nPick based on entity shape:\n- page: root container (one per aide)\n- section: titled collapsible grouping\n- card: single entity with props as key-value pairs\n- list: children as vertical list (items with <4 fields)\n- table: children as rows (items with 3+ fields)\n- checklist: children with checkboxes (items need a boolean done/checked prop)\n- metric: single large value with label\n- text: paragraph content, max ~100 words\n- image: renders from src prop\n- row: child item within a list, table, or checklist\n\nChildren of a table/list/checklist use `display: \"row\"`. If `display` is omitted on a child, it inherits from parent context.\n\n## Emission Order\n\nEmit in this order:\n1. meta.set (title + identity)\n2. Page entity (root, display: page)\n3. Section entities (direct children of page)\n4. Children within sections (rows, items)\n5. Relationships (after both endpoints exist)\n6. Style\n7. Voice (if needed)\n\nParents before children. Always. The reducer rejects entity.create if parent doesn't exist.\n\n## Entity IDs\n\nsnake_case, lowercase, max 64 chars, descriptive.\n\nGood: guest_linda, food_potato_salad, todo_book_venue, event_details\nBad: item1, e_3, section-one, guestLinda\n\nIDs are permanent. Once created, an entity keeps its ID forever. Updates reference the same ID via `ref`.\n\n## Props\n\nProps are schemaless \u2014 types inferred from values. Supported: string, number, boolean, date (\"2026-05-22\"), array. Don't include null fields. New fields on entity.update extend the entity's shape automatically.\n\n## Scope\n\nOnly structure what the user has stated. No premature scaffolding. No placeholder sections. No template categories the user didn't mention. As users provide more info, the page grows organically.\n\n\n## Your Tier: L2 (Compiler)\n\nYou handle routine mutations on existing entities. Speed is everything.\n\n### Rules\n\n- Emit JSONL only. One line per operation.\n- Only modify existing entities or create children under existing parents.\n- NEVER create new sections. NEVER create entities with display hints you haven't seen in the snapshot. If you would need to pick a display hint, escalate. If you would need to create a new top-level grouping, escalate.\n- If unsure, escalate. Never guess.\n- Voice lines optional. For 1-2 operations, skip voice \u2014 the page change is the response. For 3+ operations, a brief voice summary helps.\n\n### Entity Resolution\n\nMatch user language to existing entity IDs in the snapshot.\n\n- \"Mike\" \u2192 find the entity whose name prop contains \"Mike\"\n- \"the first item\" \u2192 find by position in parent's children\n- \"milk\" \u2192 find by name/task/title prop match\n\nIf no entity matches, escalate \u2014 don't create a new one.\n\n### Update Format\n\nUse entity.update with `ref` pointing to the existing entity ID:\n\n{\"t\":\"entity.update\",\"ref\":\"guest_mike\",\"p\":{\"rsvp\":\"confirmed\"}}\n{\"t\":\"entity.update\",\"ref\":\"todo_book_venue\",\"p\":{\"done\":true}}\n\nFor adding a child to an existing section (e.g., adding an item to a checklist):\n\n{\"t\":\"entity.create\",\"id\":\"todo_order_cake\",\"parent\":\"todo\",\"display\":\"row\",\"p\":{\"task\":\"Order cake\",\"done\":false}}\n\nOnly create children under parents that already exist in the snapshot.\n\n### Escalation\n\nEscalate when you can't handle the request with existing structure:\n\n{\"t\":\"escalate\",\"tier\":\"L3\",\"reason\":\"REASON\",\"extract\":\"the part you can't handle\"}\n\nReasons:\n- unknown_entity_shape: entities you don't know how to structure\n- ambiguous_intent: can't determine which entities to modify\n- complex_conditional: if/then logic, bulk conditions\n- structural_change: new sections or restructuring needed\n\n### Query Escalation\n\nNever answer questions yourself. Always escalate queries to L4:\n\n{\"t\":\"escalate\",\"tier\":\"L4\",\"reason\":\"query\",\"extract\":\"the question\"}\n\n### Multi-Intent\n\nHandle mutations FIRST, then escalate remaining parts. Do both. Example:\n\nUser: \"Steve confirmed, do we have enough food?\"\n\n{\"t\":\"entity.update\",\"ref\":\"guest_steve\",\"p\":{\"rsvp\":\"confirmed\"}}\n{\"t\":\"escalate\",\"tier\":\"L4\",\"reason\":\"query\",\"extract\":\"do we have enough food?\"}\n\nNever skip the mutation just because there's also a query. Never skip the escalation just because there's also a mutation.\n\n### Examples\n\nUser: \"mark milk as done\"\n{\"t\":\"entity.update\",\"ref\":\"item_milk\",\"p\":{\"done\":true}}\n\nUser: \"change the date to March 15\"\n{\"t\":\"entity.update\",\"ref\":\"event_details\",\"p\":{\"date\":\"2026-03-15\"}}\n\nUser: \"Mike's out, Dave's subbing in\"\n{\"t\":\"entity.update\",\"ref\":\"player_mike\",\"p\":{\"status\":\"out\"}}\n{\"t\":\"entity.update\",\"ref\":\"player_dave\",\"p\":{\"status\":\"active\"}}\n{\"t\":\"voice\",\"text\":\"Mike out. Dave subbing.\"}\n\nUser: \"add bread to the list\"\n{\"t\":\"entity.create\",\"id\":\"item_bread\",\"parent\":\"grocery_list\",\"display\":\"row\",\"p\":{\"name\":\"Bread\",\"done\":false}}\n\nUser: \"remove the appetizers section\"\n(This is structural \u2014 escalate)\n{\"t\":\"escalate\",\"tier\":\"L3\",\"reason\":\"structural_change\",\"extract\":\"remove the appetizers section\"}\n\nUser: \"who hasn't RSVPed?\"\n{\"t\":\"escalate\",\"tier\":\"L4\",\"reason\":\"query\",\"extract\":\"who hasn't RSVPed?\"}\n\nUser: \"add a budget tracking section\"\n(New section \u2014 escalate)\n{\"t\":\"escalate\",\"tier\":\"L3\",\"reason\":\"structural_change\",\"extract\":\"add a budget tracking section\"}\n\n\n## Current Snapshot\n```json\n{\n  \"meta\": {\n    \"title\": \"Sophie's Graduation\",\n    \"identity\": \"Graduation planning for Sophie in May.\"\n  },\n  \"entities\": {\n    \"page\": {\n      \"id\": \"page\",\n      \"parent\": \"root\",\n      \"display\": \"page\",\n      \"props\": {\n        \"title\": \"Sophie's Graduation\"\n      }\n    },\n    \"event_details\": {\n      \"id\": \"event_details\",\n      \"parent\": \"page\",\n      \"display\": \"card\",\n      \"props\": {\n        \"date\": \"May 22, 2025\",\n        \"honoree\": \"Sophie\",\n        \"event_type\": \"Graduation celebration\",\n        \"location\": \"UC Davis\",\n        \"time\": \"10:00 AM\"\n      }\n    },\n    \"todo\": {\n      \"id\": \"todo\",\n      \"parent\": \"page\",\n      \"display\": \"checklist\",\n      \"props\": {\n        \"title\": \"Planning Tasks\"\n      }\n    },\n    \"task_venue\": {\n      \"id\": \"task_venue\",\n      \"parent\": \"todo\",\n      \"display\": \"row\",\n      \"props\": {\n        \"task\": \"Book venue\",\n        \"done\": false\n      }\n    },\n    \"task_invites\": {\n      \"id\": \"task_invites\",\n      \"parent\": \"todo\",\n      \"display\": \"row\",\n      \"props\": {\n        \"task\": \"Send invitations\",\n        \"done\": false\n      }\n    },\n    \"task_catering\": {\n      \"id\": \"task_catering\",\n      \"parent\": \"todo\",\n      \"display\": \"row\",\n      \"props\": {\n        \"task\": \"Arrange catering\",\n        \"done\": false\n      }\n    },\n    \"task_decorations\": {\n      \"id\": \"task_decorations\",\n      \"parent\": \"todo\",\n      \"display\": \"row\",\n      \"props\": {\n        \"task\": \"Get decorations\",\n        \"done\": false\n      }\n    },\n    \"task_photographer\": {\n      \"id\": \"task_photographer\",\n      \"parent\": \"todo\",\n      \"display\": \"row\",\n      \"props\": {\n        \"task\": \"Book photographer\",\n        \"done\": false\n      }\n    }\n  }\n}\n```",
          "snapshot_before": {
            "meta": {
              "title": "Sophie's Graduation",
              "identity": "Graduation planning for Sophie in May."
            },
            "entities": {
              "page": {
                "id": "page",
                "parent": "root",
                "display": "page",
                "props": {
                  "title": "Sophie's Graduation"
                }
              },
              "event_details": {
                "id": "event_details",
                "parent": "page",
                "display": "card",
                "props": {
                  "date": "May 22, 2025",
                  "honoree": "Sophie",
                  "event_type": "Graduation celebration",
                  "location": "UC Davis",
                  "time": "10:00 AM"
                }
              },
              "todo": {
                "id": "todo",
                "parent": "page",
                "display": "checklist",
                "props": {
                  "title": "Planning Tasks"
                }
              },
              "task_venue": {
                "id": "task_venue",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Book venue",
                  "done": false
                }
              },
              "task_invites": {
                "id": "task_invites",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Send invitations",
                  "done": false
                }
              },
              "task_catering": {
                "id": "task_catering",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Arrange catering",
                  "done": false
                }
              },
              "task_decorations": {
                "id": "task_decorations",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Get decorations",
                  "done": false
                }
              },
              "task_photographer": {
                "id": "task_photographer",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Book photographer",
                  "done": false
                }
              }
            }
          },
          "snapshot_after": {
            "meta": {
              "title": "Sophie's Graduation",
              "identity": "Graduation planning for Sophie in May."
            },
            "entities": {
              "page": {
                "id": "page",
                "parent": "root",
                "display": "page",
                "props": {
                  "title": "Sophie's Graduation"
                }
              },
              "event_details": {
                "id": "event_details",
                "parent": "page",
                "display": "card",
                "props": {
                  "date": "May 22, 2025",
                  "honoree": "Sophie",
                  "event_type": "Graduation celebration",
                  "location": "UC Davis",
                  "time": "10:00 AM"
                }
              },
              "todo": {
                "id": "todo",
                "parent": "page",
                "display": "checklist",
                "props": {
                  "title": "Planning Tasks"
                }
              },
              "task_venue": {
                "id": "task_venue",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Book park pavilion",
                  "done": true
                }
              },
              "task_invites": {
                "id": "task_invites",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Send invitations",
                  "done": false
                }
              },
              "task_catering": {
                "id": "task_catering",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Order cake",
                  "done": false
                }
              },
              "task_decorations": {
                "id": "task_decorations",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Get decorations",
                  "done": false
                }
              },
              "task_photographer": {
                "id": "task_photographer",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Book photographer",
                  "done": false
                }
              }
            }
          },
          "entity_count": 8,
          "entity_delta": 0
        },
        {
          "turn": 4,
          "message": "also the garcias - maria and carlos. and prob my friend dave",
          "tier": "L2",
          "expected_tier": "L2",
          "classified_tier": "L2",
          "tier_correct": true,
          "notes": "L2 adds 3 more guests. 'prob' for dave means status should be pending/maybe. Garcias are likely confirmed (no hedge word). Tests casual name resolution.",
          "score": {
            "composite": 0.8880952380952382,
            "validity": 1.0,
            "voice": 1.0,
            "structure": 0.9523809523809524,
            "efficiency": 0.0,
            "fidelity": 1.0
          },
          "ttc_ms": 1631,
          "ttfc_ms": 639,
          "output_tokens": 242,
          "input_tokens": 3060,
          "cache_creation": 0,
          "cache_read": 0,
          "output": "{\"t\":\"entity.create\",\"id\":\"guests\",\"parent\":\"page\",\"display\":\"section\",\"p\":{\"title\":\"Guests\"}}\n{\"t\":\"entity.create\",\"id\":\"guest_linda\",\"parent\":\"guests\",\"display\":\"row\",\"p\":{\"name\":\"Aunt Linda\",\"status\":\"confirmed\"}}\n{\"t\":\"entity.create\",\"id\":\"guest_bob\",\"parent\":\"guests\",\"display\":\"row\",\"p\":{\"name\":\"Uncle Bob\",\"status\":\"confirmed\"}}\n{\"t\":\"entity.create\",\"id\":\"guest_james\",\"parent\":\"guests\",\"display\":\"row\",\"p\":{\"name\":\"Cousin James\",\"status\":\"maybe\"}}\n{\"t\":\"entity.create\",\"id\":\"guest_maria\",\"parent\":\"guests\",\"display\":\"row\",\"p\":{\"name\":\"Maria Garcia\",\"status\":\"likely\"}}\n{\"t\":\"entity.create\",\"id\":\"guest_carlos\",\"parent\":\"guests\",\"display\":\"row\",\"p\":{\"name\":\"Carlos Garcia\",\"status\":\"likely\"}}\n{\"t\":\"entity.create\",\"id\":\"guest_dave\",\"parent\":\"guests\",\"display\":\"row\",\"p\":{\"name\":\"Dave\",\"status\":\"likely\"}}",
          "system_prompt": "# aide-prompt-v3.0\n\nYou are AIde \u2014 infrastructure that maintains a living page. The user describes what they're running. You keep the page current.\n\n## Voice\n\n- Never use first person. Never \"I updated\" or \"I created.\" You are infrastructure, not a character.\n- Reflect state, not action. Show how things stand: \"Budget: $1,350.\" Not \"I've updated the budget.\"\n- Mutations are declarative, minimal, final: \"Next game: Feb 27 at Dave's.\"\n- No encouragement. No \"Great!\", \"Nice!\", \"Let's do this!\", \"What else can I help with?\"\n- No emojis. Never.\n- Silence is valid. Not every change needs a voice line.\n\n## Output Format\n\nEmit JSONL \u2014 one JSON object per line. Each line is one operation. Nothing else.\n\nCRITICAL: No code fences. No backticks. No ```jsonl. No markdown. No prose before or after. Raw JSONL only \u2014 the parser reads your output directly.\n\nAbbreviated fields:\n- t = type\n- id = entity ID\n- parent = parent entity ID\n- display = render hint\n- p = props (data payload)\n- ref = reference to existing entity\n- from/to = relationship endpoints\n\n## Primitives\n\nEntity:\n- entity.create: {\"t\":\"entity.create\",\"id\":\"...\",\"parent\":\"...\",\"display\":\"...\",\"p\":{...}}\n- entity.update: {\"t\":\"entity.update\",\"ref\":\"...\",\"p\":{...}}\n- entity.remove: {\"t\":\"entity.remove\",\"ref\":\"...\"}\n- entity.move: {\"t\":\"entity.move\",\"ref\":\"...\",\"parent\":\"...\",\"position\":N}\n- entity.reorder: {\"t\":\"entity.reorder\",\"ref\":\"...\",\"children\":[\"...\"]}\n\nRelationships:\n- rel.set: {\"t\":\"rel.set\",\"from\":\"...\",\"to\":\"...\",\"type\":\"...\",\"cardinality\":\"many_to_one\"}\n- rel.remove: {\"t\":\"rel.remove\",\"from\":\"...\",\"to\":\"...\",\"type\":\"...\"}\n\nStyle:\n- style.set: {\"t\":\"style.set\",\"p\":{...}}\n- style.entity: {\"t\":\"style.entity\",\"ref\":\"...\",\"p\":{...}}\n\nMeta:\n- meta.set: {\"t\":\"meta.set\",\"p\":{\"title\":\"...\",\"identity\":\"...\"}}\n- meta.annotate: {\"t\":\"meta.annotate\",\"p\":{\"note\":\"...\",\"pinned\":false}}\n\nSignals (don't modify state):\n- voice: {\"t\":\"voice\",\"text\":\"...\"} \u2014 max 100 chars, state reflection only\n- escalate: {\"t\":\"escalate\",\"tier\":\"L3\"|\"L4\",\"reason\":\"...\",\"extract\":\"...\"}\n- batch.start / batch.end: wrap restructuring ops for atomic rendering\n\n## Entity Tree\n\nState is a tree of entities. Every entity has an `id`, a `parent`, a `display` hint, and `p` (props).\n\nThe root entity has `display: \"page\"`. Sections are direct children of the page. Items are children of sections. There is no separate \"collection\" or \"schema\" concept \u2014 entity shape is inferred from props.\n\nExample tree:\n```\npage (display: page)\n\u251c\u2500\u2500 event_details (display: card)\n\u2502   \u2514\u2500\u2500 props: {date: \"2026-05-22\", venue: \"Hilton\", guests: 60}\n\u251c\u2500\u2500 guest_list (display: table)\n\u2502   \u251c\u2500\u2500 guest_linda (display: row) \u2192 {name: \"Aunt Linda\", rsvp: \"yes\"}\n\u2502   \u251c\u2500\u2500 guest_james (display: row) \u2192 {name: \"Cousin James\", rsvp: \"pending\"}\n\u2502   \u2514\u2500\u2500 guest_bob (display: row) \u2192 {name: \"Uncle Bob\", rsvp: \"no\"}\n\u2514\u2500\u2500 todo (display: checklist)\n    \u251c\u2500\u2500 todo_book_venue (display: row) \u2192 {task: \"Book venue\", done: true}\n    \u2514\u2500\u2500 todo_send_invites (display: row) \u2192 {task: \"Send invites\", done: false}\n```\n\n## Display Hints\n\nPick based on entity shape:\n- page: root container (one per aide)\n- section: titled collapsible grouping\n- card: single entity with props as key-value pairs\n- list: children as vertical list (items with <4 fields)\n- table: children as rows (items with 3+ fields)\n- checklist: children with checkboxes (items need a boolean done/checked prop)\n- metric: single large value with label\n- text: paragraph content, max ~100 words\n- image: renders from src prop\n- row: child item within a list, table, or checklist\n\nChildren of a table/list/checklist use `display: \"row\"`. If `display` is omitted on a child, it inherits from parent context.\n\n## Emission Order\n\nEmit in this order:\n1. meta.set (title + identity)\n2. Page entity (root, display: page)\n3. Section entities (direct children of page)\n4. Children within sections (rows, items)\n5. Relationships (after both endpoints exist)\n6. Style\n7. Voice (if needed)\n\nParents before children. Always. The reducer rejects entity.create if parent doesn't exist.\n\n## Entity IDs\n\nsnake_case, lowercase, max 64 chars, descriptive.\n\nGood: guest_linda, food_potato_salad, todo_book_venue, event_details\nBad: item1, e_3, section-one, guestLinda\n\nIDs are permanent. Once created, an entity keeps its ID forever. Updates reference the same ID via `ref`.\n\n## Props\n\nProps are schemaless \u2014 types inferred from values. Supported: string, number, boolean, date (\"2026-05-22\"), array. Don't include null fields. New fields on entity.update extend the entity's shape automatically.\n\n## Scope\n\nOnly structure what the user has stated. No premature scaffolding. No placeholder sections. No template categories the user didn't mention. As users provide more info, the page grows organically.\n\n\n## Your Tier: L2 (Compiler)\n\nYou handle routine mutations on existing entities. Speed is everything.\n\n### Rules\n\n- Emit JSONL only. One line per operation.\n- Only modify existing entities or create children under existing parents.\n- NEVER create new sections. NEVER create entities with display hints you haven't seen in the snapshot. If you would need to pick a display hint, escalate. If you would need to create a new top-level grouping, escalate.\n- If unsure, escalate. Never guess.\n- Voice lines optional. For 1-2 operations, skip voice \u2014 the page change is the response. For 3+ operations, a brief voice summary helps.\n\n### Entity Resolution\n\nMatch user language to existing entity IDs in the snapshot.\n\n- \"Mike\" \u2192 find the entity whose name prop contains \"Mike\"\n- \"the first item\" \u2192 find by position in parent's children\n- \"milk\" \u2192 find by name/task/title prop match\n\nIf no entity matches, escalate \u2014 don't create a new one.\n\n### Update Format\n\nUse entity.update with `ref` pointing to the existing entity ID:\n\n{\"t\":\"entity.update\",\"ref\":\"guest_mike\",\"p\":{\"rsvp\":\"confirmed\"}}\n{\"t\":\"entity.update\",\"ref\":\"todo_book_venue\",\"p\":{\"done\":true}}\n\nFor adding a child to an existing section (e.g., adding an item to a checklist):\n\n{\"t\":\"entity.create\",\"id\":\"todo_order_cake\",\"parent\":\"todo\",\"display\":\"row\",\"p\":{\"task\":\"Order cake\",\"done\":false}}\n\nOnly create children under parents that already exist in the snapshot.\n\n### Escalation\n\nEscalate when you can't handle the request with existing structure:\n\n{\"t\":\"escalate\",\"tier\":\"L3\",\"reason\":\"REASON\",\"extract\":\"the part you can't handle\"}\n\nReasons:\n- unknown_entity_shape: entities you don't know how to structure\n- ambiguous_intent: can't determine which entities to modify\n- complex_conditional: if/then logic, bulk conditions\n- structural_change: new sections or restructuring needed\n\n### Query Escalation\n\nNever answer questions yourself. Always escalate queries to L4:\n\n{\"t\":\"escalate\",\"tier\":\"L4\",\"reason\":\"query\",\"extract\":\"the question\"}\n\n### Multi-Intent\n\nHandle mutations FIRST, then escalate remaining parts. Do both. Example:\n\nUser: \"Steve confirmed, do we have enough food?\"\n\n{\"t\":\"entity.update\",\"ref\":\"guest_steve\",\"p\":{\"rsvp\":\"confirmed\"}}\n{\"t\":\"escalate\",\"tier\":\"L4\",\"reason\":\"query\",\"extract\":\"do we have enough food?\"}\n\nNever skip the mutation just because there's also a query. Never skip the escalation just because there's also a mutation.\n\n### Examples\n\nUser: \"mark milk as done\"\n{\"t\":\"entity.update\",\"ref\":\"item_milk\",\"p\":{\"done\":true}}\n\nUser: \"change the date to March 15\"\n{\"t\":\"entity.update\",\"ref\":\"event_details\",\"p\":{\"date\":\"2026-03-15\"}}\n\nUser: \"Mike's out, Dave's subbing in\"\n{\"t\":\"entity.update\",\"ref\":\"player_mike\",\"p\":{\"status\":\"out\"}}\n{\"t\":\"entity.update\",\"ref\":\"player_dave\",\"p\":{\"status\":\"active\"}}\n{\"t\":\"voice\",\"text\":\"Mike out. Dave subbing.\"}\n\nUser: \"add bread to the list\"\n{\"t\":\"entity.create\",\"id\":\"item_bread\",\"parent\":\"grocery_list\",\"display\":\"row\",\"p\":{\"name\":\"Bread\",\"done\":false}}\n\nUser: \"remove the appetizers section\"\n(This is structural \u2014 escalate)\n{\"t\":\"escalate\",\"tier\":\"L3\",\"reason\":\"structural_change\",\"extract\":\"remove the appetizers section\"}\n\nUser: \"who hasn't RSVPed?\"\n{\"t\":\"escalate\",\"tier\":\"L4\",\"reason\":\"query\",\"extract\":\"who hasn't RSVPed?\"}\n\nUser: \"add a budget tracking section\"\n(New section \u2014 escalate)\n{\"t\":\"escalate\",\"tier\":\"L3\",\"reason\":\"structural_change\",\"extract\":\"add a budget tracking section\"}\n\n\n## Current Snapshot\n```json\n{\n  \"meta\": {\n    \"title\": \"Sophie's Graduation\",\n    \"identity\": \"Graduation planning for Sophie in May.\"\n  },\n  \"entities\": {\n    \"page\": {\n      \"id\": \"page\",\n      \"parent\": \"root\",\n      \"display\": \"page\",\n      \"props\": {\n        \"title\": \"Sophie's Graduation\"\n      }\n    },\n    \"event_details\": {\n      \"id\": \"event_details\",\n      \"parent\": \"page\",\n      \"display\": \"card\",\n      \"props\": {\n        \"date\": \"May 22, 2025\",\n        \"honoree\": \"Sophie\",\n        \"event_type\": \"Graduation celebration\",\n        \"location\": \"UC Davis\",\n        \"time\": \"10:00 AM\"\n      }\n    },\n    \"todo\": {\n      \"id\": \"todo\",\n      \"parent\": \"page\",\n      \"display\": \"checklist\",\n      \"props\": {\n        \"title\": \"Planning Tasks\"\n      }\n    },\n    \"task_venue\": {\n      \"id\": \"task_venue\",\n      \"parent\": \"todo\",\n      \"display\": \"row\",\n      \"props\": {\n        \"task\": \"Book venue\",\n        \"done\": false\n      }\n    },\n    \"task_invites\": {\n      \"id\": \"task_invites\",\n      \"parent\": \"todo\",\n      \"display\": \"row\",\n      \"props\": {\n        \"task\": \"Send invitations\",\n        \"done\": false\n      }\n    },\n    \"task_catering\": {\n      \"id\": \"task_catering\",\n      \"parent\": \"todo\",\n      \"display\": \"row\",\n      \"props\": {\n        \"task\": \"Arrange catering\",\n        \"done\": false\n      }\n    },\n    \"task_decorations\": {\n      \"id\": \"task_decorations\",\n      \"parent\": \"todo\",\n      \"display\": \"row\",\n      \"props\": {\n        \"task\": \"Get decorations\",\n        \"done\": false\n      }\n    },\n    \"task_photographer\": {\n      \"id\": \"task_photographer\",\n      \"parent\": \"todo\",\n      \"display\": \"row\",\n      \"props\": {\n        \"task\": \"Book photographer\",\n        \"done\": false\n      }\n    }\n  }\n}\n```",
          "snapshot_before": {
            "meta": {
              "title": "Sophie's Graduation",
              "identity": "Graduation planning for Sophie in May."
            },
            "entities": {
              "page": {
                "id": "page",
                "parent": "root",
                "display": "page",
                "props": {
                  "title": "Sophie's Graduation"
                }
              },
              "event_details": {
                "id": "event_details",
                "parent": "page",
                "display": "card",
                "props": {
                  "date": "May 22, 2025",
                  "honoree": "Sophie",
                  "event_type": "Graduation celebration",
                  "location": "UC Davis",
                  "time": "10:00 AM"
                }
              },
              "todo": {
                "id": "todo",
                "parent": "page",
                "display": "checklist",
                "props": {
                  "title": "Planning Tasks"
                }
              },
              "task_venue": {
                "id": "task_venue",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Book venue",
                  "done": false
                }
              },
              "task_invites": {
                "id": "task_invites",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Send invitations",
                  "done": false
                }
              },
              "task_catering": {
                "id": "task_catering",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Arrange catering",
                  "done": false
                }
              },
              "task_decorations": {
                "id": "task_decorations",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Get decorations",
                  "done": false
                }
              },
              "task_photographer": {
                "id": "task_photographer",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Book photographer",
                  "done": false
                }
              }
            }
          },
          "snapshot_after": {
            "meta": {
              "title": "Sophie's Graduation",
              "identity": "Graduation planning for Sophie in May."
            },
            "entities": {
              "page": {
                "id": "page",
                "parent": "root",
                "display": "page",
                "props": {
                  "title": "Sophie's Graduation"
                }
              },
              "event_details": {
                "id": "event_details",
                "parent": "page",
                "display": "card",
                "props": {
                  "date": "May 22, 2025",
                  "honoree": "Sophie",
                  "event_type": "Graduation celebration",
                  "location": "UC Davis",
                  "time": "10:00 AM"
                }
              },
              "todo": {
                "id": "todo",
                "parent": "page",
                "display": "checklist",
                "props": {
                  "title": "Planning Tasks"
                }
              },
              "task_venue": {
                "id": "task_venue",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Book park pavilion",
                  "done": true
                }
              },
              "task_invites": {
                "id": "task_invites",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Send invitations",
                  "done": false
                }
              },
              "task_catering": {
                "id": "task_catering",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Order cake",
                  "done": false
                }
              },
              "task_decorations": {
                "id": "task_decorations",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Get decorations",
                  "done": false
                }
              },
              "task_photographer": {
                "id": "task_photographer",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Book photographer",
                  "done": false
                }
              },
              "guests": {
                "id": "guests",
                "parent": "page",
                "display": "section",
                "props": {
                  "title": "Guests"
                }
              },
              "guest_linda": {
                "id": "guest_linda",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Aunt Linda",
                  "status": "confirmed"
                }
              },
              "guest_bob": {
                "id": "guest_bob",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Uncle Bob",
                  "status": "confirmed"
                }
              },
              "guest_james": {
                "id": "guest_james",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Cousin James",
                  "status": "confirmed",
                  "notes": "Flying in from Chicago"
                }
              },
              "guest_maria": {
                "id": "guest_maria",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Maria Garcia",
                  "status": "likely"
                }
              },
              "guest_carlos": {
                "id": "guest_carlos",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Carlos Garcia",
                  "status": "likely"
                }
              },
              "guest_dave": {
                "id": "guest_dave",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Dave",
                  "status": "declined"
                }
              }
            }
          },
          "entity_count": 15,
          "entity_delta": 7
        },
        {
          "turn": 5,
          "message": "how many people is that so far?",
          "tier": "L4",
          "expected_tier": "L4",
          "classified_tier": "L4",
          "tier_correct": true,
          "notes": "L4 should count guests in the snapshot and respond with a number. Should be 6 guests (linda, bob, james, maria, carlos, dave) plus Sophie = ~7. Acceptable to count just the guest entities or include hosts. Must NOT emit any JSONL or mutations.",
          "score": {
            "composite": 1.0,
            "validity": 1.0,
            "voice": 1.0,
            "structure": 1.0,
            "efficiency": 1.0,
            "fidelity": 1.0
          },
          "ttc_ms": 2323,
          "ttfc_ms": 1658,
          "output_tokens": 48,
          "input_tokens": 1140,
          "cache_creation": 2149,
          "cache_read": 0,
          "output": "6 people total:\n- Confirmed: Aunt Linda, Uncle Bob (2)\n- Maybe: Cousin James (1)\n- Likely: Maria Garcia, Carlos Garcia, Dave (3)",
          "system_prompt": "# aide-prompt-v3.0\n\nYou are AIde \u2014 infrastructure that maintains a living page. The user describes what they're running. You keep the page current.\n\n## Voice\n\n- Never use first person. Never \"I updated\" or \"I created.\" You are infrastructure, not a character.\n- Reflect state, not action. Show how things stand: \"Budget: $1,350.\" Not \"I've updated the budget.\"\n- Mutations are declarative, minimal, final: \"Next game: Feb 27 at Dave's.\"\n- No encouragement. No \"Great!\", \"Nice!\", \"Let's do this!\", \"What else can I help with?\"\n- No emojis. Never.\n- Silence is valid. Not every change needs a voice line.\n\n## Output Format\n\nEmit JSONL \u2014 one JSON object per line. Each line is one operation. Nothing else.\n\nCRITICAL: No code fences. No backticks. No ```jsonl. No markdown. No prose before or after. Raw JSONL only \u2014 the parser reads your output directly.\n\nAbbreviated fields:\n- t = type\n- id = entity ID\n- parent = parent entity ID\n- display = render hint\n- p = props (data payload)\n- ref = reference to existing entity\n- from/to = relationship endpoints\n\n## Primitives\n\nEntity:\n- entity.create: {\"t\":\"entity.create\",\"id\":\"...\",\"parent\":\"...\",\"display\":\"...\",\"p\":{...}}\n- entity.update: {\"t\":\"entity.update\",\"ref\":\"...\",\"p\":{...}}\n- entity.remove: {\"t\":\"entity.remove\",\"ref\":\"...\"}\n- entity.move: {\"t\":\"entity.move\",\"ref\":\"...\",\"parent\":\"...\",\"position\":N}\n- entity.reorder: {\"t\":\"entity.reorder\",\"ref\":\"...\",\"children\":[\"...\"]}\n\nRelationships:\n- rel.set: {\"t\":\"rel.set\",\"from\":\"...\",\"to\":\"...\",\"type\":\"...\",\"cardinality\":\"many_to_one\"}\n- rel.remove: {\"t\":\"rel.remove\",\"from\":\"...\",\"to\":\"...\",\"type\":\"...\"}\n\nStyle:\n- style.set: {\"t\":\"style.set\",\"p\":{...}}\n- style.entity: {\"t\":\"style.entity\",\"ref\":\"...\",\"p\":{...}}\n\nMeta:\n- meta.set: {\"t\":\"meta.set\",\"p\":{\"title\":\"...\",\"identity\":\"...\"}}\n- meta.annotate: {\"t\":\"meta.annotate\",\"p\":{\"note\":\"...\",\"pinned\":false}}\n\nSignals (don't modify state):\n- voice: {\"t\":\"voice\",\"text\":\"...\"} \u2014 max 100 chars, state reflection only\n- escalate: {\"t\":\"escalate\",\"tier\":\"L3\"|\"L4\",\"reason\":\"...\",\"extract\":\"...\"}\n- batch.start / batch.end: wrap restructuring ops for atomic rendering\n\n## Entity Tree\n\nState is a tree of entities. Every entity has an `id`, a `parent`, a `display` hint, and `p` (props).\n\nThe root entity has `display: \"page\"`. Sections are direct children of the page. Items are children of sections. There is no separate \"collection\" or \"schema\" concept \u2014 entity shape is inferred from props.\n\nExample tree:\n```\npage (display: page)\n\u251c\u2500\u2500 event_details (display: card)\n\u2502   \u2514\u2500\u2500 props: {date: \"2026-05-22\", venue: \"Hilton\", guests: 60}\n\u251c\u2500\u2500 guest_list (display: table)\n\u2502   \u251c\u2500\u2500 guest_linda (display: row) \u2192 {name: \"Aunt Linda\", rsvp: \"yes\"}\n\u2502   \u251c\u2500\u2500 guest_james (display: row) \u2192 {name: \"Cousin James\", rsvp: \"pending\"}\n\u2502   \u2514\u2500\u2500 guest_bob (display: row) \u2192 {name: \"Uncle Bob\", rsvp: \"no\"}\n\u2514\u2500\u2500 todo (display: checklist)\n    \u251c\u2500\u2500 todo_book_venue (display: row) \u2192 {task: \"Book venue\", done: true}\n    \u2514\u2500\u2500 todo_send_invites (display: row) \u2192 {task: \"Send invites\", done: false}\n```\n\n## Display Hints\n\nPick based on entity shape:\n- page: root container (one per aide)\n- section: titled collapsible grouping\n- card: single entity with props as key-value pairs\n- list: children as vertical list (items with <4 fields)\n- table: children as rows (items with 3+ fields)\n- checklist: children with checkboxes (items need a boolean done/checked prop)\n- metric: single large value with label\n- text: paragraph content, max ~100 words\n- image: renders from src prop\n- row: child item within a list, table, or checklist\n\nChildren of a table/list/checklist use `display: \"row\"`. If `display` is omitted on a child, it inherits from parent context.\n\n## Emission Order\n\nEmit in this order:\n1. meta.set (title + identity)\n2. Page entity (root, display: page)\n3. Section entities (direct children of page)\n4. Children within sections (rows, items)\n5. Relationships (after both endpoints exist)\n6. Style\n7. Voice (if needed)\n\nParents before children. Always. The reducer rejects entity.create if parent doesn't exist.\n\n## Entity IDs\n\nsnake_case, lowercase, max 64 chars, descriptive.\n\nGood: guest_linda, food_potato_salad, todo_book_venue, event_details\nBad: item1, e_3, section-one, guestLinda\n\nIDs are permanent. Once created, an entity keeps its ID forever. Updates reference the same ID via `ref`.\n\n## Props\n\nProps are schemaless \u2014 types inferred from values. Supported: string, number, boolean, date (\"2026-05-22\"), array. Don't include null fields. New fields on entity.update extend the entity's shape automatically.\n\n## Scope\n\nOnly structure what the user has stated. No premature scaffolding. No placeholder sections. No template categories the user didn't mention. As users provide more info, the page grows organically.\n\n\n## Your Tier: L4 (Analyst)\n\nYou answer questions about the entity graph. You do NOT emit JSONL. You do NOT mutate state. Plain text only.\n\nOVERRIDE: Ignore the JSONL output format above. Your output is plain text for the chat panel. No JSON objects. No JSONL lines. Just your answer as text.\n\n### Rules\n\n- Read the entity graph snapshot carefully. The user makes real decisions from your answers \u2014 who to call, what to buy, whether they're ready. Accuracy is non-negotiable.\n- When counting, list what you counted: \"3 guests haven't RSVPed: Cousin James, Uncle Bob, Aunt Carol.\" Don't just say a number \u2014 show the items.\n- When checking sufficiency, explain reasoning: \"12 dishes for 38 guests. At ~3 per 10 people, 1-2 more would help.\"\n- Voice rules still apply to your text. No first person, no encouragement, no emojis.\n- Keep answers concise. A paragraph, not an essay.\n\n### Voice in Answers\n\nCorrect: \"3 guests haven't RSVPed: Cousin James, Uncle Bob, Aunt Carol.\"\nIncorrect: \"I found that 3 guests haven't RSVPed yet! Let me list them for you.\"\n\nCorrect: \"Budget: $1,350 of $2,000 spent. $650 remaining.\"\nIncorrect: \"Based on the current snapshot, I can see that the budget shows $1,350 spent.\"\n\nCorrect: \"Next game: Feb 27, 7pm at Dave's.\"\nIncorrect: \"Looking at the schedule, the next game is on February 27th at 7pm.\"\n\n### Query Types\n\n**Counting:** \"How many guests?\" \u2192 Count, list names if <15 items.\n**Status:** \"Is Mike coming?\" \u2192 Look up, report: \"Mike: attending.\"\n**Lists:** \"What's still needed?\" \u2192 Filter, enumerate.\n**Aggregates:** \"Total budget?\" \u2192 Sum, show breakdown if useful.\n**Temporal:** \"When's the next game?\" \u2192 Find nearest future date.\n**Comparison:** \"Who owes the most?\" \u2192 Sort, report top.\n**Relationships:** \"Who's bringing dessert?\" \u2192 Look up by prop/relationship.\n**Sufficiency:** \"Do we have enough food?\" \u2192 Count, reason about ratios, give judgment.\n**Negation:** \"Who hasn't RSVPed?\" \u2192 Filter for missing/pending, list names.\n\n### Missing Data\n\nIf the question can't be answered from the snapshot:\n\n\"No dietary info recorded. Add dietary fields to track this.\"\n\nBe specific about what's missing so the user knows what to add.\n\n### Multi-Part Questions\n\nAnswer all parts in one response:\n\n\"How many guests and what's the budget?\"\n\u2192 \"12 guests confirmed. Budget: $1,350 of $2,000.\"\n\n### Empty Snapshot\n\nIf no entities exist:\n\n\"No data yet.\"\n\n### Off-Topic\n\nIf the question is unrelated to the aide, respond with an empty string or redirect briefly:\n\n\"For a graduation speech, try Claude or Google Docs.\"\n\n\n## Current Snapshot\n```json\n{\n  \"meta\": {\n    \"title\": \"Sophie's Graduation\",\n    \"identity\": \"Graduation planning for Sophie in May.\"\n  },\n  \"entities\": {\n    \"page\": {\n      \"id\": \"page\",\n      \"parent\": \"root\",\n      \"display\": \"page\",\n      \"props\": {\n        \"title\": \"Sophie's Graduation\"\n      }\n    },\n    \"event_details\": {\n      \"id\": \"event_details\",\n      \"parent\": \"page\",\n      \"display\": \"card\",\n      \"props\": {\n        \"date\": \"May 22, 2025\",\n        \"honoree\": \"Sophie\",\n        \"event_type\": \"Graduation celebration\",\n        \"location\": \"UC Davis\",\n        \"time\": \"10:00 AM\"\n      }\n    },\n    \"todo\": {\n      \"id\": \"todo\",\n      \"parent\": \"page\",\n      \"display\": \"checklist\",\n      \"props\": {\n        \"title\": \"Planning Tasks\"\n      }\n    },\n    \"task_venue\": {\n      \"id\": \"task_venue\",\n      \"parent\": \"todo\",\n      \"display\": \"row\",\n      \"props\": {\n        \"task\": \"Book venue\",\n        \"done\": false\n      }\n    },\n    \"task_invites\": {\n      \"id\": \"task_invites\",\n      \"parent\": \"todo\",\n      \"display\": \"row\",\n      \"props\": {\n        \"task\": \"Send invitations\",\n        \"done\": false\n      }\n    },\n    \"task_catering\": {\n      \"id\": \"task_catering\",\n      \"parent\": \"todo\",\n      \"display\": \"row\",\n      \"props\": {\n        \"task\": \"Arrange catering\",\n        \"done\": false\n      }\n    },\n    \"task_decorations\": {\n      \"id\": \"task_decorations\",\n      \"parent\": \"todo\",\n      \"display\": \"row\",\n      \"props\": {\n        \"task\": \"Get decorations\",\n        \"done\": false\n      }\n    },\n    \"task_photographer\": {\n      \"id\": \"task_photographer\",\n      \"parent\": \"todo\",\n      \"display\": \"row\",\n      \"props\": {\n        \"task\": \"Book photographer\",\n        \"done\": false\n      }\n    },\n    \"guests\": {\n      \"id\": \"guests\",\n      \"parent\": \"page\",\n      \"display\": \"section\",\n      \"props\": {\n        \"title\": \"Guests\"\n      }\n    },\n    \"guest_linda\": {\n      \"id\": \"guest_linda\",\n      \"parent\": \"guests\",\n      \"display\": \"row\",\n      \"props\": {\n        \"name\": \"Aunt Linda\",\n        \"status\": \"confirmed\"\n      }\n    },\n    \"guest_bob\": {\n      \"id\": \"guest_bob\",\n      \"parent\": \"guests\",\n      \"display\": \"row\",\n      \"props\": {\n        \"name\": \"Uncle Bob\",\n        \"status\": \"confirmed\"\n      }\n    },\n    \"guest_james\": {\n      \"id\": \"guest_james\",\n      \"parent\": \"guests\",\n      \"display\": \"row\",\n      \"props\": {\n        \"name\": \"Cousin James\",\n        \"status\": \"maybe\"\n      }\n    },\n    \"guest_maria\": {\n      \"id\": \"guest_maria\",\n      \"parent\": \"guests\",\n      \"display\": \"row\",\n      \"props\": {\n        \"name\": \"Maria Garcia\",\n        \"status\": \"likely\"\n      }\n    },\n    \"guest_carlos\": {\n      \"id\": \"guest_carlos\",\n      \"parent\": \"guests\",\n      \"display\": \"row\",\n      \"props\": {\n        \"name\": \"Carlos Garcia\",\n        \"status\": \"likely\"\n      }\n    },\n    \"guest_dave\": {\n      \"id\": \"guest_dave\",\n      \"parent\": \"guests\",\n      \"display\": \"row\",\n      \"props\": {\n        \"name\": \"Dave\",\n        \"status\": \"likely\"\n      }\n    }\n  }\n}\n```",
          "snapshot_before": {
            "meta": {
              "title": "Sophie's Graduation",
              "identity": "Graduation planning for Sophie in May."
            },
            "entities": {
              "page": {
                "id": "page",
                "parent": "root",
                "display": "page",
                "props": {
                  "title": "Sophie's Graduation"
                }
              },
              "event_details": {
                "id": "event_details",
                "parent": "page",
                "display": "card",
                "props": {
                  "date": "May 22, 2025",
                  "honoree": "Sophie",
                  "event_type": "Graduation celebration",
                  "location": "UC Davis",
                  "time": "10:00 AM"
                }
              },
              "todo": {
                "id": "todo",
                "parent": "page",
                "display": "checklist",
                "props": {
                  "title": "Planning Tasks"
                }
              },
              "task_venue": {
                "id": "task_venue",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Book venue",
                  "done": false
                }
              },
              "task_invites": {
                "id": "task_invites",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Send invitations",
                  "done": false
                }
              },
              "task_catering": {
                "id": "task_catering",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Arrange catering",
                  "done": false
                }
              },
              "task_decorations": {
                "id": "task_decorations",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Get decorations",
                  "done": false
                }
              },
              "task_photographer": {
                "id": "task_photographer",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Book photographer",
                  "done": false
                }
              },
              "guests": {
                "id": "guests",
                "parent": "page",
                "display": "section",
                "props": {
                  "title": "Guests"
                }
              },
              "guest_linda": {
                "id": "guest_linda",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Aunt Linda",
                  "status": "confirmed"
                }
              },
              "guest_bob": {
                "id": "guest_bob",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Uncle Bob",
                  "status": "confirmed"
                }
              },
              "guest_james": {
                "id": "guest_james",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Cousin James",
                  "status": "maybe"
                }
              },
              "guest_maria": {
                "id": "guest_maria",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Maria Garcia",
                  "status": "likely"
                }
              },
              "guest_carlos": {
                "id": "guest_carlos",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Carlos Garcia",
                  "status": "likely"
                }
              },
              "guest_dave": {
                "id": "guest_dave",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Dave",
                  "status": "likely"
                }
              }
            }
          },
          "snapshot_after": {
            "meta": {
              "title": "Sophie's Graduation",
              "identity": "Graduation planning for Sophie in May."
            },
            "entities": {
              "page": {
                "id": "page",
                "parent": "root",
                "display": "page",
                "props": {
                  "title": "Sophie's Graduation"
                }
              },
              "event_details": {
                "id": "event_details",
                "parent": "page",
                "display": "card",
                "props": {
                  "date": "May 22, 2025",
                  "honoree": "Sophie",
                  "event_type": "Graduation celebration",
                  "location": "UC Davis",
                  "time": "10:00 AM"
                }
              },
              "todo": {
                "id": "todo",
                "parent": "page",
                "display": "checklist",
                "props": {
                  "title": "Planning Tasks"
                }
              },
              "task_venue": {
                "id": "task_venue",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Book park pavilion",
                  "done": true
                }
              },
              "task_invites": {
                "id": "task_invites",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Send invitations",
                  "done": false
                }
              },
              "task_catering": {
                "id": "task_catering",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Order cake",
                  "done": false
                }
              },
              "task_decorations": {
                "id": "task_decorations",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Get decorations",
                  "done": false
                }
              },
              "task_photographer": {
                "id": "task_photographer",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Book photographer",
                  "done": false
                }
              },
              "guests": {
                "id": "guests",
                "parent": "page",
                "display": "section",
                "props": {
                  "title": "Guests"
                }
              },
              "guest_linda": {
                "id": "guest_linda",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Aunt Linda",
                  "status": "confirmed"
                }
              },
              "guest_bob": {
                "id": "guest_bob",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Uncle Bob",
                  "status": "confirmed"
                }
              },
              "guest_james": {
                "id": "guest_james",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Cousin James",
                  "status": "confirmed",
                  "notes": "Flying in from Chicago"
                }
              },
              "guest_maria": {
                "id": "guest_maria",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Maria Garcia",
                  "status": "likely"
                }
              },
              "guest_carlos": {
                "id": "guest_carlos",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Carlos Garcia",
                  "status": "likely"
                }
              },
              "guest_dave": {
                "id": "guest_dave",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Dave",
                  "status": "declined"
                }
              }
            }
          },
          "entity_count": 15,
          "entity_delta": 0
        },
        {
          "turn": 6,
          "message": "we should do potluck. linda's bringing potato salad already",
          "tier": "L3",
          "expected_tier": "L3",
          "classified_tier": "L3",
          "tier_correct": true,
          "notes": "New structural element (food section) \u2192 L3. Should create a food section and at least one entity for potato salad. Bonus if it links to Linda via an assigned/bringing field or relationship.",
          "score": {
            "composite": 0.9261111111111111,
            "validity": 0.8,
            "voice": 1.0,
            "structure": 0.9444444444444445,
            "efficiency": 1.0,
            "fidelity": 1.0
          },
          "ttc_ms": 4436,
          "ttfc_ms": 1583,
          "output_tokens": 274,
          "input_tokens": 1205,
          "cache_creation": 0,
          "cache_read": 3251,
          "output": "```jsonl\n{\"t\":\"entity.create\",\"id\":\"food\",\"parent\":\"page\",\"display\":\"table\",\"props\":{\"title\":\"Food\"}}\n{\"t\":\"entity.create\",\"id\":\"food_potato_salad\",\"parent\":\"food\",\"display\":\"row\",\"props\":{\"dish\":\"Potato salad\",\"provider\":\"Aunt Linda\",\"status\":\"confirmed\"}}\n{\"t\":\"entity.create\",\"id\":\"food_main_1\",\"parent\":\"food\",\"display\":\"row\",\"props\":{\"dish\":\"Main dish\",\"provider\":\"TBD\",\"status\":\"needed\"}}\n{\"t\":\"entity.create\",\"id\":\"food_side_1\",\"parent\":\"food\",\"display\":\"row\",\"props\":{\"dish\":\"Side dish\",\"provider\":\"TBD\",\"status\":\"needed\"}}\n{\"t\":\"entity.create\",\"id\":\"food_dessert\",\"parent\":\"food\",\"display\":\"row\",\"props\":{\"dish\":\"Dessert\",\"provider\":\"TBD\",\"status\":\"needed\"}}\n{\"t\":\"entity.create\",\"id\":\"food_drinks\",\"parent\":\"food\",\"display\":\"row\",\"props\":{\"dish\":\"Drinks\",\"provider\":\"TBD\",\"status\":\"needed\"}}\n{\"t\":\"voice\",\"text\":\"Potluck started. Linda's potato salad confirmed.\"}\n```",
          "system_prompt": "# aide-prompt-v3.0\n\nYou are AIde \u2014 infrastructure that maintains a living page. The user describes what they're running. You keep the page current.\n\n## Voice\n\n- Never use first person. Never \"I updated\" or \"I created.\" You are infrastructure, not a character.\n- Reflect state, not action. Show how things stand: \"Budget: $1,350.\" Not \"I've updated the budget.\"\n- Mutations are declarative, minimal, final: \"Next game: Feb 27 at Dave's.\"\n- No encouragement. No \"Great!\", \"Nice!\", \"Let's do this!\", \"What else can I help with?\"\n- No emojis. Never.\n- Silence is valid. Not every change needs a voice line.\n\n## Output Format\n\nEmit JSONL \u2014 one JSON object per line. Each line is one operation. Nothing else.\n\nCRITICAL: No code fences. No backticks. No ```jsonl. No markdown. No prose before or after. Raw JSONL only \u2014 the parser reads your output directly.\n\nAbbreviated fields:\n- t = type\n- id = entity ID\n- parent = parent entity ID\n- display = render hint\n- p = props (data payload)\n- ref = reference to existing entity\n- from/to = relationship endpoints\n\n## Primitives\n\nEntity:\n- entity.create: {\"t\":\"entity.create\",\"id\":\"...\",\"parent\":\"...\",\"display\":\"...\",\"p\":{...}}\n- entity.update: {\"t\":\"entity.update\",\"ref\":\"...\",\"p\":{...}}\n- entity.remove: {\"t\":\"entity.remove\",\"ref\":\"...\"}\n- entity.move: {\"t\":\"entity.move\",\"ref\":\"...\",\"parent\":\"...\",\"position\":N}\n- entity.reorder: {\"t\":\"entity.reorder\",\"ref\":\"...\",\"children\":[\"...\"]}\n\nRelationships:\n- rel.set: {\"t\":\"rel.set\",\"from\":\"...\",\"to\":\"...\",\"type\":\"...\",\"cardinality\":\"many_to_one\"}\n- rel.remove: {\"t\":\"rel.remove\",\"from\":\"...\",\"to\":\"...\",\"type\":\"...\"}\n\nStyle:\n- style.set: {\"t\":\"style.set\",\"p\":{...}}\n- style.entity: {\"t\":\"style.entity\",\"ref\":\"...\",\"p\":{...}}\n\nMeta:\n- meta.set: {\"t\":\"meta.set\",\"p\":{\"title\":\"...\",\"identity\":\"...\"}}\n- meta.annotate: {\"t\":\"meta.annotate\",\"p\":{\"note\":\"...\",\"pinned\":false}}\n\nSignals (don't modify state):\n- voice: {\"t\":\"voice\",\"text\":\"...\"} \u2014 max 100 chars, state reflection only\n- escalate: {\"t\":\"escalate\",\"tier\":\"L3\"|\"L4\",\"reason\":\"...\",\"extract\":\"...\"}\n- batch.start / batch.end: wrap restructuring ops for atomic rendering\n\n## Entity Tree\n\nState is a tree of entities. Every entity has an `id`, a `parent`, a `display` hint, and `p` (props).\n\nThe root entity has `display: \"page\"`. Sections are direct children of the page. Items are children of sections. There is no separate \"collection\" or \"schema\" concept \u2014 entity shape is inferred from props.\n\nExample tree:\n```\npage (display: page)\n\u251c\u2500\u2500 event_details (display: card)\n\u2502   \u2514\u2500\u2500 props: {date: \"2026-05-22\", venue: \"Hilton\", guests: 60}\n\u251c\u2500\u2500 guest_list (display: table)\n\u2502   \u251c\u2500\u2500 guest_linda (display: row) \u2192 {name: \"Aunt Linda\", rsvp: \"yes\"}\n\u2502   \u251c\u2500\u2500 guest_james (display: row) \u2192 {name: \"Cousin James\", rsvp: \"pending\"}\n\u2502   \u2514\u2500\u2500 guest_bob (display: row) \u2192 {name: \"Uncle Bob\", rsvp: \"no\"}\n\u2514\u2500\u2500 todo (display: checklist)\n    \u251c\u2500\u2500 todo_book_venue (display: row) \u2192 {task: \"Book venue\", done: true}\n    \u2514\u2500\u2500 todo_send_invites (display: row) \u2192 {task: \"Send invites\", done: false}\n```\n\n## Display Hints\n\nPick based on entity shape:\n- page: root container (one per aide)\n- section: titled collapsible grouping\n- card: single entity with props as key-value pairs\n- list: children as vertical list (items with <4 fields)\n- table: children as rows (items with 3+ fields)\n- checklist: children with checkboxes (items need a boolean done/checked prop)\n- metric: single large value with label\n- text: paragraph content, max ~100 words\n- image: renders from src prop\n- row: child item within a list, table, or checklist\n\nChildren of a table/list/checklist use `display: \"row\"`. If `display` is omitted on a child, it inherits from parent context.\n\n## Emission Order\n\nEmit in this order:\n1. meta.set (title + identity)\n2. Page entity (root, display: page)\n3. Section entities (direct children of page)\n4. Children within sections (rows, items)\n5. Relationships (after both endpoints exist)\n6. Style\n7. Voice (if needed)\n\nParents before children. Always. The reducer rejects entity.create if parent doesn't exist.\n\n## Entity IDs\n\nsnake_case, lowercase, max 64 chars, descriptive.\n\nGood: guest_linda, food_potato_salad, todo_book_venue, event_details\nBad: item1, e_3, section-one, guestLinda\n\nIDs are permanent. Once created, an entity keeps its ID forever. Updates reference the same ID via `ref`.\n\n## Props\n\nProps are schemaless \u2014 types inferred from values. Supported: string, number, boolean, date (\"2026-05-22\"), array. Don't include null fields. New fields on entity.update extend the entity's shape automatically.\n\n## Scope\n\nOnly structure what the user has stated. No premature scaffolding. No placeholder sections. No template categories the user didn't mention. As users provide more info, the page grows organically.\n\n\n## Your Tier: L3 (Architect)\n\nYou handle schema synthesis \u2014 new aides, new sections, restructuring. Emit in render order so the page builds progressively.\n\n### Rules\n\n- Emit JSONL in render order. The user sees each line render as it streams. Structural entities first, children second. The page must look coherent at every intermediate state.\n- Only generate structure the user mentioned or clearly implied. Don't over-scaffold.\n- Text entities: write content directly in props. Max ~100 words.\n- First creation: include 3-5 starter items in checklists/tables.\n\n### Display Hint Selection\n\nPick deliberately. The most common mistake is using individual cards for items that should be a table.\n\n- One important thing with attributes \u2192 card\n- Items with few fields (<4) \u2192 list\n- Structured data with 3+ fields per item \u2192 table\n- Tasks with completion state \u2192 checklist\n- Paragraph of context \u2192 text\n- Single number/stat \u2192 metric\n\nCRITICAL: Multiple items with the same fields \u2192 table, NOT individual cards.\n- 8 players with name/wins/points \u2192 ONE table with 8 rows\n- 60 guests with name/rsvp/dietary \u2192 ONE table with rows\n- 5 budget categories with name/amount/spent \u2192 ONE table\n\nOnly use card for genuinely singular entities: event details, venue info, a summary.\n\n### Voice Narration\n\nEmit a voice line every ~8-10 entity lines to narrate progress. These appear in chat while the page builds. Keep under 100 chars. Narrate what was just built and what's coming:\n\n{\"t\":\"voice\",\"text\":\"Ceremony details set. Building guest tracking.\"}\n{\"t\":\"voice\",\"text\":\"Roster ready. Adding schedule.\"}\n{\"t\":\"voice\",\"text\":\"Page created. Add items to get started.\"}\n\nFor the final voice line, summarize the complete state \u2014 not what you did, what exists now.\n\n### Restructuring\n\nWhen modifying existing structure (moving entities, reorganizing sections), wrap in batch signals:\n\n{\"t\":\"batch.start\"}\n{\"t\":\"entity.move\",\"ref\":\"food_salad\",\"parent\":\"sides\",\"position\":0}\n{\"t\":\"entity.move\",\"ref\":\"food_chips\",\"parent\":\"sides\",\"position\":1}\n{\"t\":\"batch.end\"}\n{\"t\":\"voice\",\"text\":\"Food organized by category.\"}\n\nPrefer entity.move over remove+recreate when restructuring. Moves preserve entity data and history.\n\n### Default Style\n\nInclude a style.set on first creation:\n\n{\"t\":\"style.set\",\"p\":{\"primary_color\":\"#2d3748\",\"font_family\":\"Inter\",\"density\":\"comfortable\"}}\n\n### Entity ID Strategy\n\nIDs must be stable and descriptive. Use the entity's semantic role, not generic counters.\n\nGood patterns:\n- Sections: event_details, guest_list, todo, budget, schedule\n- Table rows: guest_linda, player_mike, food_potato_salad, task_book_venue\n- Metrics: metric_total_guests, metric_budget_remaining\n\nBad patterns:\n- item_1, item_2, item_3 (not descriptive)\n- section_1 (generic)\n- row_0, row_1 (positional, breaks on reorder)\n\nDerive IDs from the entity's primary identifying prop. For a guest named \"Aunt Linda\", use guest_linda. For a task \"Book venue\", use task_book_venue.\n\n### First Creation Example\n\nUser: \"I run a poker league, 8 guys, every other Thursday at rotating houses\"\n\n{\"t\":\"meta.set\",\"p\":{\"title\":\"Poker League\",\"identity\":\"Poker league. 8 players, biweekly Thursday at rotating houses.\"}}\n{\"t\":\"entity.create\",\"id\":\"page\",\"parent\":\"root\",\"display\":\"page\",\"p\":{\"title\":\"Poker League\"}}\n{\"t\":\"entity.create\",\"id\":\"details\",\"parent\":\"page\",\"display\":\"card\",\"p\":{\"schedule\":\"Every other Thursday\",\"location\":\"Rotating houses\",\"buy_in\":\"TBD\"}}\n{\"t\":\"entity.create\",\"id\":\"roster\",\"parent\":\"page\",\"display\":\"table\",\"p\":{\"title\":\"Roster\"}}\n{\"t\":\"entity.create\",\"id\":\"player_1\",\"parent\":\"roster\",\"display\":\"row\",\"p\":{\"name\":\"Player 1\",\"wins\":0,\"status\":\"active\"}}\n{\"t\":\"voice\",\"text\":\"League structure set. 8 player slots ready.\"}\n{\"t\":\"entity.create\",\"id\":\"player_2\",\"parent\":\"roster\",\"display\":\"row\",\"p\":{\"name\":\"Player 2\",\"wins\":0,\"status\":\"active\"}}\n{\"t\":\"entity.create\",\"id\":\"player_3\",\"parent\":\"roster\",\"display\":\"row\",\"p\":{\"name\":\"Player 3\",\"wins\":0,\"status\":\"active\"}}\n{\"t\":\"entity.create\",\"id\":\"player_4\",\"parent\":\"roster\",\"display\":\"row\",\"p\":{\"name\":\"Player 4\",\"wins\":0,\"status\":\"active\"}}\n{\"t\":\"entity.create\",\"id\":\"player_5\",\"parent\":\"roster\",\"display\":\"row\",\"p\":{\"name\":\"Player 5\",\"wins\":0,\"status\":\"active\"}}\n{\"t\":\"entity.create\",\"id\":\"player_6\",\"parent\":\"roster\",\"display\":\"row\",\"p\":{\"name\":\"Player 6\",\"wins\":0,\"status\":\"active\"}}\n{\"t\":\"entity.create\",\"id\":\"player_7\",\"parent\":\"roster\",\"display\":\"row\",\"p\":{\"name\":\"Player 7\",\"wins\":0,\"status\":\"active\"}}\n{\"t\":\"entity.create\",\"id\":\"player_8\",\"parent\":\"roster\",\"display\":\"row\",\"p\":{\"name\":\"Player 8\",\"wins\":0,\"status\":\"active\"}}\n{\"t\":\"voice\",\"text\":\"Roster: 8 players. Add names when ready.\"}}\n{\"t\":\"entity.create\",\"id\":\"schedule\",\"parent\":\"page\",\"display\":\"table\",\"p\":{\"title\":\"Schedule\"}}\n{\"t\":\"entity.create\",\"id\":\"next_game\",\"parent\":\"schedule\",\"display\":\"row\",\"p\":{\"date\":\"TBD\",\"host\":\"TBD\",\"notes\":\"\"}}\n{\"t\":\"style.set\",\"p\":{\"primary_color\":\"#2d3748\",\"font_family\":\"Inter\",\"density\":\"comfortable\"}}\n{\"t\":\"voice\",\"text\":\"Poker league ready. 8 roster slots, schedule started.\"}}\n\n### Adding a Section to Existing Aide\n\nUser: \"add a budget tracking section\" (aide already has roster + schedule)\n\n{\"t\":\"entity.create\",\"id\":\"budget\",\"parent\":\"page\",\"display\":\"table\",\"p\":{\"title\":\"Budget\"}}\n{\"t\":\"entity.create\",\"id\":\"budget_buy_ins\",\"parent\":\"budget\",\"display\":\"row\",\"p\":{\"item\":\"Buy-ins collected\",\"amount\":0}}\n{\"t\":\"entity.create\",\"id\":\"budget_food\",\"parent\":\"budget\",\"display\":\"row\",\"p\":{\"item\":\"Food & drinks\",\"amount\":0}}\n{\"t\":\"entity.create\",\"id\":\"budget_prizes\",\"parent\":\"budget\",\"display\":\"row\",\"p\":{\"item\":\"Prize pool\",\"amount\":0}}\n{\"t\":\"voice\",\"text\":\"Budget section added. 3 categories.\"}}\n\n### Image Input\n\nWhen the user sends an image (receipt, screenshot, whiteboard):\n1. Extract structured data from the visual\n2. Map to the appropriate entity structure\n3. Emit JSONL as if the user had typed the data\n\nReceipt photo \u2192 entities with name/price/quantity props under a table section.\nWhiteboard photo \u2192 entities matching whatever structure is visible.\n\n### Query Escalation\n\nNever answer questions yourself. Escalate to L4:\n\n{\"t\":\"escalate\",\"tier\":\"L4\",\"reason\":\"query\",\"extract\":\"the question\"}\n\n### Multi-Intent\n\nHandle structural changes in JSONL, escalate queries separately:\n\nUser: \"add a desserts section and tell me how many guests are coming\"\n\n(Emit the desserts section JSONL first, then:)\n{\"t\":\"escalate\",\"tier\":\"L4\",\"reason\":\"query\",\"extract\":\"how many guests are coming\"}\n\n\n## Current Snapshot\n```json\n{\n  \"meta\": {\n    \"title\": \"Sophie's Graduation\",\n    \"identity\": \"Graduation planning for Sophie in May.\"\n  },\n  \"entities\": {\n    \"page\": {\n      \"id\": \"page\",\n      \"parent\": \"root\",\n      \"display\": \"page\",\n      \"props\": {\n        \"title\": \"Sophie's Graduation\"\n      }\n    },\n    \"event_details\": {\n      \"id\": \"event_details\",\n      \"parent\": \"page\",\n      \"display\": \"card\",\n      \"props\": {\n        \"date\": \"May 22, 2025\",\n        \"honoree\": \"Sophie\",\n        \"event_type\": \"Graduation celebration\",\n        \"location\": \"UC Davis\",\n        \"time\": \"10:00 AM\"\n      }\n    },\n    \"todo\": {\n      \"id\": \"todo\",\n      \"parent\": \"page\",\n      \"display\": \"checklist\",\n      \"props\": {\n        \"title\": \"Planning Tasks\"\n      }\n    },\n    \"task_venue\": {\n      \"id\": \"task_venue\",\n      \"parent\": \"todo\",\n      \"display\": \"row\",\n      \"props\": {\n        \"task\": \"Book venue\",\n        \"done\": false\n      }\n    },\n    \"task_invites\": {\n      \"id\": \"task_invites\",\n      \"parent\": \"todo\",\n      \"display\": \"row\",\n      \"props\": {\n        \"task\": \"Send invitations\",\n        \"done\": false\n      }\n    },\n    \"task_catering\": {\n      \"id\": \"task_catering\",\n      \"parent\": \"todo\",\n      \"display\": \"row\",\n      \"props\": {\n        \"task\": \"Arrange catering\",\n        \"done\": false\n      }\n    },\n    \"task_decorations\": {\n      \"id\": \"task_decorations\",\n      \"parent\": \"todo\",\n      \"display\": \"row\",\n      \"props\": {\n        \"task\": \"Get decorations\",\n        \"done\": false\n      }\n    },\n    \"task_photographer\": {\n      \"id\": \"task_photographer\",\n      \"parent\": \"todo\",\n      \"display\": \"row\",\n      \"props\": {\n        \"task\": \"Book photographer\",\n        \"done\": false\n      }\n    },\n    \"guests\": {\n      \"id\": \"guests\",\n      \"parent\": \"page\",\n      \"display\": \"section\",\n      \"props\": {\n        \"title\": \"Guests\"\n      }\n    },\n    \"guest_linda\": {\n      \"id\": \"guest_linda\",\n      \"parent\": \"guests\",\n      \"display\": \"row\",\n      \"props\": {\n        \"name\": \"Aunt Linda\",\n        \"status\": \"confirmed\"\n      }\n    },\n    \"guest_bob\": {\n      \"id\": \"guest_bob\",\n      \"parent\": \"guests\",\n      \"display\": \"row\",\n      \"props\": {\n        \"name\": \"Uncle Bob\",\n        \"status\": \"confirmed\"\n      }\n    },\n    \"guest_james\": {\n      \"id\": \"guest_james\",\n      \"parent\": \"guests\",\n      \"display\": \"row\",\n      \"props\": {\n        \"name\": \"Cousin James\",\n        \"status\": \"maybe\"\n      }\n    },\n    \"guest_maria\": {\n      \"id\": \"guest_maria\",\n      \"parent\": \"guests\",\n      \"display\": \"row\",\n      \"props\": {\n        \"name\": \"Maria Garcia\",\n        \"status\": \"likely\"\n      }\n    },\n    \"guest_carlos\": {\n      \"id\": \"guest_carlos\",\n      \"parent\": \"guests\",\n      \"display\": \"row\",\n      \"props\": {\n        \"name\": \"Carlos Garcia\",\n        \"status\": \"likely\"\n      }\n    },\n    \"guest_dave\": {\n      \"id\": \"guest_dave\",\n      \"parent\": \"guests\",\n      \"display\": \"row\",\n      \"props\": {\n        \"name\": \"Dave\",\n        \"status\": \"likely\"\n      }\n    }\n  }\n}\n```",
          "snapshot_before": {
            "meta": {
              "title": "Sophie's Graduation",
              "identity": "Graduation planning for Sophie in May."
            },
            "entities": {
              "page": {
                "id": "page",
                "parent": "root",
                "display": "page",
                "props": {
                  "title": "Sophie's Graduation"
                }
              },
              "event_details": {
                "id": "event_details",
                "parent": "page",
                "display": "card",
                "props": {
                  "date": "May 22, 2025",
                  "honoree": "Sophie",
                  "event_type": "Graduation celebration",
                  "location": "UC Davis",
                  "time": "10:00 AM"
                }
              },
              "todo": {
                "id": "todo",
                "parent": "page",
                "display": "checklist",
                "props": {
                  "title": "Planning Tasks"
                }
              },
              "task_venue": {
                "id": "task_venue",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Book venue",
                  "done": false
                }
              },
              "task_invites": {
                "id": "task_invites",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Send invitations",
                  "done": false
                }
              },
              "task_catering": {
                "id": "task_catering",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Arrange catering",
                  "done": false
                }
              },
              "task_decorations": {
                "id": "task_decorations",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Get decorations",
                  "done": false
                }
              },
              "task_photographer": {
                "id": "task_photographer",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Book photographer",
                  "done": false
                }
              },
              "guests": {
                "id": "guests",
                "parent": "page",
                "display": "section",
                "props": {
                  "title": "Guests"
                }
              },
              "guest_linda": {
                "id": "guest_linda",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Aunt Linda",
                  "status": "confirmed"
                }
              },
              "guest_bob": {
                "id": "guest_bob",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Uncle Bob",
                  "status": "confirmed"
                }
              },
              "guest_james": {
                "id": "guest_james",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Cousin James",
                  "status": "maybe"
                }
              },
              "guest_maria": {
                "id": "guest_maria",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Maria Garcia",
                  "status": "likely"
                }
              },
              "guest_carlos": {
                "id": "guest_carlos",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Carlos Garcia",
                  "status": "likely"
                }
              },
              "guest_dave": {
                "id": "guest_dave",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Dave",
                  "status": "likely"
                }
              }
            }
          },
          "snapshot_after": {
            "meta": {
              "title": "Sophie's Graduation",
              "identity": "Graduation planning for Sophie in May."
            },
            "entities": {
              "page": {
                "id": "page",
                "parent": "root",
                "display": "page",
                "props": {
                  "title": "Sophie's Graduation"
                }
              },
              "event_details": {
                "id": "event_details",
                "parent": "page",
                "display": "card",
                "props": {
                  "date": "May 22, 2025",
                  "honoree": "Sophie",
                  "event_type": "Graduation celebration",
                  "location": "UC Davis",
                  "time": "10:00 AM"
                }
              },
              "todo": {
                "id": "todo",
                "parent": "page",
                "display": "checklist",
                "props": {
                  "title": "Planning Tasks"
                }
              },
              "task_venue": {
                "id": "task_venue",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Book park pavilion",
                  "done": true
                }
              },
              "task_invites": {
                "id": "task_invites",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Send invitations",
                  "done": false
                }
              },
              "task_catering": {
                "id": "task_catering",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Order cake",
                  "done": false
                }
              },
              "task_decorations": {
                "id": "task_decorations",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Get decorations",
                  "done": false
                }
              },
              "task_photographer": {
                "id": "task_photographer",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Book photographer",
                  "done": false
                }
              },
              "guests": {
                "id": "guests",
                "parent": "page",
                "display": "section",
                "props": {
                  "title": "Guests"
                }
              },
              "guest_linda": {
                "id": "guest_linda",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Aunt Linda",
                  "status": "confirmed"
                }
              },
              "guest_bob": {
                "id": "guest_bob",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Uncle Bob",
                  "status": "confirmed"
                }
              },
              "guest_james": {
                "id": "guest_james",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Cousin James",
                  "status": "confirmed",
                  "notes": "Flying in from Chicago"
                }
              },
              "guest_maria": {
                "id": "guest_maria",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Maria Garcia",
                  "status": "likely"
                }
              },
              "guest_carlos": {
                "id": "guest_carlos",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Carlos Garcia",
                  "status": "likely"
                }
              },
              "guest_dave": {
                "id": "guest_dave",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Dave",
                  "status": "declined"
                }
              },
              "food": {
                "id": "food",
                "parent": "page",
                "display": "table",
                "props": {}
              },
              "food_potato_salad": {
                "id": "food_potato_salad",
                "parent": "food",
                "display": "row",
                "props": {
                  "item": "Potato salad",
                  "contributor": "Aunt Linda",
                  "status": "confirmed"
                }
              },
              "food_main_1": {
                "id": "food_main_1",
                "parent": "food",
                "display": "row",
                "props": {
                  "item": "Carne asada",
                  "contributor": "Carlos Garcia",
                  "status": "confirmed"
                }
              },
              "food_side_1": {
                "id": "food_side_1",
                "parent": "food",
                "display": "row",
                "props": {
                  "item": "Fruit platter",
                  "contributor": "Maria Garcia",
                  "status": "confirmed"
                }
              },
              "food_dessert": {
                "id": "food_dessert",
                "parent": "food",
                "display": "row",
                "props": {
                  "item": "Dessert",
                  "contributor": "TBD",
                  "status": "needed"
                }
              },
              "food_drinks": {
                "id": "food_drinks",
                "parent": "food",
                "display": "row",
                "props": {
                  "item": "Drinks",
                  "contributor": "Uncle Bob",
                  "status": "confirmed"
                }
              }
            }
          },
          "entity_count": 21,
          "entity_delta": 6
        },
        {
          "turn": 7,
          "message": "carlos said he'll do carne asada, maria's handling drinks. we still need dessert and sides",
          "tier": "L2",
          "expected_tier": "L2",
          "classified_tier": "L2",
          "tier_correct": true,
          "notes": "L2 creates food entities. Carne asada assigned to Carlos, drinks to Maria. Dessert and sides should exist but be unassigned/TBD. Tests mixed assigned + unassigned.",
          "score": {
            "composite": 0.7855,
            "validity": 1.0,
            "voice": 1.0,
            "structure": 0.5,
            "efficiency": 0.10499999999999998,
            "fidelity": 1.0
          },
          "ttc_ms": 2471,
          "ttfc_ms": 1507,
          "output_tokens": 179,
          "input_tokens": 3861,
          "cache_creation": 0,
          "cache_read": 0,
          "output": "{\"t\":\"entity.update\",\"ref\":\"food_potato_salad\",\"p\":{\"item\":\"Potato salad\",\"contributor\":\"Aunt Linda\",\"status\":\"confirmed\"}}\n{\"t\":\"entity.update\",\"ref\":\"food_main_1\",\"p\":{\"item\":\"Carne asada\",\"contributor\":\"Carlos Garcia\",\"status\":\"confirmed\"}}\n{\"t\":\"entity.update\",\"ref\":\"food_drinks\",\"p\":{\"item\":\"Drinks\",\"contributor\":\"Maria Garcia\",\"status\":\"confirmed\"}}\n{\"t\":\"entity.update\",\"ref\":\"food_side_1\",\"p\":{\"item\":\"Side dish\",\"contributor\":\"TBD\",\"status\":\"needed\"}}\n{\"t\":\"entity.update\",\"ref\":\"food_dessert\",\"p\":{\"item\":\"Dessert\",\"contributor\":\"TBD\",\"status\":\"needed\"}}",
          "system_prompt": "# aide-prompt-v3.0\n\nYou are AIde \u2014 infrastructure that maintains a living page. The user describes what they're running. You keep the page current.\n\n## Voice\n\n- Never use first person. Never \"I updated\" or \"I created.\" You are infrastructure, not a character.\n- Reflect state, not action. Show how things stand: \"Budget: $1,350.\" Not \"I've updated the budget.\"\n- Mutations are declarative, minimal, final: \"Next game: Feb 27 at Dave's.\"\n- No encouragement. No \"Great!\", \"Nice!\", \"Let's do this!\", \"What else can I help with?\"\n- No emojis. Never.\n- Silence is valid. Not every change needs a voice line.\n\n## Output Format\n\nEmit JSONL \u2014 one JSON object per line. Each line is one operation. Nothing else.\n\nCRITICAL: No code fences. No backticks. No ```jsonl. No markdown. No prose before or after. Raw JSONL only \u2014 the parser reads your output directly.\n\nAbbreviated fields:\n- t = type\n- id = entity ID\n- parent = parent entity ID\n- display = render hint\n- p = props (data payload)\n- ref = reference to existing entity\n- from/to = relationship endpoints\n\n## Primitives\n\nEntity:\n- entity.create: {\"t\":\"entity.create\",\"id\":\"...\",\"parent\":\"...\",\"display\":\"...\",\"p\":{...}}\n- entity.update: {\"t\":\"entity.update\",\"ref\":\"...\",\"p\":{...}}\n- entity.remove: {\"t\":\"entity.remove\",\"ref\":\"...\"}\n- entity.move: {\"t\":\"entity.move\",\"ref\":\"...\",\"parent\":\"...\",\"position\":N}\n- entity.reorder: {\"t\":\"entity.reorder\",\"ref\":\"...\",\"children\":[\"...\"]}\n\nRelationships:\n- rel.set: {\"t\":\"rel.set\",\"from\":\"...\",\"to\":\"...\",\"type\":\"...\",\"cardinality\":\"many_to_one\"}\n- rel.remove: {\"t\":\"rel.remove\",\"from\":\"...\",\"to\":\"...\",\"type\":\"...\"}\n\nStyle:\n- style.set: {\"t\":\"style.set\",\"p\":{...}}\n- style.entity: {\"t\":\"style.entity\",\"ref\":\"...\",\"p\":{...}}\n\nMeta:\n- meta.set: {\"t\":\"meta.set\",\"p\":{\"title\":\"...\",\"identity\":\"...\"}}\n- meta.annotate: {\"t\":\"meta.annotate\",\"p\":{\"note\":\"...\",\"pinned\":false}}\n\nSignals (don't modify state):\n- voice: {\"t\":\"voice\",\"text\":\"...\"} \u2014 max 100 chars, state reflection only\n- escalate: {\"t\":\"escalate\",\"tier\":\"L3\"|\"L4\",\"reason\":\"...\",\"extract\":\"...\"}\n- batch.start / batch.end: wrap restructuring ops for atomic rendering\n\n## Entity Tree\n\nState is a tree of entities. Every entity has an `id`, a `parent`, a `display` hint, and `p` (props).\n\nThe root entity has `display: \"page\"`. Sections are direct children of the page. Items are children of sections. There is no separate \"collection\" or \"schema\" concept \u2014 entity shape is inferred from props.\n\nExample tree:\n```\npage (display: page)\n\u251c\u2500\u2500 event_details (display: card)\n\u2502   \u2514\u2500\u2500 props: {date: \"2026-05-22\", venue: \"Hilton\", guests: 60}\n\u251c\u2500\u2500 guest_list (display: table)\n\u2502   \u251c\u2500\u2500 guest_linda (display: row) \u2192 {name: \"Aunt Linda\", rsvp: \"yes\"}\n\u2502   \u251c\u2500\u2500 guest_james (display: row) \u2192 {name: \"Cousin James\", rsvp: \"pending\"}\n\u2502   \u2514\u2500\u2500 guest_bob (display: row) \u2192 {name: \"Uncle Bob\", rsvp: \"no\"}\n\u2514\u2500\u2500 todo (display: checklist)\n    \u251c\u2500\u2500 todo_book_venue (display: row) \u2192 {task: \"Book venue\", done: true}\n    \u2514\u2500\u2500 todo_send_invites (display: row) \u2192 {task: \"Send invites\", done: false}\n```\n\n## Display Hints\n\nPick based on entity shape:\n- page: root container (one per aide)\n- section: titled collapsible grouping\n- card: single entity with props as key-value pairs\n- list: children as vertical list (items with <4 fields)\n- table: children as rows (items with 3+ fields)\n- checklist: children with checkboxes (items need a boolean done/checked prop)\n- metric: single large value with label\n- text: paragraph content, max ~100 words\n- image: renders from src prop\n- row: child item within a list, table, or checklist\n\nChildren of a table/list/checklist use `display: \"row\"`. If `display` is omitted on a child, it inherits from parent context.\n\n## Emission Order\n\nEmit in this order:\n1. meta.set (title + identity)\n2. Page entity (root, display: page)\n3. Section entities (direct children of page)\n4. Children within sections (rows, items)\n5. Relationships (after both endpoints exist)\n6. Style\n7. Voice (if needed)\n\nParents before children. Always. The reducer rejects entity.create if parent doesn't exist.\n\n## Entity IDs\n\nsnake_case, lowercase, max 64 chars, descriptive.\n\nGood: guest_linda, food_potato_salad, todo_book_venue, event_details\nBad: item1, e_3, section-one, guestLinda\n\nIDs are permanent. Once created, an entity keeps its ID forever. Updates reference the same ID via `ref`.\n\n## Props\n\nProps are schemaless \u2014 types inferred from values. Supported: string, number, boolean, date (\"2026-05-22\"), array. Don't include null fields. New fields on entity.update extend the entity's shape automatically.\n\n## Scope\n\nOnly structure what the user has stated. No premature scaffolding. No placeholder sections. No template categories the user didn't mention. As users provide more info, the page grows organically.\n\n\n## Your Tier: L2 (Compiler)\n\nYou handle routine mutations on existing entities. Speed is everything.\n\n### Rules\n\n- Emit JSONL only. One line per operation.\n- Only modify existing entities or create children under existing parents.\n- NEVER create new sections. NEVER create entities with display hints you haven't seen in the snapshot. If you would need to pick a display hint, escalate. If you would need to create a new top-level grouping, escalate.\n- If unsure, escalate. Never guess.\n- Voice lines optional. For 1-2 operations, skip voice \u2014 the page change is the response. For 3+ operations, a brief voice summary helps.\n\n### Entity Resolution\n\nMatch user language to existing entity IDs in the snapshot.\n\n- \"Mike\" \u2192 find the entity whose name prop contains \"Mike\"\n- \"the first item\" \u2192 find by position in parent's children\n- \"milk\" \u2192 find by name/task/title prop match\n\nIf no entity matches, escalate \u2014 don't create a new one.\n\n### Update Format\n\nUse entity.update with `ref` pointing to the existing entity ID:\n\n{\"t\":\"entity.update\",\"ref\":\"guest_mike\",\"p\":{\"rsvp\":\"confirmed\"}}\n{\"t\":\"entity.update\",\"ref\":\"todo_book_venue\",\"p\":{\"done\":true}}\n\nFor adding a child to an existing section (e.g., adding an item to a checklist):\n\n{\"t\":\"entity.create\",\"id\":\"todo_order_cake\",\"parent\":\"todo\",\"display\":\"row\",\"p\":{\"task\":\"Order cake\",\"done\":false}}\n\nOnly create children under parents that already exist in the snapshot.\n\n### Escalation\n\nEscalate when you can't handle the request with existing structure:\n\n{\"t\":\"escalate\",\"tier\":\"L3\",\"reason\":\"REASON\",\"extract\":\"the part you can't handle\"}\n\nReasons:\n- unknown_entity_shape: entities you don't know how to structure\n- ambiguous_intent: can't determine which entities to modify\n- complex_conditional: if/then logic, bulk conditions\n- structural_change: new sections or restructuring needed\n\n### Query Escalation\n\nNever answer questions yourself. Always escalate queries to L4:\n\n{\"t\":\"escalate\",\"tier\":\"L4\",\"reason\":\"query\",\"extract\":\"the question\"}\n\n### Multi-Intent\n\nHandle mutations FIRST, then escalate remaining parts. Do both. Example:\n\nUser: \"Steve confirmed, do we have enough food?\"\n\n{\"t\":\"entity.update\",\"ref\":\"guest_steve\",\"p\":{\"rsvp\":\"confirmed\"}}\n{\"t\":\"escalate\",\"tier\":\"L4\",\"reason\":\"query\",\"extract\":\"do we have enough food?\"}\n\nNever skip the mutation just because there's also a query. Never skip the escalation just because there's also a mutation.\n\n### Examples\n\nUser: \"mark milk as done\"\n{\"t\":\"entity.update\",\"ref\":\"item_milk\",\"p\":{\"done\":true}}\n\nUser: \"change the date to March 15\"\n{\"t\":\"entity.update\",\"ref\":\"event_details\",\"p\":{\"date\":\"2026-03-15\"}}\n\nUser: \"Mike's out, Dave's subbing in\"\n{\"t\":\"entity.update\",\"ref\":\"player_mike\",\"p\":{\"status\":\"out\"}}\n{\"t\":\"entity.update\",\"ref\":\"player_dave\",\"p\":{\"status\":\"active\"}}\n{\"t\":\"voice\",\"text\":\"Mike out. Dave subbing.\"}\n\nUser: \"add bread to the list\"\n{\"t\":\"entity.create\",\"id\":\"item_bread\",\"parent\":\"grocery_list\",\"display\":\"row\",\"p\":{\"name\":\"Bread\",\"done\":false}}\n\nUser: \"remove the appetizers section\"\n(This is structural \u2014 escalate)\n{\"t\":\"escalate\",\"tier\":\"L3\",\"reason\":\"structural_change\",\"extract\":\"remove the appetizers section\"}\n\nUser: \"who hasn't RSVPed?\"\n{\"t\":\"escalate\",\"tier\":\"L4\",\"reason\":\"query\",\"extract\":\"who hasn't RSVPed?\"}\n\nUser: \"add a budget tracking section\"\n(New section \u2014 escalate)\n{\"t\":\"escalate\",\"tier\":\"L3\",\"reason\":\"structural_change\",\"extract\":\"add a budget tracking section\"}\n\n\n## Current Snapshot\n```json\n{\n  \"meta\": {\n    \"title\": \"Sophie's Graduation\",\n    \"identity\": \"Graduation planning for Sophie in May.\"\n  },\n  \"entities\": {\n    \"page\": {\n      \"id\": \"page\",\n      \"parent\": \"root\",\n      \"display\": \"page\",\n      \"props\": {\n        \"title\": \"Sophie's Graduation\"\n      }\n    },\n    \"event_details\": {\n      \"id\": \"event_details\",\n      \"parent\": \"page\",\n      \"display\": \"card\",\n      \"props\": {\n        \"date\": \"May 22, 2025\",\n        \"honoree\": \"Sophie\",\n        \"event_type\": \"Graduation celebration\",\n        \"location\": \"UC Davis\",\n        \"time\": \"10:00 AM\"\n      }\n    },\n    \"todo\": {\n      \"id\": \"todo\",\n      \"parent\": \"page\",\n      \"display\": \"checklist\",\n      \"props\": {\n        \"title\": \"Planning Tasks\"\n      }\n    },\n    \"task_venue\": {\n      \"id\": \"task_venue\",\n      \"parent\": \"todo\",\n      \"display\": \"row\",\n      \"props\": {\n        \"task\": \"Book venue\",\n        \"done\": false\n      }\n    },\n    \"task_invites\": {\n      \"id\": \"task_invites\",\n      \"parent\": \"todo\",\n      \"display\": \"row\",\n      \"props\": {\n        \"task\": \"Send invitations\",\n        \"done\": false\n      }\n    },\n    \"task_catering\": {\n      \"id\": \"task_catering\",\n      \"parent\": \"todo\",\n      \"display\": \"row\",\n      \"props\": {\n        \"task\": \"Arrange catering\",\n        \"done\": false\n      }\n    },\n    \"task_decorations\": {\n      \"id\": \"task_decorations\",\n      \"parent\": \"todo\",\n      \"display\": \"row\",\n      \"props\": {\n        \"task\": \"Get decorations\",\n        \"done\": false\n      }\n    },\n    \"task_photographer\": {\n      \"id\": \"task_photographer\",\n      \"parent\": \"todo\",\n      \"display\": \"row\",\n      \"props\": {\n        \"task\": \"Book photographer\",\n        \"done\": false\n      }\n    },\n    \"guests\": {\n      \"id\": \"guests\",\n      \"parent\": \"page\",\n      \"display\": \"section\",\n      \"props\": {\n        \"title\": \"Guests\"\n      }\n    },\n    \"guest_linda\": {\n      \"id\": \"guest_linda\",\n      \"parent\": \"guests\",\n      \"display\": \"row\",\n      \"props\": {\n        \"name\": \"Aunt Linda\",\n        \"status\": \"confirmed\"\n      }\n    },\n    \"guest_bob\": {\n      \"id\": \"guest_bob\",\n      \"parent\": \"guests\",\n      \"display\": \"row\",\n      \"props\": {\n        \"name\": \"Uncle Bob\",\n        \"status\": \"confirmed\"\n      }\n    },\n    \"guest_james\": {\n      \"id\": \"guest_james\",\n      \"parent\": \"guests\",\n      \"display\": \"row\",\n      \"props\": {\n        \"name\": \"Cousin James\",\n        \"status\": \"maybe\"\n      }\n    },\n    \"guest_maria\": {\n      \"id\": \"guest_maria\",\n      \"parent\": \"guests\",\n      \"display\": \"row\",\n      \"props\": {\n        \"name\": \"Maria Garcia\",\n        \"status\": \"likely\"\n      }\n    },\n    \"guest_carlos\": {\n      \"id\": \"guest_carlos\",\n      \"parent\": \"guests\",\n      \"display\": \"row\",\n      \"props\": {\n        \"name\": \"Carlos Garcia\",\n        \"status\": \"likely\"\n      }\n    },\n    \"guest_dave\": {\n      \"id\": \"guest_dave\",\n      \"parent\": \"guests\",\n      \"display\": \"row\",\n      \"props\": {\n        \"name\": \"Dave\",\n        \"status\": \"likely\"\n      }\n    },\n    \"food\": {\n      \"id\": \"food\",\n      \"parent\": \"page\",\n      \"display\": \"table\",\n      \"props\": {}\n    },\n    \"food_potato_salad\": {\n      \"id\": \"food_potato_salad\",\n      \"parent\": \"food\",\n      \"display\": \"row\",\n      \"props\": {}\n    },\n    \"food_main_1\": {\n      \"id\": \"food_main_1\",\n      \"parent\": \"food\",\n      \"display\": \"row\",\n      \"props\": {}\n    },\n    \"food_side_1\": {\n      \"id\": \"food_side_1\",\n      \"parent\": \"food\",\n      \"display\": \"row\",\n      \"props\": {}\n    },\n    \"food_dessert\": {\n      \"id\": \"food_dessert\",\n      \"parent\": \"food\",\n      \"display\": \"row\",\n      \"props\": {}\n    },\n    \"food_drinks\": {\n      \"id\": \"food_drinks\",\n      \"parent\": \"food\",\n      \"display\": \"row\",\n      \"props\": {}\n    }\n  }\n}\n```",
          "snapshot_before": {
            "meta": {
              "title": "Sophie's Graduation",
              "identity": "Graduation planning for Sophie in May."
            },
            "entities": {
              "page": {
                "id": "page",
                "parent": "root",
                "display": "page",
                "props": {
                  "title": "Sophie's Graduation"
                }
              },
              "event_details": {
                "id": "event_details",
                "parent": "page",
                "display": "card",
                "props": {
                  "date": "May 22, 2025",
                  "honoree": "Sophie",
                  "event_type": "Graduation celebration",
                  "location": "UC Davis",
                  "time": "10:00 AM"
                }
              },
              "todo": {
                "id": "todo",
                "parent": "page",
                "display": "checklist",
                "props": {
                  "title": "Planning Tasks"
                }
              },
              "task_venue": {
                "id": "task_venue",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Book venue",
                  "done": false
                }
              },
              "task_invites": {
                "id": "task_invites",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Send invitations",
                  "done": false
                }
              },
              "task_catering": {
                "id": "task_catering",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Arrange catering",
                  "done": false
                }
              },
              "task_decorations": {
                "id": "task_decorations",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Get decorations",
                  "done": false
                }
              },
              "task_photographer": {
                "id": "task_photographer",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Book photographer",
                  "done": false
                }
              },
              "guests": {
                "id": "guests",
                "parent": "page",
                "display": "section",
                "props": {
                  "title": "Guests"
                }
              },
              "guest_linda": {
                "id": "guest_linda",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Aunt Linda",
                  "status": "confirmed"
                }
              },
              "guest_bob": {
                "id": "guest_bob",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Uncle Bob",
                  "status": "confirmed"
                }
              },
              "guest_james": {
                "id": "guest_james",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Cousin James",
                  "status": "maybe"
                }
              },
              "guest_maria": {
                "id": "guest_maria",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Maria Garcia",
                  "status": "likely"
                }
              },
              "guest_carlos": {
                "id": "guest_carlos",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Carlos Garcia",
                  "status": "likely"
                }
              },
              "guest_dave": {
                "id": "guest_dave",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Dave",
                  "status": "likely"
                }
              },
              "food": {
                "id": "food",
                "parent": "page",
                "display": "table",
                "props": {}
              },
              "food_potato_salad": {
                "id": "food_potato_salad",
                "parent": "food",
                "display": "row",
                "props": {}
              },
              "food_main_1": {
                "id": "food_main_1",
                "parent": "food",
                "display": "row",
                "props": {}
              },
              "food_side_1": {
                "id": "food_side_1",
                "parent": "food",
                "display": "row",
                "props": {}
              },
              "food_dessert": {
                "id": "food_dessert",
                "parent": "food",
                "display": "row",
                "props": {}
              },
              "food_drinks": {
                "id": "food_drinks",
                "parent": "food",
                "display": "row",
                "props": {}
              }
            }
          },
          "snapshot_after": {
            "meta": {
              "title": "Sophie's Graduation",
              "identity": "Graduation planning for Sophie in May."
            },
            "entities": {
              "page": {
                "id": "page",
                "parent": "root",
                "display": "page",
                "props": {
                  "title": "Sophie's Graduation"
                }
              },
              "event_details": {
                "id": "event_details",
                "parent": "page",
                "display": "card",
                "props": {
                  "date": "May 22, 2025",
                  "honoree": "Sophie",
                  "event_type": "Graduation celebration",
                  "location": "UC Davis",
                  "time": "10:00 AM"
                }
              },
              "todo": {
                "id": "todo",
                "parent": "page",
                "display": "checklist",
                "props": {
                  "title": "Planning Tasks"
                }
              },
              "task_venue": {
                "id": "task_venue",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Book park pavilion",
                  "done": true
                }
              },
              "task_invites": {
                "id": "task_invites",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Send invitations",
                  "done": false
                }
              },
              "task_catering": {
                "id": "task_catering",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Order cake",
                  "done": false
                }
              },
              "task_decorations": {
                "id": "task_decorations",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Get decorations",
                  "done": false
                }
              },
              "task_photographer": {
                "id": "task_photographer",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Book photographer",
                  "done": false
                }
              },
              "guests": {
                "id": "guests",
                "parent": "page",
                "display": "section",
                "props": {
                  "title": "Guests"
                }
              },
              "guest_linda": {
                "id": "guest_linda",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Aunt Linda",
                  "status": "confirmed"
                }
              },
              "guest_bob": {
                "id": "guest_bob",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Uncle Bob",
                  "status": "confirmed"
                }
              },
              "guest_james": {
                "id": "guest_james",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Cousin James",
                  "status": "confirmed",
                  "notes": "Flying in from Chicago"
                }
              },
              "guest_maria": {
                "id": "guest_maria",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Maria Garcia",
                  "status": "likely"
                }
              },
              "guest_carlos": {
                "id": "guest_carlos",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Carlos Garcia",
                  "status": "likely"
                }
              },
              "guest_dave": {
                "id": "guest_dave",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Dave",
                  "status": "declined"
                }
              },
              "food": {
                "id": "food",
                "parent": "page",
                "display": "table",
                "props": {}
              },
              "food_potato_salad": {
                "id": "food_potato_salad",
                "parent": "food",
                "display": "row",
                "props": {
                  "item": "Potato salad",
                  "contributor": "Aunt Linda",
                  "status": "confirmed"
                }
              },
              "food_main_1": {
                "id": "food_main_1",
                "parent": "food",
                "display": "row",
                "props": {
                  "item": "Carne asada",
                  "contributor": "Carlos Garcia",
                  "status": "confirmed"
                }
              },
              "food_side_1": {
                "id": "food_side_1",
                "parent": "food",
                "display": "row",
                "props": {
                  "item": "Fruit platter",
                  "contributor": "Maria Garcia",
                  "status": "confirmed"
                }
              },
              "food_dessert": {
                "id": "food_dessert",
                "parent": "food",
                "display": "row",
                "props": {
                  "item": "Dessert",
                  "contributor": "TBD",
                  "status": "needed"
                }
              },
              "food_drinks": {
                "id": "food_drinks",
                "parent": "food",
                "display": "row",
                "props": {
                  "item": "Drinks",
                  "contributor": "Uncle Bob",
                  "status": "confirmed"
                }
              }
            }
          },
          "entity_count": 21,
          "entity_delta": 0
        },
        {
          "turn": 8,
          "message": "actually scratch that - maria's doing a fruit platter, not drinks. bob said he'll handle drinks",
          "tier": "L2",
          "expected_tier": "L2",
          "classified_tier": "L2",
          "tier_correct": true,
          "notes": "Tests correction handling. L2 should update Maria's assignment from drinks to fruit platter, and assign drinks to Bob. Should NOT delete and recreate \u2014 should update.",
          "score": {
            "composite": 0.8761666666666666,
            "validity": 1.0,
            "voice": 1.0,
            "structure": 0.6666666666666666,
            "efficiency": 0.595,
            "fidelity": 1.0
          },
          "ttc_ms": 1565,
          "ttfc_ms": 813,
          "output_tokens": 131,
          "input_tokens": 4022,
          "cache_creation": 0,
          "cache_read": 0,
          "output": "{\"t\":\"entity.update\",\"ref\":\"food_drinks\",\"p\":{\"item\":\"Drinks\",\"contributor\":\"Uncle Bob\",\"status\":\"confirmed\"}}\n{\"t\":\"entity.update\",\"ref\":\"food_side_1\",\"p\":{\"item\":\"Fruit platter\",\"contributor\":\"Maria Garcia\",\"status\":\"confirmed\"}}\n{\"t\":\"entity.remove\",\"ref\":\"food_side_1\"}\n{\"t\":\"entity.create\",\"id\":\"food_fruit_platter\",\"parent\":\"food\",\"display\":\"row\",\"p\":{\"item\":\"Fruit platter\",\"contributor\":\"Maria Garcia\",\"status\":\"confirmed\"}}",
          "system_prompt": "# aide-prompt-v3.0\n\nYou are AIde \u2014 infrastructure that maintains a living page. The user describes what they're running. You keep the page current.\n\n## Voice\n\n- Never use first person. Never \"I updated\" or \"I created.\" You are infrastructure, not a character.\n- Reflect state, not action. Show how things stand: \"Budget: $1,350.\" Not \"I've updated the budget.\"\n- Mutations are declarative, minimal, final: \"Next game: Feb 27 at Dave's.\"\n- No encouragement. No \"Great!\", \"Nice!\", \"Let's do this!\", \"What else can I help with?\"\n- No emojis. Never.\n- Silence is valid. Not every change needs a voice line.\n\n## Output Format\n\nEmit JSONL \u2014 one JSON object per line. Each line is one operation. Nothing else.\n\nCRITICAL: No code fences. No backticks. No ```jsonl. No markdown. No prose before or after. Raw JSONL only \u2014 the parser reads your output directly.\n\nAbbreviated fields:\n- t = type\n- id = entity ID\n- parent = parent entity ID\n- display = render hint\n- p = props (data payload)\n- ref = reference to existing entity\n- from/to = relationship endpoints\n\n## Primitives\n\nEntity:\n- entity.create: {\"t\":\"entity.create\",\"id\":\"...\",\"parent\":\"...\",\"display\":\"...\",\"p\":{...}}\n- entity.update: {\"t\":\"entity.update\",\"ref\":\"...\",\"p\":{...}}\n- entity.remove: {\"t\":\"entity.remove\",\"ref\":\"...\"}\n- entity.move: {\"t\":\"entity.move\",\"ref\":\"...\",\"parent\":\"...\",\"position\":N}\n- entity.reorder: {\"t\":\"entity.reorder\",\"ref\":\"...\",\"children\":[\"...\"]}\n\nRelationships:\n- rel.set: {\"t\":\"rel.set\",\"from\":\"...\",\"to\":\"...\",\"type\":\"...\",\"cardinality\":\"many_to_one\"}\n- rel.remove: {\"t\":\"rel.remove\",\"from\":\"...\",\"to\":\"...\",\"type\":\"...\"}\n\nStyle:\n- style.set: {\"t\":\"style.set\",\"p\":{...}}\n- style.entity: {\"t\":\"style.entity\",\"ref\":\"...\",\"p\":{...}}\n\nMeta:\n- meta.set: {\"t\":\"meta.set\",\"p\":{\"title\":\"...\",\"identity\":\"...\"}}\n- meta.annotate: {\"t\":\"meta.annotate\",\"p\":{\"note\":\"...\",\"pinned\":false}}\n\nSignals (don't modify state):\n- voice: {\"t\":\"voice\",\"text\":\"...\"} \u2014 max 100 chars, state reflection only\n- escalate: {\"t\":\"escalate\",\"tier\":\"L3\"|\"L4\",\"reason\":\"...\",\"extract\":\"...\"}\n- batch.start / batch.end: wrap restructuring ops for atomic rendering\n\n## Entity Tree\n\nState is a tree of entities. Every entity has an `id`, a `parent`, a `display` hint, and `p` (props).\n\nThe root entity has `display: \"page\"`. Sections are direct children of the page. Items are children of sections. There is no separate \"collection\" or \"schema\" concept \u2014 entity shape is inferred from props.\n\nExample tree:\n```\npage (display: page)\n\u251c\u2500\u2500 event_details (display: card)\n\u2502   \u2514\u2500\u2500 props: {date: \"2026-05-22\", venue: \"Hilton\", guests: 60}\n\u251c\u2500\u2500 guest_list (display: table)\n\u2502   \u251c\u2500\u2500 guest_linda (display: row) \u2192 {name: \"Aunt Linda\", rsvp: \"yes\"}\n\u2502   \u251c\u2500\u2500 guest_james (display: row) \u2192 {name: \"Cousin James\", rsvp: \"pending\"}\n\u2502   \u2514\u2500\u2500 guest_bob (display: row) \u2192 {name: \"Uncle Bob\", rsvp: \"no\"}\n\u2514\u2500\u2500 todo (display: checklist)\n    \u251c\u2500\u2500 todo_book_venue (display: row) \u2192 {task: \"Book venue\", done: true}\n    \u2514\u2500\u2500 todo_send_invites (display: row) \u2192 {task: \"Send invites\", done: false}\n```\n\n## Display Hints\n\nPick based on entity shape:\n- page: root container (one per aide)\n- section: titled collapsible grouping\n- card: single entity with props as key-value pairs\n- list: children as vertical list (items with <4 fields)\n- table: children as rows (items with 3+ fields)\n- checklist: children with checkboxes (items need a boolean done/checked prop)\n- metric: single large value with label\n- text: paragraph content, max ~100 words\n- image: renders from src prop\n- row: child item within a list, table, or checklist\n\nChildren of a table/list/checklist use `display: \"row\"`. If `display` is omitted on a child, it inherits from parent context.\n\n## Emission Order\n\nEmit in this order:\n1. meta.set (title + identity)\n2. Page entity (root, display: page)\n3. Section entities (direct children of page)\n4. Children within sections (rows, items)\n5. Relationships (after both endpoints exist)\n6. Style\n7. Voice (if needed)\n\nParents before children. Always. The reducer rejects entity.create if parent doesn't exist.\n\n## Entity IDs\n\nsnake_case, lowercase, max 64 chars, descriptive.\n\nGood: guest_linda, food_potato_salad, todo_book_venue, event_details\nBad: item1, e_3, section-one, guestLinda\n\nIDs are permanent. Once created, an entity keeps its ID forever. Updates reference the same ID via `ref`.\n\n## Props\n\nProps are schemaless \u2014 types inferred from values. Supported: string, number, boolean, date (\"2026-05-22\"), array. Don't include null fields. New fields on entity.update extend the entity's shape automatically.\n\n## Scope\n\nOnly structure what the user has stated. No premature scaffolding. No placeholder sections. No template categories the user didn't mention. As users provide more info, the page grows organically.\n\n\n## Your Tier: L2 (Compiler)\n\nYou handle routine mutations on existing entities. Speed is everything.\n\n### Rules\n\n- Emit JSONL only. One line per operation.\n- Only modify existing entities or create children under existing parents.\n- NEVER create new sections. NEVER create entities with display hints you haven't seen in the snapshot. If you would need to pick a display hint, escalate. If you would need to create a new top-level grouping, escalate.\n- If unsure, escalate. Never guess.\n- Voice lines optional. For 1-2 operations, skip voice \u2014 the page change is the response. For 3+ operations, a brief voice summary helps.\n\n### Entity Resolution\n\nMatch user language to existing entity IDs in the snapshot.\n\n- \"Mike\" \u2192 find the entity whose name prop contains \"Mike\"\n- \"the first item\" \u2192 find by position in parent's children\n- \"milk\" \u2192 find by name/task/title prop match\n\nIf no entity matches, escalate \u2014 don't create a new one.\n\n### Update Format\n\nUse entity.update with `ref` pointing to the existing entity ID:\n\n{\"t\":\"entity.update\",\"ref\":\"guest_mike\",\"p\":{\"rsvp\":\"confirmed\"}}\n{\"t\":\"entity.update\",\"ref\":\"todo_book_venue\",\"p\":{\"done\":true}}\n\nFor adding a child to an existing section (e.g., adding an item to a checklist):\n\n{\"t\":\"entity.create\",\"id\":\"todo_order_cake\",\"parent\":\"todo\",\"display\":\"row\",\"p\":{\"task\":\"Order cake\",\"done\":false}}\n\nOnly create children under parents that already exist in the snapshot.\n\n### Escalation\n\nEscalate when you can't handle the request with existing structure:\n\n{\"t\":\"escalate\",\"tier\":\"L3\",\"reason\":\"REASON\",\"extract\":\"the part you can't handle\"}\n\nReasons:\n- unknown_entity_shape: entities you don't know how to structure\n- ambiguous_intent: can't determine which entities to modify\n- complex_conditional: if/then logic, bulk conditions\n- structural_change: new sections or restructuring needed\n\n### Query Escalation\n\nNever answer questions yourself. Always escalate queries to L4:\n\n{\"t\":\"escalate\",\"tier\":\"L4\",\"reason\":\"query\",\"extract\":\"the question\"}\n\n### Multi-Intent\n\nHandle mutations FIRST, then escalate remaining parts. Do both. Example:\n\nUser: \"Steve confirmed, do we have enough food?\"\n\n{\"t\":\"entity.update\",\"ref\":\"guest_steve\",\"p\":{\"rsvp\":\"confirmed\"}}\n{\"t\":\"escalate\",\"tier\":\"L4\",\"reason\":\"query\",\"extract\":\"do we have enough food?\"}\n\nNever skip the mutation just because there's also a query. Never skip the escalation just because there's also a mutation.\n\n### Examples\n\nUser: \"mark milk as done\"\n{\"t\":\"entity.update\",\"ref\":\"item_milk\",\"p\":{\"done\":true}}\n\nUser: \"change the date to March 15\"\n{\"t\":\"entity.update\",\"ref\":\"event_details\",\"p\":{\"date\":\"2026-03-15\"}}\n\nUser: \"Mike's out, Dave's subbing in\"\n{\"t\":\"entity.update\",\"ref\":\"player_mike\",\"p\":{\"status\":\"out\"}}\n{\"t\":\"entity.update\",\"ref\":\"player_dave\",\"p\":{\"status\":\"active\"}}\n{\"t\":\"voice\",\"text\":\"Mike out. Dave subbing.\"}\n\nUser: \"add bread to the list\"\n{\"t\":\"entity.create\",\"id\":\"item_bread\",\"parent\":\"grocery_list\",\"display\":\"row\",\"p\":{\"name\":\"Bread\",\"done\":false}}\n\nUser: \"remove the appetizers section\"\n(This is structural \u2014 escalate)\n{\"t\":\"escalate\",\"tier\":\"L3\",\"reason\":\"structural_change\",\"extract\":\"remove the appetizers section\"}\n\nUser: \"who hasn't RSVPed?\"\n{\"t\":\"escalate\",\"tier\":\"L4\",\"reason\":\"query\",\"extract\":\"who hasn't RSVPed?\"}\n\nUser: \"add a budget tracking section\"\n(New section \u2014 escalate)\n{\"t\":\"escalate\",\"tier\":\"L3\",\"reason\":\"structural_change\",\"extract\":\"add a budget tracking section\"}\n\n\n## Current Snapshot\n```json\n{\n  \"meta\": {\n    \"title\": \"Sophie's Graduation\",\n    \"identity\": \"Graduation planning for Sophie in May.\"\n  },\n  \"entities\": {\n    \"page\": {\n      \"id\": \"page\",\n      \"parent\": \"root\",\n      \"display\": \"page\",\n      \"props\": {\n        \"title\": \"Sophie's Graduation\"\n      }\n    },\n    \"event_details\": {\n      \"id\": \"event_details\",\n      \"parent\": \"page\",\n      \"display\": \"card\",\n      \"props\": {\n        \"date\": \"May 22, 2025\",\n        \"honoree\": \"Sophie\",\n        \"event_type\": \"Graduation celebration\",\n        \"location\": \"UC Davis\",\n        \"time\": \"10:00 AM\"\n      }\n    },\n    \"todo\": {\n      \"id\": \"todo\",\n      \"parent\": \"page\",\n      \"display\": \"checklist\",\n      \"props\": {\n        \"title\": \"Planning Tasks\"\n      }\n    },\n    \"task_venue\": {\n      \"id\": \"task_venue\",\n      \"parent\": \"todo\",\n      \"display\": \"row\",\n      \"props\": {\n        \"task\": \"Book venue\",\n        \"done\": false\n      }\n    },\n    \"task_invites\": {\n      \"id\": \"task_invites\",\n      \"parent\": \"todo\",\n      \"display\": \"row\",\n      \"props\": {\n        \"task\": \"Send invitations\",\n        \"done\": false\n      }\n    },\n    \"task_catering\": {\n      \"id\": \"task_catering\",\n      \"parent\": \"todo\",\n      \"display\": \"row\",\n      \"props\": {\n        \"task\": \"Arrange catering\",\n        \"done\": false\n      }\n    },\n    \"task_decorations\": {\n      \"id\": \"task_decorations\",\n      \"parent\": \"todo\",\n      \"display\": \"row\",\n      \"props\": {\n        \"task\": \"Get decorations\",\n        \"done\": false\n      }\n    },\n    \"task_photographer\": {\n      \"id\": \"task_photographer\",\n      \"parent\": \"todo\",\n      \"display\": \"row\",\n      \"props\": {\n        \"task\": \"Book photographer\",\n        \"done\": false\n      }\n    },\n    \"guests\": {\n      \"id\": \"guests\",\n      \"parent\": \"page\",\n      \"display\": \"section\",\n      \"props\": {\n        \"title\": \"Guests\"\n      }\n    },\n    \"guest_linda\": {\n      \"id\": \"guest_linda\",\n      \"parent\": \"guests\",\n      \"display\": \"row\",\n      \"props\": {\n        \"name\": \"Aunt Linda\",\n        \"status\": \"confirmed\"\n      }\n    },\n    \"guest_bob\": {\n      \"id\": \"guest_bob\",\n      \"parent\": \"guests\",\n      \"display\": \"row\",\n      \"props\": {\n        \"name\": \"Uncle Bob\",\n        \"status\": \"confirmed\"\n      }\n    },\n    \"guest_james\": {\n      \"id\": \"guest_james\",\n      \"parent\": \"guests\",\n      \"display\": \"row\",\n      \"props\": {\n        \"name\": \"Cousin James\",\n        \"status\": \"maybe\"\n      }\n    },\n    \"guest_maria\": {\n      \"id\": \"guest_maria\",\n      \"parent\": \"guests\",\n      \"display\": \"row\",\n      \"props\": {\n        \"name\": \"Maria Garcia\",\n        \"status\": \"likely\"\n      }\n    },\n    \"guest_carlos\": {\n      \"id\": \"guest_carlos\",\n      \"parent\": \"guests\",\n      \"display\": \"row\",\n      \"props\": {\n        \"name\": \"Carlos Garcia\",\n        \"status\": \"likely\"\n      }\n    },\n    \"guest_dave\": {\n      \"id\": \"guest_dave\",\n      \"parent\": \"guests\",\n      \"display\": \"row\",\n      \"props\": {\n        \"name\": \"Dave\",\n        \"status\": \"likely\"\n      }\n    },\n    \"food\": {\n      \"id\": \"food\",\n      \"parent\": \"page\",\n      \"display\": \"table\",\n      \"props\": {}\n    },\n    \"food_potato_salad\": {\n      \"id\": \"food_potato_salad\",\n      \"parent\": \"food\",\n      \"display\": \"row\",\n      \"props\": {\n        \"item\": \"Potato salad\",\n        \"contributor\": \"Aunt Linda\",\n        \"status\": \"confirmed\"\n      }\n    },\n    \"food_main_1\": {\n      \"id\": \"food_main_1\",\n      \"parent\": \"food\",\n      \"display\": \"row\",\n      \"props\": {\n        \"item\": \"Carne asada\",\n        \"contributor\": \"Carlos Garcia\",\n        \"status\": \"confirmed\"\n      }\n    },\n    \"food_side_1\": {\n      \"id\": \"food_side_1\",\n      \"parent\": \"food\",\n      \"display\": \"row\",\n      \"props\": {\n        \"item\": \"Side dish\",\n        \"contributor\": \"TBD\",\n        \"status\": \"needed\"\n      }\n    },\n    \"food_dessert\": {\n      \"id\": \"food_dessert\",\n      \"parent\": \"food\",\n      \"display\": \"row\",\n      \"props\": {\n        \"item\": \"Dessert\",\n        \"contributor\": \"TBD\",\n        \"status\": \"needed\"\n      }\n    },\n    \"food_drinks\": {\n      \"id\": \"food_drinks\",\n      \"parent\": \"food\",\n      \"display\": \"row\",\n      \"props\": {\n        \"item\": \"Drinks\",\n        \"contributor\": \"Maria Garcia\",\n        \"status\": \"confirmed\"\n      }\n    }\n  }\n}\n```",
          "snapshot_before": {
            "meta": {
              "title": "Sophie's Graduation",
              "identity": "Graduation planning for Sophie in May."
            },
            "entities": {
              "page": {
                "id": "page",
                "parent": "root",
                "display": "page",
                "props": {
                  "title": "Sophie's Graduation"
                }
              },
              "event_details": {
                "id": "event_details",
                "parent": "page",
                "display": "card",
                "props": {
                  "date": "May 22, 2025",
                  "honoree": "Sophie",
                  "event_type": "Graduation celebration",
                  "location": "UC Davis",
                  "time": "10:00 AM"
                }
              },
              "todo": {
                "id": "todo",
                "parent": "page",
                "display": "checklist",
                "props": {
                  "title": "Planning Tasks"
                }
              },
              "task_venue": {
                "id": "task_venue",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Book venue",
                  "done": false
                }
              },
              "task_invites": {
                "id": "task_invites",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Send invitations",
                  "done": false
                }
              },
              "task_catering": {
                "id": "task_catering",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Arrange catering",
                  "done": false
                }
              },
              "task_decorations": {
                "id": "task_decorations",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Get decorations",
                  "done": false
                }
              },
              "task_photographer": {
                "id": "task_photographer",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Book photographer",
                  "done": false
                }
              },
              "guests": {
                "id": "guests",
                "parent": "page",
                "display": "section",
                "props": {
                  "title": "Guests"
                }
              },
              "guest_linda": {
                "id": "guest_linda",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Aunt Linda",
                  "status": "confirmed"
                }
              },
              "guest_bob": {
                "id": "guest_bob",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Uncle Bob",
                  "status": "confirmed"
                }
              },
              "guest_james": {
                "id": "guest_james",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Cousin James",
                  "status": "maybe"
                }
              },
              "guest_maria": {
                "id": "guest_maria",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Maria Garcia",
                  "status": "likely"
                }
              },
              "guest_carlos": {
                "id": "guest_carlos",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Carlos Garcia",
                  "status": "likely"
                }
              },
              "guest_dave": {
                "id": "guest_dave",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Dave",
                  "status": "likely"
                }
              },
              "food": {
                "id": "food",
                "parent": "page",
                "display": "table",
                "props": {}
              },
              "food_potato_salad": {
                "id": "food_potato_salad",
                "parent": "food",
                "display": "row",
                "props": {
                  "item": "Potato salad",
                  "contributor": "Aunt Linda",
                  "status": "confirmed"
                }
              },
              "food_main_1": {
                "id": "food_main_1",
                "parent": "food",
                "display": "row",
                "props": {
                  "item": "Carne asada",
                  "contributor": "Carlos Garcia",
                  "status": "confirmed"
                }
              },
              "food_side_1": {
                "id": "food_side_1",
                "parent": "food",
                "display": "row",
                "props": {
                  "item": "Side dish",
                  "contributor": "TBD",
                  "status": "needed"
                }
              },
              "food_dessert": {
                "id": "food_dessert",
                "parent": "food",
                "display": "row",
                "props": {
                  "item": "Dessert",
                  "contributor": "TBD",
                  "status": "needed"
                }
              },
              "food_drinks": {
                "id": "food_drinks",
                "parent": "food",
                "display": "row",
                "props": {
                  "item": "Drinks",
                  "contributor": "Maria Garcia",
                  "status": "confirmed"
                }
              }
            }
          },
          "snapshot_after": {
            "meta": {
              "title": "Sophie's Graduation",
              "identity": "Graduation planning for Sophie in May."
            },
            "entities": {
              "page": {
                "id": "page",
                "parent": "root",
                "display": "page",
                "props": {
                  "title": "Sophie's Graduation"
                }
              },
              "event_details": {
                "id": "event_details",
                "parent": "page",
                "display": "card",
                "props": {
                  "date": "May 22, 2025",
                  "honoree": "Sophie",
                  "event_type": "Graduation celebration",
                  "location": "UC Davis",
                  "time": "10:00 AM"
                }
              },
              "todo": {
                "id": "todo",
                "parent": "page",
                "display": "checklist",
                "props": {
                  "title": "Planning Tasks"
                }
              },
              "task_venue": {
                "id": "task_venue",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Book park pavilion",
                  "done": true
                }
              },
              "task_invites": {
                "id": "task_invites",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Send invitations",
                  "done": false
                }
              },
              "task_catering": {
                "id": "task_catering",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Order cake",
                  "done": false
                }
              },
              "task_decorations": {
                "id": "task_decorations",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Get decorations",
                  "done": false
                }
              },
              "task_photographer": {
                "id": "task_photographer",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Book photographer",
                  "done": false
                }
              },
              "guests": {
                "id": "guests",
                "parent": "page",
                "display": "section",
                "props": {
                  "title": "Guests"
                }
              },
              "guest_linda": {
                "id": "guest_linda",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Aunt Linda",
                  "status": "confirmed"
                }
              },
              "guest_bob": {
                "id": "guest_bob",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Uncle Bob",
                  "status": "confirmed"
                }
              },
              "guest_james": {
                "id": "guest_james",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Cousin James",
                  "status": "confirmed",
                  "notes": "Flying in from Chicago"
                }
              },
              "guest_maria": {
                "id": "guest_maria",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Maria Garcia",
                  "status": "likely"
                }
              },
              "guest_carlos": {
                "id": "guest_carlos",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Carlos Garcia",
                  "status": "likely"
                }
              },
              "guest_dave": {
                "id": "guest_dave",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Dave",
                  "status": "declined"
                }
              },
              "food": {
                "id": "food",
                "parent": "page",
                "display": "table",
                "props": {}
              },
              "food_potato_salad": {
                "id": "food_potato_salad",
                "parent": "food",
                "display": "row",
                "props": {
                  "item": "Potato salad",
                  "contributor": "Aunt Linda",
                  "status": "confirmed"
                }
              },
              "food_main_1": {
                "id": "food_main_1",
                "parent": "food",
                "display": "row",
                "props": {
                  "item": "Carne asada",
                  "contributor": "Carlos Garcia",
                  "status": "confirmed"
                }
              },
              "food_dessert": {
                "id": "food_dessert",
                "parent": "food",
                "display": "row",
                "props": {
                  "item": "Dessert",
                  "contributor": "TBD",
                  "status": "needed"
                }
              },
              "food_drinks": {
                "id": "food_drinks",
                "parent": "food",
                "display": "row",
                "props": {
                  "item": "Drinks",
                  "contributor": "Uncle Bob",
                  "status": "confirmed"
                }
              },
              "food_fruit_platter": {
                "id": "food_fruit_platter",
                "parent": "food",
                "display": "row",
                "props": {
                  "item": "Fruit platter",
                  "contributor": "Maria Garcia",
                  "status": "confirmed"
                }
              }
            }
          },
          "entity_count": 21,
          "entity_delta": 0
        },
        {
          "turn": 9,
          "message": "things we still gotta do: book the park pavilion, order a cake, get decorations, figure out parking",
          "tier": "L2",
          "expected_tier": "L3",
          "classified_tier": "L2",
          "tier_correct": true,
          "notes": "New section (todo/checklist) \u2192 L3 or L2 if todo section exists. Should create a checklist with 4 items, all unchecked. Display should be checklist, not table.",
          "score": {
            "composite": 0.8876666666666666,
            "validity": 1.0,
            "voice": 1.0,
            "structure": 0.6666666666666666,
            "efficiency": 0.71,
            "fidelity": 1.0
          },
          "ttc_ms": 1935,
          "ttfc_ms": 1084,
          "output_tokens": 108,
          "input_tokens": 4033,
          "cache_creation": 0,
          "cache_read": 0,
          "output": "{\"t\":\"entity.update\",\"ref\":\"task_venue\",\"p\":{\"task\":\"Book park pavilion\"}}\n{\"t\":\"entity.update\",\"ref\":\"task_catering\",\"p\":{\"task\":\"Order cake\"}}\n{\"t\":\"entity.update\",\"ref\":\"task_decorations\",\"p\":{\"done\":false}}\n{\"t\":\"entity.create\",\"id\":\"task_parking\",\"parent\":\"todo\",\"display\":\"row\",\"p\":{\"task\":\"Figure out parking\",\"done\":false}}",
          "system_prompt": "# aide-prompt-v3.0\n\nYou are AIde \u2014 infrastructure that maintains a living page. The user describes what they're running. You keep the page current.\n\n## Voice\n\n- Never use first person. Never \"I updated\" or \"I created.\" You are infrastructure, not a character.\n- Reflect state, not action. Show how things stand: \"Budget: $1,350.\" Not \"I've updated the budget.\"\n- Mutations are declarative, minimal, final: \"Next game: Feb 27 at Dave's.\"\n- No encouragement. No \"Great!\", \"Nice!\", \"Let's do this!\", \"What else can I help with?\"\n- No emojis. Never.\n- Silence is valid. Not every change needs a voice line.\n\n## Output Format\n\nEmit JSONL \u2014 one JSON object per line. Each line is one operation. Nothing else.\n\nCRITICAL: No code fences. No backticks. No ```jsonl. No markdown. No prose before or after. Raw JSONL only \u2014 the parser reads your output directly.\n\nAbbreviated fields:\n- t = type\n- id = entity ID\n- parent = parent entity ID\n- display = render hint\n- p = props (data payload)\n- ref = reference to existing entity\n- from/to = relationship endpoints\n\n## Primitives\n\nEntity:\n- entity.create: {\"t\":\"entity.create\",\"id\":\"...\",\"parent\":\"...\",\"display\":\"...\",\"p\":{...}}\n- entity.update: {\"t\":\"entity.update\",\"ref\":\"...\",\"p\":{...}}\n- entity.remove: {\"t\":\"entity.remove\",\"ref\":\"...\"}\n- entity.move: {\"t\":\"entity.move\",\"ref\":\"...\",\"parent\":\"...\",\"position\":N}\n- entity.reorder: {\"t\":\"entity.reorder\",\"ref\":\"...\",\"children\":[\"...\"]}\n\nRelationships:\n- rel.set: {\"t\":\"rel.set\",\"from\":\"...\",\"to\":\"...\",\"type\":\"...\",\"cardinality\":\"many_to_one\"}\n- rel.remove: {\"t\":\"rel.remove\",\"from\":\"...\",\"to\":\"...\",\"type\":\"...\"}\n\nStyle:\n- style.set: {\"t\":\"style.set\",\"p\":{...}}\n- style.entity: {\"t\":\"style.entity\",\"ref\":\"...\",\"p\":{...}}\n\nMeta:\n- meta.set: {\"t\":\"meta.set\",\"p\":{\"title\":\"...\",\"identity\":\"...\"}}\n- meta.annotate: {\"t\":\"meta.annotate\",\"p\":{\"note\":\"...\",\"pinned\":false}}\n\nSignals (don't modify state):\n- voice: {\"t\":\"voice\",\"text\":\"...\"} \u2014 max 100 chars, state reflection only\n- escalate: {\"t\":\"escalate\",\"tier\":\"L3\"|\"L4\",\"reason\":\"...\",\"extract\":\"...\"}\n- batch.start / batch.end: wrap restructuring ops for atomic rendering\n\n## Entity Tree\n\nState is a tree of entities. Every entity has an `id`, a `parent`, a `display` hint, and `p` (props).\n\nThe root entity has `display: \"page\"`. Sections are direct children of the page. Items are children of sections. There is no separate \"collection\" or \"schema\" concept \u2014 entity shape is inferred from props.\n\nExample tree:\n```\npage (display: page)\n\u251c\u2500\u2500 event_details (display: card)\n\u2502   \u2514\u2500\u2500 props: {date: \"2026-05-22\", venue: \"Hilton\", guests: 60}\n\u251c\u2500\u2500 guest_list (display: table)\n\u2502   \u251c\u2500\u2500 guest_linda (display: row) \u2192 {name: \"Aunt Linda\", rsvp: \"yes\"}\n\u2502   \u251c\u2500\u2500 guest_james (display: row) \u2192 {name: \"Cousin James\", rsvp: \"pending\"}\n\u2502   \u2514\u2500\u2500 guest_bob (display: row) \u2192 {name: \"Uncle Bob\", rsvp: \"no\"}\n\u2514\u2500\u2500 todo (display: checklist)\n    \u251c\u2500\u2500 todo_book_venue (display: row) \u2192 {task: \"Book venue\", done: true}\n    \u2514\u2500\u2500 todo_send_invites (display: row) \u2192 {task: \"Send invites\", done: false}\n```\n\n## Display Hints\n\nPick based on entity shape:\n- page: root container (one per aide)\n- section: titled collapsible grouping\n- card: single entity with props as key-value pairs\n- list: children as vertical list (items with <4 fields)\n- table: children as rows (items with 3+ fields)\n- checklist: children with checkboxes (items need a boolean done/checked prop)\n- metric: single large value with label\n- text: paragraph content, max ~100 words\n- image: renders from src prop\n- row: child item within a list, table, or checklist\n\nChildren of a table/list/checklist use `display: \"row\"`. If `display` is omitted on a child, it inherits from parent context.\n\n## Emission Order\n\nEmit in this order:\n1. meta.set (title + identity)\n2. Page entity (root, display: page)\n3. Section entities (direct children of page)\n4. Children within sections (rows, items)\n5. Relationships (after both endpoints exist)\n6. Style\n7. Voice (if needed)\n\nParents before children. Always. The reducer rejects entity.create if parent doesn't exist.\n\n## Entity IDs\n\nsnake_case, lowercase, max 64 chars, descriptive.\n\nGood: guest_linda, food_potato_salad, todo_book_venue, event_details\nBad: item1, e_3, section-one, guestLinda\n\nIDs are permanent. Once created, an entity keeps its ID forever. Updates reference the same ID via `ref`.\n\n## Props\n\nProps are schemaless \u2014 types inferred from values. Supported: string, number, boolean, date (\"2026-05-22\"), array. Don't include null fields. New fields on entity.update extend the entity's shape automatically.\n\n## Scope\n\nOnly structure what the user has stated. No premature scaffolding. No placeholder sections. No template categories the user didn't mention. As users provide more info, the page grows organically.\n\n\n## Your Tier: L2 (Compiler)\n\nYou handle routine mutations on existing entities. Speed is everything.\n\n### Rules\n\n- Emit JSONL only. One line per operation.\n- Only modify existing entities or create children under existing parents.\n- NEVER create new sections. NEVER create entities with display hints you haven't seen in the snapshot. If you would need to pick a display hint, escalate. If you would need to create a new top-level grouping, escalate.\n- If unsure, escalate. Never guess.\n- Voice lines optional. For 1-2 operations, skip voice \u2014 the page change is the response. For 3+ operations, a brief voice summary helps.\n\n### Entity Resolution\n\nMatch user language to existing entity IDs in the snapshot.\n\n- \"Mike\" \u2192 find the entity whose name prop contains \"Mike\"\n- \"the first item\" \u2192 find by position in parent's children\n- \"milk\" \u2192 find by name/task/title prop match\n\nIf no entity matches, escalate \u2014 don't create a new one.\n\n### Update Format\n\nUse entity.update with `ref` pointing to the existing entity ID:\n\n{\"t\":\"entity.update\",\"ref\":\"guest_mike\",\"p\":{\"rsvp\":\"confirmed\"}}\n{\"t\":\"entity.update\",\"ref\":\"todo_book_venue\",\"p\":{\"done\":true}}\n\nFor adding a child to an existing section (e.g., adding an item to a checklist):\n\n{\"t\":\"entity.create\",\"id\":\"todo_order_cake\",\"parent\":\"todo\",\"display\":\"row\",\"p\":{\"task\":\"Order cake\",\"done\":false}}\n\nOnly create children under parents that already exist in the snapshot.\n\n### Escalation\n\nEscalate when you can't handle the request with existing structure:\n\n{\"t\":\"escalate\",\"tier\":\"L3\",\"reason\":\"REASON\",\"extract\":\"the part you can't handle\"}\n\nReasons:\n- unknown_entity_shape: entities you don't know how to structure\n- ambiguous_intent: can't determine which entities to modify\n- complex_conditional: if/then logic, bulk conditions\n- structural_change: new sections or restructuring needed\n\n### Query Escalation\n\nNever answer questions yourself. Always escalate queries to L4:\n\n{\"t\":\"escalate\",\"tier\":\"L4\",\"reason\":\"query\",\"extract\":\"the question\"}\n\n### Multi-Intent\n\nHandle mutations FIRST, then escalate remaining parts. Do both. Example:\n\nUser: \"Steve confirmed, do we have enough food?\"\n\n{\"t\":\"entity.update\",\"ref\":\"guest_steve\",\"p\":{\"rsvp\":\"confirmed\"}}\n{\"t\":\"escalate\",\"tier\":\"L4\",\"reason\":\"query\",\"extract\":\"do we have enough food?\"}\n\nNever skip the mutation just because there's also a query. Never skip the escalation just because there's also a mutation.\n\n### Examples\n\nUser: \"mark milk as done\"\n{\"t\":\"entity.update\",\"ref\":\"item_milk\",\"p\":{\"done\":true}}\n\nUser: \"change the date to March 15\"\n{\"t\":\"entity.update\",\"ref\":\"event_details\",\"p\":{\"date\":\"2026-03-15\"}}\n\nUser: \"Mike's out, Dave's subbing in\"\n{\"t\":\"entity.update\",\"ref\":\"player_mike\",\"p\":{\"status\":\"out\"}}\n{\"t\":\"entity.update\",\"ref\":\"player_dave\",\"p\":{\"status\":\"active\"}}\n{\"t\":\"voice\",\"text\":\"Mike out. Dave subbing.\"}\n\nUser: \"add bread to the list\"\n{\"t\":\"entity.create\",\"id\":\"item_bread\",\"parent\":\"grocery_list\",\"display\":\"row\",\"p\":{\"name\":\"Bread\",\"done\":false}}\n\nUser: \"remove the appetizers section\"\n(This is structural \u2014 escalate)\n{\"t\":\"escalate\",\"tier\":\"L3\",\"reason\":\"structural_change\",\"extract\":\"remove the appetizers section\"}\n\nUser: \"who hasn't RSVPed?\"\n{\"t\":\"escalate\",\"tier\":\"L4\",\"reason\":\"query\",\"extract\":\"who hasn't RSVPed?\"}\n\nUser: \"add a budget tracking section\"\n(New section \u2014 escalate)\n{\"t\":\"escalate\",\"tier\":\"L3\",\"reason\":\"structural_change\",\"extract\":\"add a budget tracking section\"}\n\n\n## Current Snapshot\n```json\n{\n  \"meta\": {\n    \"title\": \"Sophie's Graduation\",\n    \"identity\": \"Graduation planning for Sophie in May.\"\n  },\n  \"entities\": {\n    \"page\": {\n      \"id\": \"page\",\n      \"parent\": \"root\",\n      \"display\": \"page\",\n      \"props\": {\n        \"title\": \"Sophie's Graduation\"\n      }\n    },\n    \"event_details\": {\n      \"id\": \"event_details\",\n      \"parent\": \"page\",\n      \"display\": \"card\",\n      \"props\": {\n        \"date\": \"May 22, 2025\",\n        \"honoree\": \"Sophie\",\n        \"event_type\": \"Graduation celebration\",\n        \"location\": \"UC Davis\",\n        \"time\": \"10:00 AM\"\n      }\n    },\n    \"todo\": {\n      \"id\": \"todo\",\n      \"parent\": \"page\",\n      \"display\": \"checklist\",\n      \"props\": {\n        \"title\": \"Planning Tasks\"\n      }\n    },\n    \"task_venue\": {\n      \"id\": \"task_venue\",\n      \"parent\": \"todo\",\n      \"display\": \"row\",\n      \"props\": {\n        \"task\": \"Book venue\",\n        \"done\": false\n      }\n    },\n    \"task_invites\": {\n      \"id\": \"task_invites\",\n      \"parent\": \"todo\",\n      \"display\": \"row\",\n      \"props\": {\n        \"task\": \"Send invitations\",\n        \"done\": false\n      }\n    },\n    \"task_catering\": {\n      \"id\": \"task_catering\",\n      \"parent\": \"todo\",\n      \"display\": \"row\",\n      \"props\": {\n        \"task\": \"Arrange catering\",\n        \"done\": false\n      }\n    },\n    \"task_decorations\": {\n      \"id\": \"task_decorations\",\n      \"parent\": \"todo\",\n      \"display\": \"row\",\n      \"props\": {\n        \"task\": \"Get decorations\",\n        \"done\": false\n      }\n    },\n    \"task_photographer\": {\n      \"id\": \"task_photographer\",\n      \"parent\": \"todo\",\n      \"display\": \"row\",\n      \"props\": {\n        \"task\": \"Book photographer\",\n        \"done\": false\n      }\n    },\n    \"guests\": {\n      \"id\": \"guests\",\n      \"parent\": \"page\",\n      \"display\": \"section\",\n      \"props\": {\n        \"title\": \"Guests\"\n      }\n    },\n    \"guest_linda\": {\n      \"id\": \"guest_linda\",\n      \"parent\": \"guests\",\n      \"display\": \"row\",\n      \"props\": {\n        \"name\": \"Aunt Linda\",\n        \"status\": \"confirmed\"\n      }\n    },\n    \"guest_bob\": {\n      \"id\": \"guest_bob\",\n      \"parent\": \"guests\",\n      \"display\": \"row\",\n      \"props\": {\n        \"name\": \"Uncle Bob\",\n        \"status\": \"confirmed\"\n      }\n    },\n    \"guest_james\": {\n      \"id\": \"guest_james\",\n      \"parent\": \"guests\",\n      \"display\": \"row\",\n      \"props\": {\n        \"name\": \"Cousin James\",\n        \"status\": \"maybe\"\n      }\n    },\n    \"guest_maria\": {\n      \"id\": \"guest_maria\",\n      \"parent\": \"guests\",\n      \"display\": \"row\",\n      \"props\": {\n        \"name\": \"Maria Garcia\",\n        \"status\": \"likely\"\n      }\n    },\n    \"guest_carlos\": {\n      \"id\": \"guest_carlos\",\n      \"parent\": \"guests\",\n      \"display\": \"row\",\n      \"props\": {\n        \"name\": \"Carlos Garcia\",\n        \"status\": \"likely\"\n      }\n    },\n    \"guest_dave\": {\n      \"id\": \"guest_dave\",\n      \"parent\": \"guests\",\n      \"display\": \"row\",\n      \"props\": {\n        \"name\": \"Dave\",\n        \"status\": \"likely\"\n      }\n    },\n    \"food\": {\n      \"id\": \"food\",\n      \"parent\": \"page\",\n      \"display\": \"table\",\n      \"props\": {}\n    },\n    \"food_potato_salad\": {\n      \"id\": \"food_potato_salad\",\n      \"parent\": \"food\",\n      \"display\": \"row\",\n      \"props\": {\n        \"item\": \"Potato salad\",\n        \"contributor\": \"Aunt Linda\",\n        \"status\": \"confirmed\"\n      }\n    },\n    \"food_main_1\": {\n      \"id\": \"food_main_1\",\n      \"parent\": \"food\",\n      \"display\": \"row\",\n      \"props\": {\n        \"item\": \"Carne asada\",\n        \"contributor\": \"Carlos Garcia\",\n        \"status\": \"confirmed\"\n      }\n    },\n    \"food_dessert\": {\n      \"id\": \"food_dessert\",\n      \"parent\": \"food\",\n      \"display\": \"row\",\n      \"props\": {\n        \"item\": \"Dessert\",\n        \"contributor\": \"TBD\",\n        \"status\": \"needed\"\n      }\n    },\n    \"food_drinks\": {\n      \"id\": \"food_drinks\",\n      \"parent\": \"food\",\n      \"display\": \"row\",\n      \"props\": {\n        \"item\": \"Drinks\",\n        \"contributor\": \"Uncle Bob\",\n        \"status\": \"confirmed\"\n      }\n    },\n    \"food_fruit_platter\": {\n      \"id\": \"food_fruit_platter\",\n      \"parent\": \"food\",\n      \"display\": \"row\",\n      \"props\": {\n        \"item\": \"Fruit platter\",\n        \"contributor\": \"Maria Garcia\",\n        \"status\": \"confirmed\"\n      }\n    }\n  }\n}\n```",
          "snapshot_before": {
            "meta": {
              "title": "Sophie's Graduation",
              "identity": "Graduation planning for Sophie in May."
            },
            "entities": {
              "page": {
                "id": "page",
                "parent": "root",
                "display": "page",
                "props": {
                  "title": "Sophie's Graduation"
                }
              },
              "event_details": {
                "id": "event_details",
                "parent": "page",
                "display": "card",
                "props": {
                  "date": "May 22, 2025",
                  "honoree": "Sophie",
                  "event_type": "Graduation celebration",
                  "location": "UC Davis",
                  "time": "10:00 AM"
                }
              },
              "todo": {
                "id": "todo",
                "parent": "page",
                "display": "checklist",
                "props": {
                  "title": "Planning Tasks"
                }
              },
              "task_venue": {
                "id": "task_venue",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Book venue",
                  "done": false
                }
              },
              "task_invites": {
                "id": "task_invites",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Send invitations",
                  "done": false
                }
              },
              "task_catering": {
                "id": "task_catering",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Arrange catering",
                  "done": false
                }
              },
              "task_decorations": {
                "id": "task_decorations",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Get decorations",
                  "done": false
                }
              },
              "task_photographer": {
                "id": "task_photographer",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Book photographer",
                  "done": false
                }
              },
              "guests": {
                "id": "guests",
                "parent": "page",
                "display": "section",
                "props": {
                  "title": "Guests"
                }
              },
              "guest_linda": {
                "id": "guest_linda",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Aunt Linda",
                  "status": "confirmed"
                }
              },
              "guest_bob": {
                "id": "guest_bob",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Uncle Bob",
                  "status": "confirmed"
                }
              },
              "guest_james": {
                "id": "guest_james",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Cousin James",
                  "status": "maybe"
                }
              },
              "guest_maria": {
                "id": "guest_maria",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Maria Garcia",
                  "status": "likely"
                }
              },
              "guest_carlos": {
                "id": "guest_carlos",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Carlos Garcia",
                  "status": "likely"
                }
              },
              "guest_dave": {
                "id": "guest_dave",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Dave",
                  "status": "likely"
                }
              },
              "food": {
                "id": "food",
                "parent": "page",
                "display": "table",
                "props": {}
              },
              "food_potato_salad": {
                "id": "food_potato_salad",
                "parent": "food",
                "display": "row",
                "props": {
                  "item": "Potato salad",
                  "contributor": "Aunt Linda",
                  "status": "confirmed"
                }
              },
              "food_main_1": {
                "id": "food_main_1",
                "parent": "food",
                "display": "row",
                "props": {
                  "item": "Carne asada",
                  "contributor": "Carlos Garcia",
                  "status": "confirmed"
                }
              },
              "food_dessert": {
                "id": "food_dessert",
                "parent": "food",
                "display": "row",
                "props": {
                  "item": "Dessert",
                  "contributor": "TBD",
                  "status": "needed"
                }
              },
              "food_drinks": {
                "id": "food_drinks",
                "parent": "food",
                "display": "row",
                "props": {
                  "item": "Drinks",
                  "contributor": "Uncle Bob",
                  "status": "confirmed"
                }
              },
              "food_fruit_platter": {
                "id": "food_fruit_platter",
                "parent": "food",
                "display": "row",
                "props": {
                  "item": "Fruit platter",
                  "contributor": "Maria Garcia",
                  "status": "confirmed"
                }
              }
            }
          },
          "snapshot_after": {
            "meta": {
              "title": "Sophie's Graduation",
              "identity": "Graduation planning for Sophie in May."
            },
            "entities": {
              "page": {
                "id": "page",
                "parent": "root",
                "display": "page",
                "props": {
                  "title": "Sophie's Graduation"
                }
              },
              "event_details": {
                "id": "event_details",
                "parent": "page",
                "display": "card",
                "props": {
                  "date": "May 22, 2025",
                  "honoree": "Sophie",
                  "event_type": "Graduation celebration",
                  "location": "UC Davis",
                  "time": "10:00 AM"
                }
              },
              "todo": {
                "id": "todo",
                "parent": "page",
                "display": "checklist",
                "props": {
                  "title": "Planning Tasks"
                }
              },
              "task_venue": {
                "id": "task_venue",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Book park pavilion",
                  "done": true
                }
              },
              "task_invites": {
                "id": "task_invites",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Send invitations",
                  "done": false
                }
              },
              "task_catering": {
                "id": "task_catering",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Order cake",
                  "done": false
                }
              },
              "task_decorations": {
                "id": "task_decorations",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Get decorations",
                  "done": false
                }
              },
              "task_photographer": {
                "id": "task_photographer",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Book photographer",
                  "done": false
                }
              },
              "guests": {
                "id": "guests",
                "parent": "page",
                "display": "section",
                "props": {
                  "title": "Guests"
                }
              },
              "guest_linda": {
                "id": "guest_linda",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Aunt Linda",
                  "status": "confirmed"
                }
              },
              "guest_bob": {
                "id": "guest_bob",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Uncle Bob",
                  "status": "confirmed"
                }
              },
              "guest_james": {
                "id": "guest_james",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Cousin James",
                  "status": "confirmed",
                  "notes": "Flying in from Chicago"
                }
              },
              "guest_maria": {
                "id": "guest_maria",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Maria Garcia",
                  "status": "likely"
                }
              },
              "guest_carlos": {
                "id": "guest_carlos",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Carlos Garcia",
                  "status": "likely"
                }
              },
              "guest_dave": {
                "id": "guest_dave",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Dave",
                  "status": "declined"
                }
              },
              "food": {
                "id": "food",
                "parent": "page",
                "display": "table",
                "props": {}
              },
              "food_potato_salad": {
                "id": "food_potato_salad",
                "parent": "food",
                "display": "row",
                "props": {
                  "item": "Potato salad",
                  "contributor": "Aunt Linda",
                  "status": "confirmed"
                }
              },
              "food_main_1": {
                "id": "food_main_1",
                "parent": "food",
                "display": "row",
                "props": {
                  "item": "Carne asada",
                  "contributor": "Carlos Garcia",
                  "status": "confirmed"
                }
              },
              "food_dessert": {
                "id": "food_dessert",
                "parent": "food",
                "display": "row",
                "props": {
                  "item": "Dessert",
                  "contributor": "TBD",
                  "status": "needed"
                }
              },
              "food_drinks": {
                "id": "food_drinks",
                "parent": "food",
                "display": "row",
                "props": {
                  "item": "Drinks",
                  "contributor": "Uncle Bob",
                  "status": "confirmed"
                }
              },
              "food_fruit_platter": {
                "id": "food_fruit_platter",
                "parent": "food",
                "display": "row",
                "props": {
                  "item": "Fruit platter",
                  "contributor": "Maria Garcia",
                  "status": "confirmed"
                }
              },
              "task_parking": {
                "id": "task_parking",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Figure out parking",
                  "done": false
                }
              }
            }
          },
          "entity_count": 22,
          "entity_delta": 1
        },
        {
          "turn": 10,
          "message": "booked the pavilion!",
          "tier": "L2",
          "expected_tier": "L2",
          "classified_tier": "L2",
          "tier_correct": true,
          "notes": "Classic L2 \u2014 find the 'book pavilion' task, set done=true. Should be 1 line of JSONL + maybe a voice line. Tests entity resolution ('the pavilion' \u2192 'book the park pavilion' task).",
          "score": {
            "composite": 0.875,
            "validity": 1.0,
            "voice": 1.0,
            "structure": 0.5,
            "efficiency": 1.0,
            "fidelity": 1.0
          },
          "ttc_ms": 898,
          "ttfc_ms": 578,
          "output_tokens": 23,
          "input_tokens": 4087,
          "cache_creation": 0,
          "cache_read": 0,
          "output": "{\"t\":\"entity.update\",\"ref\":\"task_venue\",\"p\":{\"done\":true}}",
          "system_prompt": "# aide-prompt-v3.0\n\nYou are AIde \u2014 infrastructure that maintains a living page. The user describes what they're running. You keep the page current.\n\n## Voice\n\n- Never use first person. Never \"I updated\" or \"I created.\" You are infrastructure, not a character.\n- Reflect state, not action. Show how things stand: \"Budget: $1,350.\" Not \"I've updated the budget.\"\n- Mutations are declarative, minimal, final: \"Next game: Feb 27 at Dave's.\"\n- No encouragement. No \"Great!\", \"Nice!\", \"Let's do this!\", \"What else can I help with?\"\n- No emojis. Never.\n- Silence is valid. Not every change needs a voice line.\n\n## Output Format\n\nEmit JSONL \u2014 one JSON object per line. Each line is one operation. Nothing else.\n\nCRITICAL: No code fences. No backticks. No ```jsonl. No markdown. No prose before or after. Raw JSONL only \u2014 the parser reads your output directly.\n\nAbbreviated fields:\n- t = type\n- id = entity ID\n- parent = parent entity ID\n- display = render hint\n- p = props (data payload)\n- ref = reference to existing entity\n- from/to = relationship endpoints\n\n## Primitives\n\nEntity:\n- entity.create: {\"t\":\"entity.create\",\"id\":\"...\",\"parent\":\"...\",\"display\":\"...\",\"p\":{...}}\n- entity.update: {\"t\":\"entity.update\",\"ref\":\"...\",\"p\":{...}}\n- entity.remove: {\"t\":\"entity.remove\",\"ref\":\"...\"}\n- entity.move: {\"t\":\"entity.move\",\"ref\":\"...\",\"parent\":\"...\",\"position\":N}\n- entity.reorder: {\"t\":\"entity.reorder\",\"ref\":\"...\",\"children\":[\"...\"]}\n\nRelationships:\n- rel.set: {\"t\":\"rel.set\",\"from\":\"...\",\"to\":\"...\",\"type\":\"...\",\"cardinality\":\"many_to_one\"}\n- rel.remove: {\"t\":\"rel.remove\",\"from\":\"...\",\"to\":\"...\",\"type\":\"...\"}\n\nStyle:\n- style.set: {\"t\":\"style.set\",\"p\":{...}}\n- style.entity: {\"t\":\"style.entity\",\"ref\":\"...\",\"p\":{...}}\n\nMeta:\n- meta.set: {\"t\":\"meta.set\",\"p\":{\"title\":\"...\",\"identity\":\"...\"}}\n- meta.annotate: {\"t\":\"meta.annotate\",\"p\":{\"note\":\"...\",\"pinned\":false}}\n\nSignals (don't modify state):\n- voice: {\"t\":\"voice\",\"text\":\"...\"} \u2014 max 100 chars, state reflection only\n- escalate: {\"t\":\"escalate\",\"tier\":\"L3\"|\"L4\",\"reason\":\"...\",\"extract\":\"...\"}\n- batch.start / batch.end: wrap restructuring ops for atomic rendering\n\n## Entity Tree\n\nState is a tree of entities. Every entity has an `id`, a `parent`, a `display` hint, and `p` (props).\n\nThe root entity has `display: \"page\"`. Sections are direct children of the page. Items are children of sections. There is no separate \"collection\" or \"schema\" concept \u2014 entity shape is inferred from props.\n\nExample tree:\n```\npage (display: page)\n\u251c\u2500\u2500 event_details (display: card)\n\u2502   \u2514\u2500\u2500 props: {date: \"2026-05-22\", venue: \"Hilton\", guests: 60}\n\u251c\u2500\u2500 guest_list (display: table)\n\u2502   \u251c\u2500\u2500 guest_linda (display: row) \u2192 {name: \"Aunt Linda\", rsvp: \"yes\"}\n\u2502   \u251c\u2500\u2500 guest_james (display: row) \u2192 {name: \"Cousin James\", rsvp: \"pending\"}\n\u2502   \u2514\u2500\u2500 guest_bob (display: row) \u2192 {name: \"Uncle Bob\", rsvp: \"no\"}\n\u2514\u2500\u2500 todo (display: checklist)\n    \u251c\u2500\u2500 todo_book_venue (display: row) \u2192 {task: \"Book venue\", done: true}\n    \u2514\u2500\u2500 todo_send_invites (display: row) \u2192 {task: \"Send invites\", done: false}\n```\n\n## Display Hints\n\nPick based on entity shape:\n- page: root container (one per aide)\n- section: titled collapsible grouping\n- card: single entity with props as key-value pairs\n- list: children as vertical list (items with <4 fields)\n- table: children as rows (items with 3+ fields)\n- checklist: children with checkboxes (items need a boolean done/checked prop)\n- metric: single large value with label\n- text: paragraph content, max ~100 words\n- image: renders from src prop\n- row: child item within a list, table, or checklist\n\nChildren of a table/list/checklist use `display: \"row\"`. If `display` is omitted on a child, it inherits from parent context.\n\n## Emission Order\n\nEmit in this order:\n1. meta.set (title + identity)\n2. Page entity (root, display: page)\n3. Section entities (direct children of page)\n4. Children within sections (rows, items)\n5. Relationships (after both endpoints exist)\n6. Style\n7. Voice (if needed)\n\nParents before children. Always. The reducer rejects entity.create if parent doesn't exist.\n\n## Entity IDs\n\nsnake_case, lowercase, max 64 chars, descriptive.\n\nGood: guest_linda, food_potato_salad, todo_book_venue, event_details\nBad: item1, e_3, section-one, guestLinda\n\nIDs are permanent. Once created, an entity keeps its ID forever. Updates reference the same ID via `ref`.\n\n## Props\n\nProps are schemaless \u2014 types inferred from values. Supported: string, number, boolean, date (\"2026-05-22\"), array. Don't include null fields. New fields on entity.update extend the entity's shape automatically.\n\n## Scope\n\nOnly structure what the user has stated. No premature scaffolding. No placeholder sections. No template categories the user didn't mention. As users provide more info, the page grows organically.\n\n\n## Your Tier: L2 (Compiler)\n\nYou handle routine mutations on existing entities. Speed is everything.\n\n### Rules\n\n- Emit JSONL only. One line per operation.\n- Only modify existing entities or create children under existing parents.\n- NEVER create new sections. NEVER create entities with display hints you haven't seen in the snapshot. If you would need to pick a display hint, escalate. If you would need to create a new top-level grouping, escalate.\n- If unsure, escalate. Never guess.\n- Voice lines optional. For 1-2 operations, skip voice \u2014 the page change is the response. For 3+ operations, a brief voice summary helps.\n\n### Entity Resolution\n\nMatch user language to existing entity IDs in the snapshot.\n\n- \"Mike\" \u2192 find the entity whose name prop contains \"Mike\"\n- \"the first item\" \u2192 find by position in parent's children\n- \"milk\" \u2192 find by name/task/title prop match\n\nIf no entity matches, escalate \u2014 don't create a new one.\n\n### Update Format\n\nUse entity.update with `ref` pointing to the existing entity ID:\n\n{\"t\":\"entity.update\",\"ref\":\"guest_mike\",\"p\":{\"rsvp\":\"confirmed\"}}\n{\"t\":\"entity.update\",\"ref\":\"todo_book_venue\",\"p\":{\"done\":true}}\n\nFor adding a child to an existing section (e.g., adding an item to a checklist):\n\n{\"t\":\"entity.create\",\"id\":\"todo_order_cake\",\"parent\":\"todo\",\"display\":\"row\",\"p\":{\"task\":\"Order cake\",\"done\":false}}\n\nOnly create children under parents that already exist in the snapshot.\n\n### Escalation\n\nEscalate when you can't handle the request with existing structure:\n\n{\"t\":\"escalate\",\"tier\":\"L3\",\"reason\":\"REASON\",\"extract\":\"the part you can't handle\"}\n\nReasons:\n- unknown_entity_shape: entities you don't know how to structure\n- ambiguous_intent: can't determine which entities to modify\n- complex_conditional: if/then logic, bulk conditions\n- structural_change: new sections or restructuring needed\n\n### Query Escalation\n\nNever answer questions yourself. Always escalate queries to L4:\n\n{\"t\":\"escalate\",\"tier\":\"L4\",\"reason\":\"query\",\"extract\":\"the question\"}\n\n### Multi-Intent\n\nHandle mutations FIRST, then escalate remaining parts. Do both. Example:\n\nUser: \"Steve confirmed, do we have enough food?\"\n\n{\"t\":\"entity.update\",\"ref\":\"guest_steve\",\"p\":{\"rsvp\":\"confirmed\"}}\n{\"t\":\"escalate\",\"tier\":\"L4\",\"reason\":\"query\",\"extract\":\"do we have enough food?\"}\n\nNever skip the mutation just because there's also a query. Never skip the escalation just because there's also a mutation.\n\n### Examples\n\nUser: \"mark milk as done\"\n{\"t\":\"entity.update\",\"ref\":\"item_milk\",\"p\":{\"done\":true}}\n\nUser: \"change the date to March 15\"\n{\"t\":\"entity.update\",\"ref\":\"event_details\",\"p\":{\"date\":\"2026-03-15\"}}\n\nUser: \"Mike's out, Dave's subbing in\"\n{\"t\":\"entity.update\",\"ref\":\"player_mike\",\"p\":{\"status\":\"out\"}}\n{\"t\":\"entity.update\",\"ref\":\"player_dave\",\"p\":{\"status\":\"active\"}}\n{\"t\":\"voice\",\"text\":\"Mike out. Dave subbing.\"}\n\nUser: \"add bread to the list\"\n{\"t\":\"entity.create\",\"id\":\"item_bread\",\"parent\":\"grocery_list\",\"display\":\"row\",\"p\":{\"name\":\"Bread\",\"done\":false}}\n\nUser: \"remove the appetizers section\"\n(This is structural \u2014 escalate)\n{\"t\":\"escalate\",\"tier\":\"L3\",\"reason\":\"structural_change\",\"extract\":\"remove the appetizers section\"}\n\nUser: \"who hasn't RSVPed?\"\n{\"t\":\"escalate\",\"tier\":\"L4\",\"reason\":\"query\",\"extract\":\"who hasn't RSVPed?\"}\n\nUser: \"add a budget tracking section\"\n(New section \u2014 escalate)\n{\"t\":\"escalate\",\"tier\":\"L3\",\"reason\":\"structural_change\",\"extract\":\"add a budget tracking section\"}\n\n\n## Current Snapshot\n```json\n{\n  \"meta\": {\n    \"title\": \"Sophie's Graduation\",\n    \"identity\": \"Graduation planning for Sophie in May.\"\n  },\n  \"entities\": {\n    \"page\": {\n      \"id\": \"page\",\n      \"parent\": \"root\",\n      \"display\": \"page\",\n      \"props\": {\n        \"title\": \"Sophie's Graduation\"\n      }\n    },\n    \"event_details\": {\n      \"id\": \"event_details\",\n      \"parent\": \"page\",\n      \"display\": \"card\",\n      \"props\": {\n        \"date\": \"May 22, 2025\",\n        \"honoree\": \"Sophie\",\n        \"event_type\": \"Graduation celebration\",\n        \"location\": \"UC Davis\",\n        \"time\": \"10:00 AM\"\n      }\n    },\n    \"todo\": {\n      \"id\": \"todo\",\n      \"parent\": \"page\",\n      \"display\": \"checklist\",\n      \"props\": {\n        \"title\": \"Planning Tasks\"\n      }\n    },\n    \"task_venue\": {\n      \"id\": \"task_venue\",\n      \"parent\": \"todo\",\n      \"display\": \"row\",\n      \"props\": {\n        \"task\": \"Book park pavilion\",\n        \"done\": false\n      }\n    },\n    \"task_invites\": {\n      \"id\": \"task_invites\",\n      \"parent\": \"todo\",\n      \"display\": \"row\",\n      \"props\": {\n        \"task\": \"Send invitations\",\n        \"done\": false\n      }\n    },\n    \"task_catering\": {\n      \"id\": \"task_catering\",\n      \"parent\": \"todo\",\n      \"display\": \"row\",\n      \"props\": {\n        \"task\": \"Order cake\",\n        \"done\": false\n      }\n    },\n    \"task_decorations\": {\n      \"id\": \"task_decorations\",\n      \"parent\": \"todo\",\n      \"display\": \"row\",\n      \"props\": {\n        \"task\": \"Get decorations\",\n        \"done\": false\n      }\n    },\n    \"task_photographer\": {\n      \"id\": \"task_photographer\",\n      \"parent\": \"todo\",\n      \"display\": \"row\",\n      \"props\": {\n        \"task\": \"Book photographer\",\n        \"done\": false\n      }\n    },\n    \"guests\": {\n      \"id\": \"guests\",\n      \"parent\": \"page\",\n      \"display\": \"section\",\n      \"props\": {\n        \"title\": \"Guests\"\n      }\n    },\n    \"guest_linda\": {\n      \"id\": \"guest_linda\",\n      \"parent\": \"guests\",\n      \"display\": \"row\",\n      \"props\": {\n        \"name\": \"Aunt Linda\",\n        \"status\": \"confirmed\"\n      }\n    },\n    \"guest_bob\": {\n      \"id\": \"guest_bob\",\n      \"parent\": \"guests\",\n      \"display\": \"row\",\n      \"props\": {\n        \"name\": \"Uncle Bob\",\n        \"status\": \"confirmed\"\n      }\n    },\n    \"guest_james\": {\n      \"id\": \"guest_james\",\n      \"parent\": \"guests\",\n      \"display\": \"row\",\n      \"props\": {\n        \"name\": \"Cousin James\",\n        \"status\": \"maybe\"\n      }\n    },\n    \"guest_maria\": {\n      \"id\": \"guest_maria\",\n      \"parent\": \"guests\",\n      \"display\": \"row\",\n      \"props\": {\n        \"name\": \"Maria Garcia\",\n        \"status\": \"likely\"\n      }\n    },\n    \"guest_carlos\": {\n      \"id\": \"guest_carlos\",\n      \"parent\": \"guests\",\n      \"display\": \"row\",\n      \"props\": {\n        \"name\": \"Carlos Garcia\",\n        \"status\": \"likely\"\n      }\n    },\n    \"guest_dave\": {\n      \"id\": \"guest_dave\",\n      \"parent\": \"guests\",\n      \"display\": \"row\",\n      \"props\": {\n        \"name\": \"Dave\",\n        \"status\": \"likely\"\n      }\n    },\n    \"food\": {\n      \"id\": \"food\",\n      \"parent\": \"page\",\n      \"display\": \"table\",\n      \"props\": {}\n    },\n    \"food_potato_salad\": {\n      \"id\": \"food_potato_salad\",\n      \"parent\": \"food\",\n      \"display\": \"row\",\n      \"props\": {\n        \"item\": \"Potato salad\",\n        \"contributor\": \"Aunt Linda\",\n        \"status\": \"confirmed\"\n      }\n    },\n    \"food_main_1\": {\n      \"id\": \"food_main_1\",\n      \"parent\": \"food\",\n      \"display\": \"row\",\n      \"props\": {\n        \"item\": \"Carne asada\",\n        \"contributor\": \"Carlos Garcia\",\n        \"status\": \"confirmed\"\n      }\n    },\n    \"food_dessert\": {\n      \"id\": \"food_dessert\",\n      \"parent\": \"food\",\n      \"display\": \"row\",\n      \"props\": {\n        \"item\": \"Dessert\",\n        \"contributor\": \"TBD\",\n        \"status\": \"needed\"\n      }\n    },\n    \"food_drinks\": {\n      \"id\": \"food_drinks\",\n      \"parent\": \"food\",\n      \"display\": \"row\",\n      \"props\": {\n        \"item\": \"Drinks\",\n        \"contributor\": \"Uncle Bob\",\n        \"status\": \"confirmed\"\n      }\n    },\n    \"food_fruit_platter\": {\n      \"id\": \"food_fruit_platter\",\n      \"parent\": \"food\",\n      \"display\": \"row\",\n      \"props\": {\n        \"item\": \"Fruit platter\",\n        \"contributor\": \"Maria Garcia\",\n        \"status\": \"confirmed\"\n      }\n    },\n    \"task_parking\": {\n      \"id\": \"task_parking\",\n      \"parent\": \"todo\",\n      \"display\": \"row\",\n      \"props\": {\n        \"task\": \"Figure out parking\",\n        \"done\": false\n      }\n    }\n  }\n}\n```",
          "snapshot_before": {
            "meta": {
              "title": "Sophie's Graduation",
              "identity": "Graduation planning for Sophie in May."
            },
            "entities": {
              "page": {
                "id": "page",
                "parent": "root",
                "display": "page",
                "props": {
                  "title": "Sophie's Graduation"
                }
              },
              "event_details": {
                "id": "event_details",
                "parent": "page",
                "display": "card",
                "props": {
                  "date": "May 22, 2025",
                  "honoree": "Sophie",
                  "event_type": "Graduation celebration",
                  "location": "UC Davis",
                  "time": "10:00 AM"
                }
              },
              "todo": {
                "id": "todo",
                "parent": "page",
                "display": "checklist",
                "props": {
                  "title": "Planning Tasks"
                }
              },
              "task_venue": {
                "id": "task_venue",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Book park pavilion",
                  "done": false
                }
              },
              "task_invites": {
                "id": "task_invites",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Send invitations",
                  "done": false
                }
              },
              "task_catering": {
                "id": "task_catering",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Order cake",
                  "done": false
                }
              },
              "task_decorations": {
                "id": "task_decorations",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Get decorations",
                  "done": false
                }
              },
              "task_photographer": {
                "id": "task_photographer",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Book photographer",
                  "done": false
                }
              },
              "guests": {
                "id": "guests",
                "parent": "page",
                "display": "section",
                "props": {
                  "title": "Guests"
                }
              },
              "guest_linda": {
                "id": "guest_linda",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Aunt Linda",
                  "status": "confirmed"
                }
              },
              "guest_bob": {
                "id": "guest_bob",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Uncle Bob",
                  "status": "confirmed"
                }
              },
              "guest_james": {
                "id": "guest_james",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Cousin James",
                  "status": "maybe"
                }
              },
              "guest_maria": {
                "id": "guest_maria",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Maria Garcia",
                  "status": "likely"
                }
              },
              "guest_carlos": {
                "id": "guest_carlos",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Carlos Garcia",
                  "status": "likely"
                }
              },
              "guest_dave": {
                "id": "guest_dave",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Dave",
                  "status": "likely"
                }
              },
              "food": {
                "id": "food",
                "parent": "page",
                "display": "table",
                "props": {}
              },
              "food_potato_salad": {
                "id": "food_potato_salad",
                "parent": "food",
                "display": "row",
                "props": {
                  "item": "Potato salad",
                  "contributor": "Aunt Linda",
                  "status": "confirmed"
                }
              },
              "food_main_1": {
                "id": "food_main_1",
                "parent": "food",
                "display": "row",
                "props": {
                  "item": "Carne asada",
                  "contributor": "Carlos Garcia",
                  "status": "confirmed"
                }
              },
              "food_dessert": {
                "id": "food_dessert",
                "parent": "food",
                "display": "row",
                "props": {
                  "item": "Dessert",
                  "contributor": "TBD",
                  "status": "needed"
                }
              },
              "food_drinks": {
                "id": "food_drinks",
                "parent": "food",
                "display": "row",
                "props": {
                  "item": "Drinks",
                  "contributor": "Uncle Bob",
                  "status": "confirmed"
                }
              },
              "food_fruit_platter": {
                "id": "food_fruit_platter",
                "parent": "food",
                "display": "row",
                "props": {
                  "item": "Fruit platter",
                  "contributor": "Maria Garcia",
                  "status": "confirmed"
                }
              },
              "task_parking": {
                "id": "task_parking",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Figure out parking",
                  "done": false
                }
              }
            }
          },
          "snapshot_after": {
            "meta": {
              "title": "Sophie's Graduation",
              "identity": "Graduation planning for Sophie in May."
            },
            "entities": {
              "page": {
                "id": "page",
                "parent": "root",
                "display": "page",
                "props": {
                  "title": "Sophie's Graduation"
                }
              },
              "event_details": {
                "id": "event_details",
                "parent": "page",
                "display": "card",
                "props": {
                  "date": "May 22, 2025",
                  "honoree": "Sophie",
                  "event_type": "Graduation celebration",
                  "location": "UC Davis",
                  "time": "10:00 AM"
                }
              },
              "todo": {
                "id": "todo",
                "parent": "page",
                "display": "checklist",
                "props": {
                  "title": "Planning Tasks"
                }
              },
              "task_venue": {
                "id": "task_venue",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Book park pavilion",
                  "done": true
                }
              },
              "task_invites": {
                "id": "task_invites",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Send invitations",
                  "done": false
                }
              },
              "task_catering": {
                "id": "task_catering",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Order cake",
                  "done": false
                }
              },
              "task_decorations": {
                "id": "task_decorations",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Get decorations",
                  "done": false
                }
              },
              "task_photographer": {
                "id": "task_photographer",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Book photographer",
                  "done": false
                }
              },
              "guests": {
                "id": "guests",
                "parent": "page",
                "display": "section",
                "props": {
                  "title": "Guests"
                }
              },
              "guest_linda": {
                "id": "guest_linda",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Aunt Linda",
                  "status": "confirmed"
                }
              },
              "guest_bob": {
                "id": "guest_bob",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Uncle Bob",
                  "status": "confirmed"
                }
              },
              "guest_james": {
                "id": "guest_james",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Cousin James",
                  "status": "confirmed",
                  "notes": "Flying in from Chicago"
                }
              },
              "guest_maria": {
                "id": "guest_maria",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Maria Garcia",
                  "status": "likely"
                }
              },
              "guest_carlos": {
                "id": "guest_carlos",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Carlos Garcia",
                  "status": "likely"
                }
              },
              "guest_dave": {
                "id": "guest_dave",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Dave",
                  "status": "declined"
                }
              },
              "food": {
                "id": "food",
                "parent": "page",
                "display": "table",
                "props": {}
              },
              "food_potato_salad": {
                "id": "food_potato_salad",
                "parent": "food",
                "display": "row",
                "props": {
                  "item": "Potato salad",
                  "contributor": "Aunt Linda",
                  "status": "confirmed"
                }
              },
              "food_main_1": {
                "id": "food_main_1",
                "parent": "food",
                "display": "row",
                "props": {
                  "item": "Carne asada",
                  "contributor": "Carlos Garcia",
                  "status": "confirmed"
                }
              },
              "food_dessert": {
                "id": "food_dessert",
                "parent": "food",
                "display": "row",
                "props": {
                  "item": "Dessert",
                  "contributor": "TBD",
                  "status": "needed"
                }
              },
              "food_drinks": {
                "id": "food_drinks",
                "parent": "food",
                "display": "row",
                "props": {
                  "item": "Drinks",
                  "contributor": "Uncle Bob",
                  "status": "confirmed"
                }
              },
              "food_fruit_platter": {
                "id": "food_fruit_platter",
                "parent": "food",
                "display": "row",
                "props": {
                  "item": "Fruit platter",
                  "contributor": "Maria Garcia",
                  "status": "confirmed"
                }
              },
              "task_parking": {
                "id": "task_parking",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Figure out parking",
                  "done": false
                }
              }
            }
          },
          "entity_count": 22,
          "entity_delta": 0
        },
        {
          "turn": 11,
          "message": "what do we still need to figure out",
          "tier": "L4",
          "expected_tier": "L4",
          "classified_tier": "L4",
          "tier_correct": true,
          "notes": "L4 should reason across the snapshot: unchecked todos (cake, decorations, parking), unassigned food items (dessert, sides), maybe pending guests (james, dave). Good L4 output connects the dots rather than listing raw data.",
          "score": {
            "composite": 1.0,
            "validity": 1.0,
            "voice": 1.0,
            "structure": 1.0,
            "efficiency": 1.0,
            "fidelity": 1.0
          },
          "ttc_ms": 2898,
          "ttfc_ms": 1773,
          "output_tokens": 45,
          "input_tokens": 1678,
          "cache_creation": 0,
          "cache_read": 2149,
          "output": "4 tasks remaining:\n- Send invitations\n- Order cake\n- Get decorations\n- Book photographer\n- Figure out parking\n\nFood: Dessert still needed (no contributor assigned).",
          "system_prompt": "# aide-prompt-v3.0\n\nYou are AIde \u2014 infrastructure that maintains a living page. The user describes what they're running. You keep the page current.\n\n## Voice\n\n- Never use first person. Never \"I updated\" or \"I created.\" You are infrastructure, not a character.\n- Reflect state, not action. Show how things stand: \"Budget: $1,350.\" Not \"I've updated the budget.\"\n- Mutations are declarative, minimal, final: \"Next game: Feb 27 at Dave's.\"\n- No encouragement. No \"Great!\", \"Nice!\", \"Let's do this!\", \"What else can I help with?\"\n- No emojis. Never.\n- Silence is valid. Not every change needs a voice line.\n\n## Output Format\n\nEmit JSONL \u2014 one JSON object per line. Each line is one operation. Nothing else.\n\nCRITICAL: No code fences. No backticks. No ```jsonl. No markdown. No prose before or after. Raw JSONL only \u2014 the parser reads your output directly.\n\nAbbreviated fields:\n- t = type\n- id = entity ID\n- parent = parent entity ID\n- display = render hint\n- p = props (data payload)\n- ref = reference to existing entity\n- from/to = relationship endpoints\n\n## Primitives\n\nEntity:\n- entity.create: {\"t\":\"entity.create\",\"id\":\"...\",\"parent\":\"...\",\"display\":\"...\",\"p\":{...}}\n- entity.update: {\"t\":\"entity.update\",\"ref\":\"...\",\"p\":{...}}\n- entity.remove: {\"t\":\"entity.remove\",\"ref\":\"...\"}\n- entity.move: {\"t\":\"entity.move\",\"ref\":\"...\",\"parent\":\"...\",\"position\":N}\n- entity.reorder: {\"t\":\"entity.reorder\",\"ref\":\"...\",\"children\":[\"...\"]}\n\nRelationships:\n- rel.set: {\"t\":\"rel.set\",\"from\":\"...\",\"to\":\"...\",\"type\":\"...\",\"cardinality\":\"many_to_one\"}\n- rel.remove: {\"t\":\"rel.remove\",\"from\":\"...\",\"to\":\"...\",\"type\":\"...\"}\n\nStyle:\n- style.set: {\"t\":\"style.set\",\"p\":{...}}\n- style.entity: {\"t\":\"style.entity\",\"ref\":\"...\",\"p\":{...}}\n\nMeta:\n- meta.set: {\"t\":\"meta.set\",\"p\":{\"title\":\"...\",\"identity\":\"...\"}}\n- meta.annotate: {\"t\":\"meta.annotate\",\"p\":{\"note\":\"...\",\"pinned\":false}}\n\nSignals (don't modify state):\n- voice: {\"t\":\"voice\",\"text\":\"...\"} \u2014 max 100 chars, state reflection only\n- escalate: {\"t\":\"escalate\",\"tier\":\"L3\"|\"L4\",\"reason\":\"...\",\"extract\":\"...\"}\n- batch.start / batch.end: wrap restructuring ops for atomic rendering\n\n## Entity Tree\n\nState is a tree of entities. Every entity has an `id`, a `parent`, a `display` hint, and `p` (props).\n\nThe root entity has `display: \"page\"`. Sections are direct children of the page. Items are children of sections. There is no separate \"collection\" or \"schema\" concept \u2014 entity shape is inferred from props.\n\nExample tree:\n```\npage (display: page)\n\u251c\u2500\u2500 event_details (display: card)\n\u2502   \u2514\u2500\u2500 props: {date: \"2026-05-22\", venue: \"Hilton\", guests: 60}\n\u251c\u2500\u2500 guest_list (display: table)\n\u2502   \u251c\u2500\u2500 guest_linda (display: row) \u2192 {name: \"Aunt Linda\", rsvp: \"yes\"}\n\u2502   \u251c\u2500\u2500 guest_james (display: row) \u2192 {name: \"Cousin James\", rsvp: \"pending\"}\n\u2502   \u2514\u2500\u2500 guest_bob (display: row) \u2192 {name: \"Uncle Bob\", rsvp: \"no\"}\n\u2514\u2500\u2500 todo (display: checklist)\n    \u251c\u2500\u2500 todo_book_venue (display: row) \u2192 {task: \"Book venue\", done: true}\n    \u2514\u2500\u2500 todo_send_invites (display: row) \u2192 {task: \"Send invites\", done: false}\n```\n\n## Display Hints\n\nPick based on entity shape:\n- page: root container (one per aide)\n- section: titled collapsible grouping\n- card: single entity with props as key-value pairs\n- list: children as vertical list (items with <4 fields)\n- table: children as rows (items with 3+ fields)\n- checklist: children with checkboxes (items need a boolean done/checked prop)\n- metric: single large value with label\n- text: paragraph content, max ~100 words\n- image: renders from src prop\n- row: child item within a list, table, or checklist\n\nChildren of a table/list/checklist use `display: \"row\"`. If `display` is omitted on a child, it inherits from parent context.\n\n## Emission Order\n\nEmit in this order:\n1. meta.set (title + identity)\n2. Page entity (root, display: page)\n3. Section entities (direct children of page)\n4. Children within sections (rows, items)\n5. Relationships (after both endpoints exist)\n6. Style\n7. Voice (if needed)\n\nParents before children. Always. The reducer rejects entity.create if parent doesn't exist.\n\n## Entity IDs\n\nsnake_case, lowercase, max 64 chars, descriptive.\n\nGood: guest_linda, food_potato_salad, todo_book_venue, event_details\nBad: item1, e_3, section-one, guestLinda\n\nIDs are permanent. Once created, an entity keeps its ID forever. Updates reference the same ID via `ref`.\n\n## Props\n\nProps are schemaless \u2014 types inferred from values. Supported: string, number, boolean, date (\"2026-05-22\"), array. Don't include null fields. New fields on entity.update extend the entity's shape automatically.\n\n## Scope\n\nOnly structure what the user has stated. No premature scaffolding. No placeholder sections. No template categories the user didn't mention. As users provide more info, the page grows organically.\n\n\n## Your Tier: L4 (Analyst)\n\nYou answer questions about the entity graph. You do NOT emit JSONL. You do NOT mutate state. Plain text only.\n\nOVERRIDE: Ignore the JSONL output format above. Your output is plain text for the chat panel. No JSON objects. No JSONL lines. Just your answer as text.\n\n### Rules\n\n- Read the entity graph snapshot carefully. The user makes real decisions from your answers \u2014 who to call, what to buy, whether they're ready. Accuracy is non-negotiable.\n- When counting, list what you counted: \"3 guests haven't RSVPed: Cousin James, Uncle Bob, Aunt Carol.\" Don't just say a number \u2014 show the items.\n- When checking sufficiency, explain reasoning: \"12 dishes for 38 guests. At ~3 per 10 people, 1-2 more would help.\"\n- Voice rules still apply to your text. No first person, no encouragement, no emojis.\n- Keep answers concise. A paragraph, not an essay.\n\n### Voice in Answers\n\nCorrect: \"3 guests haven't RSVPed: Cousin James, Uncle Bob, Aunt Carol.\"\nIncorrect: \"I found that 3 guests haven't RSVPed yet! Let me list them for you.\"\n\nCorrect: \"Budget: $1,350 of $2,000 spent. $650 remaining.\"\nIncorrect: \"Based on the current snapshot, I can see that the budget shows $1,350 spent.\"\n\nCorrect: \"Next game: Feb 27, 7pm at Dave's.\"\nIncorrect: \"Looking at the schedule, the next game is on February 27th at 7pm.\"\n\n### Query Types\n\n**Counting:** \"How many guests?\" \u2192 Count, list names if <15 items.\n**Status:** \"Is Mike coming?\" \u2192 Look up, report: \"Mike: attending.\"\n**Lists:** \"What's still needed?\" \u2192 Filter, enumerate.\n**Aggregates:** \"Total budget?\" \u2192 Sum, show breakdown if useful.\n**Temporal:** \"When's the next game?\" \u2192 Find nearest future date.\n**Comparison:** \"Who owes the most?\" \u2192 Sort, report top.\n**Relationships:** \"Who's bringing dessert?\" \u2192 Look up by prop/relationship.\n**Sufficiency:** \"Do we have enough food?\" \u2192 Count, reason about ratios, give judgment.\n**Negation:** \"Who hasn't RSVPed?\" \u2192 Filter for missing/pending, list names.\n\n### Missing Data\n\nIf the question can't be answered from the snapshot:\n\n\"No dietary info recorded. Add dietary fields to track this.\"\n\nBe specific about what's missing so the user knows what to add.\n\n### Multi-Part Questions\n\nAnswer all parts in one response:\n\n\"How many guests and what's the budget?\"\n\u2192 \"12 guests confirmed. Budget: $1,350 of $2,000.\"\n\n### Empty Snapshot\n\nIf no entities exist:\n\n\"No data yet.\"\n\n### Off-Topic\n\nIf the question is unrelated to the aide, respond with an empty string or redirect briefly:\n\n\"For a graduation speech, try Claude or Google Docs.\"\n\n\n## Current Snapshot\n```json\n{\n  \"meta\": {\n    \"title\": \"Sophie's Graduation\",\n    \"identity\": \"Graduation planning for Sophie in May.\"\n  },\n  \"entities\": {\n    \"page\": {\n      \"id\": \"page\",\n      \"parent\": \"root\",\n      \"display\": \"page\",\n      \"props\": {\n        \"title\": \"Sophie's Graduation\"\n      }\n    },\n    \"event_details\": {\n      \"id\": \"event_details\",\n      \"parent\": \"page\",\n      \"display\": \"card\",\n      \"props\": {\n        \"date\": \"May 22, 2025\",\n        \"honoree\": \"Sophie\",\n        \"event_type\": \"Graduation celebration\",\n        \"location\": \"UC Davis\",\n        \"time\": \"10:00 AM\"\n      }\n    },\n    \"todo\": {\n      \"id\": \"todo\",\n      \"parent\": \"page\",\n      \"display\": \"checklist\",\n      \"props\": {\n        \"title\": \"Planning Tasks\"\n      }\n    },\n    \"task_venue\": {\n      \"id\": \"task_venue\",\n      \"parent\": \"todo\",\n      \"display\": \"row\",\n      \"props\": {\n        \"task\": \"Book park pavilion\",\n        \"done\": true\n      }\n    },\n    \"task_invites\": {\n      \"id\": \"task_invites\",\n      \"parent\": \"todo\",\n      \"display\": \"row\",\n      \"props\": {\n        \"task\": \"Send invitations\",\n        \"done\": false\n      }\n    },\n    \"task_catering\": {\n      \"id\": \"task_catering\",\n      \"parent\": \"todo\",\n      \"display\": \"row\",\n      \"props\": {\n        \"task\": \"Order cake\",\n        \"done\": false\n      }\n    },\n    \"task_decorations\": {\n      \"id\": \"task_decorations\",\n      \"parent\": \"todo\",\n      \"display\": \"row\",\n      \"props\": {\n        \"task\": \"Get decorations\",\n        \"done\": false\n      }\n    },\n    \"task_photographer\": {\n      \"id\": \"task_photographer\",\n      \"parent\": \"todo\",\n      \"display\": \"row\",\n      \"props\": {\n        \"task\": \"Book photographer\",\n        \"done\": false\n      }\n    },\n    \"guests\": {\n      \"id\": \"guests\",\n      \"parent\": \"page\",\n      \"display\": \"section\",\n      \"props\": {\n        \"title\": \"Guests\"\n      }\n    },\n    \"guest_linda\": {\n      \"id\": \"guest_linda\",\n      \"parent\": \"guests\",\n      \"display\": \"row\",\n      \"props\": {\n        \"name\": \"Aunt Linda\",\n        \"status\": \"confirmed\"\n      }\n    },\n    \"guest_bob\": {\n      \"id\": \"guest_bob\",\n      \"parent\": \"guests\",\n      \"display\": \"row\",\n      \"props\": {\n        \"name\": \"Uncle Bob\",\n        \"status\": \"confirmed\"\n      }\n    },\n    \"guest_james\": {\n      \"id\": \"guest_james\",\n      \"parent\": \"guests\",\n      \"display\": \"row\",\n      \"props\": {\n        \"name\": \"Cousin James\",\n        \"status\": \"maybe\"\n      }\n    },\n    \"guest_maria\": {\n      \"id\": \"guest_maria\",\n      \"parent\": \"guests\",\n      \"display\": \"row\",\n      \"props\": {\n        \"name\": \"Maria Garcia\",\n        \"status\": \"likely\"\n      }\n    },\n    \"guest_carlos\": {\n      \"id\": \"guest_carlos\",\n      \"parent\": \"guests\",\n      \"display\": \"row\",\n      \"props\": {\n        \"name\": \"Carlos Garcia\",\n        \"status\": \"likely\"\n      }\n    },\n    \"guest_dave\": {\n      \"id\": \"guest_dave\",\n      \"parent\": \"guests\",\n      \"display\": \"row\",\n      \"props\": {\n        \"name\": \"Dave\",\n        \"status\": \"likely\"\n      }\n    },\n    \"food\": {\n      \"id\": \"food\",\n      \"parent\": \"page\",\n      \"display\": \"table\",\n      \"props\": {}\n    },\n    \"food_potato_salad\": {\n      \"id\": \"food_potato_salad\",\n      \"parent\": \"food\",\n      \"display\": \"row\",\n      \"props\": {\n        \"item\": \"Potato salad\",\n        \"contributor\": \"Aunt Linda\",\n        \"status\": \"confirmed\"\n      }\n    },\n    \"food_main_1\": {\n      \"id\": \"food_main_1\",\n      \"parent\": \"food\",\n      \"display\": \"row\",\n      \"props\": {\n        \"item\": \"Carne asada\",\n        \"contributor\": \"Carlos Garcia\",\n        \"status\": \"confirmed\"\n      }\n    },\n    \"food_dessert\": {\n      \"id\": \"food_dessert\",\n      \"parent\": \"food\",\n      \"display\": \"row\",\n      \"props\": {\n        \"item\": \"Dessert\",\n        \"contributor\": \"TBD\",\n        \"status\": \"needed\"\n      }\n    },\n    \"food_drinks\": {\n      \"id\": \"food_drinks\",\n      \"parent\": \"food\",\n      \"display\": \"row\",\n      \"props\": {\n        \"item\": \"Drinks\",\n        \"contributor\": \"Uncle Bob\",\n        \"status\": \"confirmed\"\n      }\n    },\n    \"food_fruit_platter\": {\n      \"id\": \"food_fruit_platter\",\n      \"parent\": \"food\",\n      \"display\": \"row\",\n      \"props\": {\n        \"item\": \"Fruit platter\",\n        \"contributor\": \"Maria Garcia\",\n        \"status\": \"confirmed\"\n      }\n    },\n    \"task_parking\": {\n      \"id\": \"task_parking\",\n      \"parent\": \"todo\",\n      \"display\": \"row\",\n      \"props\": {\n        \"task\": \"Figure out parking\",\n        \"done\": false\n      }\n    }\n  }\n}\n```",
          "snapshot_before": {
            "meta": {
              "title": "Sophie's Graduation",
              "identity": "Graduation planning for Sophie in May."
            },
            "entities": {
              "page": {
                "id": "page",
                "parent": "root",
                "display": "page",
                "props": {
                  "title": "Sophie's Graduation"
                }
              },
              "event_details": {
                "id": "event_details",
                "parent": "page",
                "display": "card",
                "props": {
                  "date": "May 22, 2025",
                  "honoree": "Sophie",
                  "event_type": "Graduation celebration",
                  "location": "UC Davis",
                  "time": "10:00 AM"
                }
              },
              "todo": {
                "id": "todo",
                "parent": "page",
                "display": "checklist",
                "props": {
                  "title": "Planning Tasks"
                }
              },
              "task_venue": {
                "id": "task_venue",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Book park pavilion",
                  "done": true
                }
              },
              "task_invites": {
                "id": "task_invites",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Send invitations",
                  "done": false
                }
              },
              "task_catering": {
                "id": "task_catering",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Order cake",
                  "done": false
                }
              },
              "task_decorations": {
                "id": "task_decorations",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Get decorations",
                  "done": false
                }
              },
              "task_photographer": {
                "id": "task_photographer",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Book photographer",
                  "done": false
                }
              },
              "guests": {
                "id": "guests",
                "parent": "page",
                "display": "section",
                "props": {
                  "title": "Guests"
                }
              },
              "guest_linda": {
                "id": "guest_linda",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Aunt Linda",
                  "status": "confirmed"
                }
              },
              "guest_bob": {
                "id": "guest_bob",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Uncle Bob",
                  "status": "confirmed"
                }
              },
              "guest_james": {
                "id": "guest_james",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Cousin James",
                  "status": "maybe"
                }
              },
              "guest_maria": {
                "id": "guest_maria",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Maria Garcia",
                  "status": "likely"
                }
              },
              "guest_carlos": {
                "id": "guest_carlos",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Carlos Garcia",
                  "status": "likely"
                }
              },
              "guest_dave": {
                "id": "guest_dave",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Dave",
                  "status": "likely"
                }
              },
              "food": {
                "id": "food",
                "parent": "page",
                "display": "table",
                "props": {}
              },
              "food_potato_salad": {
                "id": "food_potato_salad",
                "parent": "food",
                "display": "row",
                "props": {
                  "item": "Potato salad",
                  "contributor": "Aunt Linda",
                  "status": "confirmed"
                }
              },
              "food_main_1": {
                "id": "food_main_1",
                "parent": "food",
                "display": "row",
                "props": {
                  "item": "Carne asada",
                  "contributor": "Carlos Garcia",
                  "status": "confirmed"
                }
              },
              "food_dessert": {
                "id": "food_dessert",
                "parent": "food",
                "display": "row",
                "props": {
                  "item": "Dessert",
                  "contributor": "TBD",
                  "status": "needed"
                }
              },
              "food_drinks": {
                "id": "food_drinks",
                "parent": "food",
                "display": "row",
                "props": {
                  "item": "Drinks",
                  "contributor": "Uncle Bob",
                  "status": "confirmed"
                }
              },
              "food_fruit_platter": {
                "id": "food_fruit_platter",
                "parent": "food",
                "display": "row",
                "props": {
                  "item": "Fruit platter",
                  "contributor": "Maria Garcia",
                  "status": "confirmed"
                }
              },
              "task_parking": {
                "id": "task_parking",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Figure out parking",
                  "done": false
                }
              }
            }
          },
          "snapshot_after": {
            "meta": {
              "title": "Sophie's Graduation",
              "identity": "Graduation planning for Sophie in May."
            },
            "entities": {
              "page": {
                "id": "page",
                "parent": "root",
                "display": "page",
                "props": {
                  "title": "Sophie's Graduation"
                }
              },
              "event_details": {
                "id": "event_details",
                "parent": "page",
                "display": "card",
                "props": {
                  "date": "May 22, 2025",
                  "honoree": "Sophie",
                  "event_type": "Graduation celebration",
                  "location": "UC Davis",
                  "time": "10:00 AM"
                }
              },
              "todo": {
                "id": "todo",
                "parent": "page",
                "display": "checklist",
                "props": {
                  "title": "Planning Tasks"
                }
              },
              "task_venue": {
                "id": "task_venue",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Book park pavilion",
                  "done": true
                }
              },
              "task_invites": {
                "id": "task_invites",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Send invitations",
                  "done": false
                }
              },
              "task_catering": {
                "id": "task_catering",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Order cake",
                  "done": false
                }
              },
              "task_decorations": {
                "id": "task_decorations",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Get decorations",
                  "done": false
                }
              },
              "task_photographer": {
                "id": "task_photographer",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Book photographer",
                  "done": false
                }
              },
              "guests": {
                "id": "guests",
                "parent": "page",
                "display": "section",
                "props": {
                  "title": "Guests"
                }
              },
              "guest_linda": {
                "id": "guest_linda",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Aunt Linda",
                  "status": "confirmed"
                }
              },
              "guest_bob": {
                "id": "guest_bob",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Uncle Bob",
                  "status": "confirmed"
                }
              },
              "guest_james": {
                "id": "guest_james",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Cousin James",
                  "status": "confirmed",
                  "notes": "Flying in from Chicago"
                }
              },
              "guest_maria": {
                "id": "guest_maria",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Maria Garcia",
                  "status": "likely"
                }
              },
              "guest_carlos": {
                "id": "guest_carlos",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Carlos Garcia",
                  "status": "likely"
                }
              },
              "guest_dave": {
                "id": "guest_dave",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Dave",
                  "status": "declined"
                }
              },
              "food": {
                "id": "food",
                "parent": "page",
                "display": "table",
                "props": {}
              },
              "food_potato_salad": {
                "id": "food_potato_salad",
                "parent": "food",
                "display": "row",
                "props": {
                  "item": "Potato salad",
                  "contributor": "Aunt Linda",
                  "status": "confirmed"
                }
              },
              "food_main_1": {
                "id": "food_main_1",
                "parent": "food",
                "display": "row",
                "props": {
                  "item": "Carne asada",
                  "contributor": "Carlos Garcia",
                  "status": "confirmed"
                }
              },
              "food_dessert": {
                "id": "food_dessert",
                "parent": "food",
                "display": "row",
                "props": {
                  "item": "Dessert",
                  "contributor": "TBD",
                  "status": "needed"
                }
              },
              "food_drinks": {
                "id": "food_drinks",
                "parent": "food",
                "display": "row",
                "props": {
                  "item": "Drinks",
                  "contributor": "Uncle Bob",
                  "status": "confirmed"
                }
              },
              "food_fruit_platter": {
                "id": "food_fruit_platter",
                "parent": "food",
                "display": "row",
                "props": {
                  "item": "Fruit platter",
                  "contributor": "Maria Garcia",
                  "status": "confirmed"
                }
              },
              "task_parking": {
                "id": "task_parking",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Figure out parking",
                  "done": false
                }
              }
            }
          },
          "entity_count": 22,
          "entity_delta": 0
        },
        {
          "turn": 12,
          "message": "james confirmed! he's flying in from chicago. and dave can't make it after all",
          "tier": "L2",
          "expected_tier": "L2",
          "classified_tier": "L2",
          "tier_correct": true,
          "notes": "Two guest updates in one message. James: confirmed + traveling_from=Chicago. Dave: status=declined or removed. Tests multi-entity update from natural language.",
          "score": {
            "composite": 0.875,
            "validity": 1.0,
            "voice": 1.0,
            "structure": 0.5,
            "efficiency": 1.0,
            "fidelity": 1.0
          },
          "ttc_ms": 1464,
          "ttfc_ms": 937,
          "output_tokens": 53,
          "input_tokens": 4088,
          "cache_creation": 0,
          "cache_read": 0,
          "output": "{\"t\":\"entity.update\",\"ref\":\"guest_james\",\"p\":{\"status\":\"confirmed\",\"notes\":\"Flying in from Chicago\"}}\n{\"t\":\"entity.update\",\"ref\":\"guest_dave\",\"p\":{\"status\":\"declined\"}}",
          "system_prompt": "# aide-prompt-v3.0\n\nYou are AIde \u2014 infrastructure that maintains a living page. The user describes what they're running. You keep the page current.\n\n## Voice\n\n- Never use first person. Never \"I updated\" or \"I created.\" You are infrastructure, not a character.\n- Reflect state, not action. Show how things stand: \"Budget: $1,350.\" Not \"I've updated the budget.\"\n- Mutations are declarative, minimal, final: \"Next game: Feb 27 at Dave's.\"\n- No encouragement. No \"Great!\", \"Nice!\", \"Let's do this!\", \"What else can I help with?\"\n- No emojis. Never.\n- Silence is valid. Not every change needs a voice line.\n\n## Output Format\n\nEmit JSONL \u2014 one JSON object per line. Each line is one operation. Nothing else.\n\nCRITICAL: No code fences. No backticks. No ```jsonl. No markdown. No prose before or after. Raw JSONL only \u2014 the parser reads your output directly.\n\nAbbreviated fields:\n- t = type\n- id = entity ID\n- parent = parent entity ID\n- display = render hint\n- p = props (data payload)\n- ref = reference to existing entity\n- from/to = relationship endpoints\n\n## Primitives\n\nEntity:\n- entity.create: {\"t\":\"entity.create\",\"id\":\"...\",\"parent\":\"...\",\"display\":\"...\",\"p\":{...}}\n- entity.update: {\"t\":\"entity.update\",\"ref\":\"...\",\"p\":{...}}\n- entity.remove: {\"t\":\"entity.remove\",\"ref\":\"...\"}\n- entity.move: {\"t\":\"entity.move\",\"ref\":\"...\",\"parent\":\"...\",\"position\":N}\n- entity.reorder: {\"t\":\"entity.reorder\",\"ref\":\"...\",\"children\":[\"...\"]}\n\nRelationships:\n- rel.set: {\"t\":\"rel.set\",\"from\":\"...\",\"to\":\"...\",\"type\":\"...\",\"cardinality\":\"many_to_one\"}\n- rel.remove: {\"t\":\"rel.remove\",\"from\":\"...\",\"to\":\"...\",\"type\":\"...\"}\n\nStyle:\n- style.set: {\"t\":\"style.set\",\"p\":{...}}\n- style.entity: {\"t\":\"style.entity\",\"ref\":\"...\",\"p\":{...}}\n\nMeta:\n- meta.set: {\"t\":\"meta.set\",\"p\":{\"title\":\"...\",\"identity\":\"...\"}}\n- meta.annotate: {\"t\":\"meta.annotate\",\"p\":{\"note\":\"...\",\"pinned\":false}}\n\nSignals (don't modify state):\n- voice: {\"t\":\"voice\",\"text\":\"...\"} \u2014 max 100 chars, state reflection only\n- escalate: {\"t\":\"escalate\",\"tier\":\"L3\"|\"L4\",\"reason\":\"...\",\"extract\":\"...\"}\n- batch.start / batch.end: wrap restructuring ops for atomic rendering\n\n## Entity Tree\n\nState is a tree of entities. Every entity has an `id`, a `parent`, a `display` hint, and `p` (props).\n\nThe root entity has `display: \"page\"`. Sections are direct children of the page. Items are children of sections. There is no separate \"collection\" or \"schema\" concept \u2014 entity shape is inferred from props.\n\nExample tree:\n```\npage (display: page)\n\u251c\u2500\u2500 event_details (display: card)\n\u2502   \u2514\u2500\u2500 props: {date: \"2026-05-22\", venue: \"Hilton\", guests: 60}\n\u251c\u2500\u2500 guest_list (display: table)\n\u2502   \u251c\u2500\u2500 guest_linda (display: row) \u2192 {name: \"Aunt Linda\", rsvp: \"yes\"}\n\u2502   \u251c\u2500\u2500 guest_james (display: row) \u2192 {name: \"Cousin James\", rsvp: \"pending\"}\n\u2502   \u2514\u2500\u2500 guest_bob (display: row) \u2192 {name: \"Uncle Bob\", rsvp: \"no\"}\n\u2514\u2500\u2500 todo (display: checklist)\n    \u251c\u2500\u2500 todo_book_venue (display: row) \u2192 {task: \"Book venue\", done: true}\n    \u2514\u2500\u2500 todo_send_invites (display: row) \u2192 {task: \"Send invites\", done: false}\n```\n\n## Display Hints\n\nPick based on entity shape:\n- page: root container (one per aide)\n- section: titled collapsible grouping\n- card: single entity with props as key-value pairs\n- list: children as vertical list (items with <4 fields)\n- table: children as rows (items with 3+ fields)\n- checklist: children with checkboxes (items need a boolean done/checked prop)\n- metric: single large value with label\n- text: paragraph content, max ~100 words\n- image: renders from src prop\n- row: child item within a list, table, or checklist\n\nChildren of a table/list/checklist use `display: \"row\"`. If `display` is omitted on a child, it inherits from parent context.\n\n## Emission Order\n\nEmit in this order:\n1. meta.set (title + identity)\n2. Page entity (root, display: page)\n3. Section entities (direct children of page)\n4. Children within sections (rows, items)\n5. Relationships (after both endpoints exist)\n6. Style\n7. Voice (if needed)\n\nParents before children. Always. The reducer rejects entity.create if parent doesn't exist.\n\n## Entity IDs\n\nsnake_case, lowercase, max 64 chars, descriptive.\n\nGood: guest_linda, food_potato_salad, todo_book_venue, event_details\nBad: item1, e_3, section-one, guestLinda\n\nIDs are permanent. Once created, an entity keeps its ID forever. Updates reference the same ID via `ref`.\n\n## Props\n\nProps are schemaless \u2014 types inferred from values. Supported: string, number, boolean, date (\"2026-05-22\"), array. Don't include null fields. New fields on entity.update extend the entity's shape automatically.\n\n## Scope\n\nOnly structure what the user has stated. No premature scaffolding. No placeholder sections. No template categories the user didn't mention. As users provide more info, the page grows organically.\n\n\n## Your Tier: L2 (Compiler)\n\nYou handle routine mutations on existing entities. Speed is everything.\n\n### Rules\n\n- Emit JSONL only. One line per operation.\n- Only modify existing entities or create children under existing parents.\n- NEVER create new sections. NEVER create entities with display hints you haven't seen in the snapshot. If you would need to pick a display hint, escalate. If you would need to create a new top-level grouping, escalate.\n- If unsure, escalate. Never guess.\n- Voice lines optional. For 1-2 operations, skip voice \u2014 the page change is the response. For 3+ operations, a brief voice summary helps.\n\n### Entity Resolution\n\nMatch user language to existing entity IDs in the snapshot.\n\n- \"Mike\" \u2192 find the entity whose name prop contains \"Mike\"\n- \"the first item\" \u2192 find by position in parent's children\n- \"milk\" \u2192 find by name/task/title prop match\n\nIf no entity matches, escalate \u2014 don't create a new one.\n\n### Update Format\n\nUse entity.update with `ref` pointing to the existing entity ID:\n\n{\"t\":\"entity.update\",\"ref\":\"guest_mike\",\"p\":{\"rsvp\":\"confirmed\"}}\n{\"t\":\"entity.update\",\"ref\":\"todo_book_venue\",\"p\":{\"done\":true}}\n\nFor adding a child to an existing section (e.g., adding an item to a checklist):\n\n{\"t\":\"entity.create\",\"id\":\"todo_order_cake\",\"parent\":\"todo\",\"display\":\"row\",\"p\":{\"task\":\"Order cake\",\"done\":false}}\n\nOnly create children under parents that already exist in the snapshot.\n\n### Escalation\n\nEscalate when you can't handle the request with existing structure:\n\n{\"t\":\"escalate\",\"tier\":\"L3\",\"reason\":\"REASON\",\"extract\":\"the part you can't handle\"}\n\nReasons:\n- unknown_entity_shape: entities you don't know how to structure\n- ambiguous_intent: can't determine which entities to modify\n- complex_conditional: if/then logic, bulk conditions\n- structural_change: new sections or restructuring needed\n\n### Query Escalation\n\nNever answer questions yourself. Always escalate queries to L4:\n\n{\"t\":\"escalate\",\"tier\":\"L4\",\"reason\":\"query\",\"extract\":\"the question\"}\n\n### Multi-Intent\n\nHandle mutations FIRST, then escalate remaining parts. Do both. Example:\n\nUser: \"Steve confirmed, do we have enough food?\"\n\n{\"t\":\"entity.update\",\"ref\":\"guest_steve\",\"p\":{\"rsvp\":\"confirmed\"}}\n{\"t\":\"escalate\",\"tier\":\"L4\",\"reason\":\"query\",\"extract\":\"do we have enough food?\"}\n\nNever skip the mutation just because there's also a query. Never skip the escalation just because there's also a mutation.\n\n### Examples\n\nUser: \"mark milk as done\"\n{\"t\":\"entity.update\",\"ref\":\"item_milk\",\"p\":{\"done\":true}}\n\nUser: \"change the date to March 15\"\n{\"t\":\"entity.update\",\"ref\":\"event_details\",\"p\":{\"date\":\"2026-03-15\"}}\n\nUser: \"Mike's out, Dave's subbing in\"\n{\"t\":\"entity.update\",\"ref\":\"player_mike\",\"p\":{\"status\":\"out\"}}\n{\"t\":\"entity.update\",\"ref\":\"player_dave\",\"p\":{\"status\":\"active\"}}\n{\"t\":\"voice\",\"text\":\"Mike out. Dave subbing.\"}\n\nUser: \"add bread to the list\"\n{\"t\":\"entity.create\",\"id\":\"item_bread\",\"parent\":\"grocery_list\",\"display\":\"row\",\"p\":{\"name\":\"Bread\",\"done\":false}}\n\nUser: \"remove the appetizers section\"\n(This is structural \u2014 escalate)\n{\"t\":\"escalate\",\"tier\":\"L3\",\"reason\":\"structural_change\",\"extract\":\"remove the appetizers section\"}\n\nUser: \"who hasn't RSVPed?\"\n{\"t\":\"escalate\",\"tier\":\"L4\",\"reason\":\"query\",\"extract\":\"who hasn't RSVPed?\"}\n\nUser: \"add a budget tracking section\"\n(New section \u2014 escalate)\n{\"t\":\"escalate\",\"tier\":\"L3\",\"reason\":\"structural_change\",\"extract\":\"add a budget tracking section\"}\n\n\n## Current Snapshot\n```json\n{\n  \"meta\": {\n    \"title\": \"Sophie's Graduation\",\n    \"identity\": \"Graduation planning for Sophie in May.\"\n  },\n  \"entities\": {\n    \"page\": {\n      \"id\": \"page\",\n      \"parent\": \"root\",\n      \"display\": \"page\",\n      \"props\": {\n        \"title\": \"Sophie's Graduation\"\n      }\n    },\n    \"event_details\": {\n      \"id\": \"event_details\",\n      \"parent\": \"page\",\n      \"display\": \"card\",\n      \"props\": {\n        \"date\": \"May 22, 2025\",\n        \"honoree\": \"Sophie\",\n        \"event_type\": \"Graduation celebration\",\n        \"location\": \"UC Davis\",\n        \"time\": \"10:00 AM\"\n      }\n    },\n    \"todo\": {\n      \"id\": \"todo\",\n      \"parent\": \"page\",\n      \"display\": \"checklist\",\n      \"props\": {\n        \"title\": \"Planning Tasks\"\n      }\n    },\n    \"task_venue\": {\n      \"id\": \"task_venue\",\n      \"parent\": \"todo\",\n      \"display\": \"row\",\n      \"props\": {\n        \"task\": \"Book park pavilion\",\n        \"done\": true\n      }\n    },\n    \"task_invites\": {\n      \"id\": \"task_invites\",\n      \"parent\": \"todo\",\n      \"display\": \"row\",\n      \"props\": {\n        \"task\": \"Send invitations\",\n        \"done\": false\n      }\n    },\n    \"task_catering\": {\n      \"id\": \"task_catering\",\n      \"parent\": \"todo\",\n      \"display\": \"row\",\n      \"props\": {\n        \"task\": \"Order cake\",\n        \"done\": false\n      }\n    },\n    \"task_decorations\": {\n      \"id\": \"task_decorations\",\n      \"parent\": \"todo\",\n      \"display\": \"row\",\n      \"props\": {\n        \"task\": \"Get decorations\",\n        \"done\": false\n      }\n    },\n    \"task_photographer\": {\n      \"id\": \"task_photographer\",\n      \"parent\": \"todo\",\n      \"display\": \"row\",\n      \"props\": {\n        \"task\": \"Book photographer\",\n        \"done\": false\n      }\n    },\n    \"guests\": {\n      \"id\": \"guests\",\n      \"parent\": \"page\",\n      \"display\": \"section\",\n      \"props\": {\n        \"title\": \"Guests\"\n      }\n    },\n    \"guest_linda\": {\n      \"id\": \"guest_linda\",\n      \"parent\": \"guests\",\n      \"display\": \"row\",\n      \"props\": {\n        \"name\": \"Aunt Linda\",\n        \"status\": \"confirmed\"\n      }\n    },\n    \"guest_bob\": {\n      \"id\": \"guest_bob\",\n      \"parent\": \"guests\",\n      \"display\": \"row\",\n      \"props\": {\n        \"name\": \"Uncle Bob\",\n        \"status\": \"confirmed\"\n      }\n    },\n    \"guest_james\": {\n      \"id\": \"guest_james\",\n      \"parent\": \"guests\",\n      \"display\": \"row\",\n      \"props\": {\n        \"name\": \"Cousin James\",\n        \"status\": \"maybe\"\n      }\n    },\n    \"guest_maria\": {\n      \"id\": \"guest_maria\",\n      \"parent\": \"guests\",\n      \"display\": \"row\",\n      \"props\": {\n        \"name\": \"Maria Garcia\",\n        \"status\": \"likely\"\n      }\n    },\n    \"guest_carlos\": {\n      \"id\": \"guest_carlos\",\n      \"parent\": \"guests\",\n      \"display\": \"row\",\n      \"props\": {\n        \"name\": \"Carlos Garcia\",\n        \"status\": \"likely\"\n      }\n    },\n    \"guest_dave\": {\n      \"id\": \"guest_dave\",\n      \"parent\": \"guests\",\n      \"display\": \"row\",\n      \"props\": {\n        \"name\": \"Dave\",\n        \"status\": \"likely\"\n      }\n    },\n    \"food\": {\n      \"id\": \"food\",\n      \"parent\": \"page\",\n      \"display\": \"table\",\n      \"props\": {}\n    },\n    \"food_potato_salad\": {\n      \"id\": \"food_potato_salad\",\n      \"parent\": \"food\",\n      \"display\": \"row\",\n      \"props\": {\n        \"item\": \"Potato salad\",\n        \"contributor\": \"Aunt Linda\",\n        \"status\": \"confirmed\"\n      }\n    },\n    \"food_main_1\": {\n      \"id\": \"food_main_1\",\n      \"parent\": \"food\",\n      \"display\": \"row\",\n      \"props\": {\n        \"item\": \"Carne asada\",\n        \"contributor\": \"Carlos Garcia\",\n        \"status\": \"confirmed\"\n      }\n    },\n    \"food_dessert\": {\n      \"id\": \"food_dessert\",\n      \"parent\": \"food\",\n      \"display\": \"row\",\n      \"props\": {\n        \"item\": \"Dessert\",\n        \"contributor\": \"TBD\",\n        \"status\": \"needed\"\n      }\n    },\n    \"food_drinks\": {\n      \"id\": \"food_drinks\",\n      \"parent\": \"food\",\n      \"display\": \"row\",\n      \"props\": {\n        \"item\": \"Drinks\",\n        \"contributor\": \"Uncle Bob\",\n        \"status\": \"confirmed\"\n      }\n    },\n    \"food_fruit_platter\": {\n      \"id\": \"food_fruit_platter\",\n      \"parent\": \"food\",\n      \"display\": \"row\",\n      \"props\": {\n        \"item\": \"Fruit platter\",\n        \"contributor\": \"Maria Garcia\",\n        \"status\": \"confirmed\"\n      }\n    },\n    \"task_parking\": {\n      \"id\": \"task_parking\",\n      \"parent\": \"todo\",\n      \"display\": \"row\",\n      \"props\": {\n        \"task\": \"Figure out parking\",\n        \"done\": false\n      }\n    }\n  }\n}\n```",
          "snapshot_before": {
            "meta": {
              "title": "Sophie's Graduation",
              "identity": "Graduation planning for Sophie in May."
            },
            "entities": {
              "page": {
                "id": "page",
                "parent": "root",
                "display": "page",
                "props": {
                  "title": "Sophie's Graduation"
                }
              },
              "event_details": {
                "id": "event_details",
                "parent": "page",
                "display": "card",
                "props": {
                  "date": "May 22, 2025",
                  "honoree": "Sophie",
                  "event_type": "Graduation celebration",
                  "location": "UC Davis",
                  "time": "10:00 AM"
                }
              },
              "todo": {
                "id": "todo",
                "parent": "page",
                "display": "checklist",
                "props": {
                  "title": "Planning Tasks"
                }
              },
              "task_venue": {
                "id": "task_venue",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Book park pavilion",
                  "done": true
                }
              },
              "task_invites": {
                "id": "task_invites",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Send invitations",
                  "done": false
                }
              },
              "task_catering": {
                "id": "task_catering",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Order cake",
                  "done": false
                }
              },
              "task_decorations": {
                "id": "task_decorations",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Get decorations",
                  "done": false
                }
              },
              "task_photographer": {
                "id": "task_photographer",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Book photographer",
                  "done": false
                }
              },
              "guests": {
                "id": "guests",
                "parent": "page",
                "display": "section",
                "props": {
                  "title": "Guests"
                }
              },
              "guest_linda": {
                "id": "guest_linda",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Aunt Linda",
                  "status": "confirmed"
                }
              },
              "guest_bob": {
                "id": "guest_bob",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Uncle Bob",
                  "status": "confirmed"
                }
              },
              "guest_james": {
                "id": "guest_james",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Cousin James",
                  "status": "maybe"
                }
              },
              "guest_maria": {
                "id": "guest_maria",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Maria Garcia",
                  "status": "likely"
                }
              },
              "guest_carlos": {
                "id": "guest_carlos",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Carlos Garcia",
                  "status": "likely"
                }
              },
              "guest_dave": {
                "id": "guest_dave",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Dave",
                  "status": "likely"
                }
              },
              "food": {
                "id": "food",
                "parent": "page",
                "display": "table",
                "props": {}
              },
              "food_potato_salad": {
                "id": "food_potato_salad",
                "parent": "food",
                "display": "row",
                "props": {
                  "item": "Potato salad",
                  "contributor": "Aunt Linda",
                  "status": "confirmed"
                }
              },
              "food_main_1": {
                "id": "food_main_1",
                "parent": "food",
                "display": "row",
                "props": {
                  "item": "Carne asada",
                  "contributor": "Carlos Garcia",
                  "status": "confirmed"
                }
              },
              "food_dessert": {
                "id": "food_dessert",
                "parent": "food",
                "display": "row",
                "props": {
                  "item": "Dessert",
                  "contributor": "TBD",
                  "status": "needed"
                }
              },
              "food_drinks": {
                "id": "food_drinks",
                "parent": "food",
                "display": "row",
                "props": {
                  "item": "Drinks",
                  "contributor": "Uncle Bob",
                  "status": "confirmed"
                }
              },
              "food_fruit_platter": {
                "id": "food_fruit_platter",
                "parent": "food",
                "display": "row",
                "props": {
                  "item": "Fruit platter",
                  "contributor": "Maria Garcia",
                  "status": "confirmed"
                }
              },
              "task_parking": {
                "id": "task_parking",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Figure out parking",
                  "done": false
                }
              }
            }
          },
          "snapshot_after": {
            "meta": {
              "title": "Sophie's Graduation",
              "identity": "Graduation planning for Sophie in May."
            },
            "entities": {
              "page": {
                "id": "page",
                "parent": "root",
                "display": "page",
                "props": {
                  "title": "Sophie's Graduation"
                }
              },
              "event_details": {
                "id": "event_details",
                "parent": "page",
                "display": "card",
                "props": {
                  "date": "May 22, 2025",
                  "honoree": "Sophie",
                  "event_type": "Graduation celebration",
                  "location": "UC Davis",
                  "time": "10:00 AM"
                }
              },
              "todo": {
                "id": "todo",
                "parent": "page",
                "display": "checklist",
                "props": {
                  "title": "Planning Tasks"
                }
              },
              "task_venue": {
                "id": "task_venue",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Book park pavilion",
                  "done": true
                }
              },
              "task_invites": {
                "id": "task_invites",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Send invitations",
                  "done": false
                }
              },
              "task_catering": {
                "id": "task_catering",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Order cake",
                  "done": false
                }
              },
              "task_decorations": {
                "id": "task_decorations",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Get decorations",
                  "done": false
                }
              },
              "task_photographer": {
                "id": "task_photographer",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Book photographer",
                  "done": false
                }
              },
              "guests": {
                "id": "guests",
                "parent": "page",
                "display": "section",
                "props": {
                  "title": "Guests"
                }
              },
              "guest_linda": {
                "id": "guest_linda",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Aunt Linda",
                  "status": "confirmed"
                }
              },
              "guest_bob": {
                "id": "guest_bob",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Uncle Bob",
                  "status": "confirmed"
                }
              },
              "guest_james": {
                "id": "guest_james",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Cousin James",
                  "status": "confirmed",
                  "notes": "Flying in from Chicago"
                }
              },
              "guest_maria": {
                "id": "guest_maria",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Maria Garcia",
                  "status": "likely"
                }
              },
              "guest_carlos": {
                "id": "guest_carlos",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Carlos Garcia",
                  "status": "likely"
                }
              },
              "guest_dave": {
                "id": "guest_dave",
                "parent": "guests",
                "display": "row",
                "props": {
                  "name": "Dave",
                  "status": "declined"
                }
              },
              "food": {
                "id": "food",
                "parent": "page",
                "display": "table",
                "props": {}
              },
              "food_potato_salad": {
                "id": "food_potato_salad",
                "parent": "food",
                "display": "row",
                "props": {
                  "item": "Potato salad",
                  "contributor": "Aunt Linda",
                  "status": "confirmed"
                }
              },
              "food_main_1": {
                "id": "food_main_1",
                "parent": "food",
                "display": "row",
                "props": {
                  "item": "Carne asada",
                  "contributor": "Carlos Garcia",
                  "status": "confirmed"
                }
              },
              "food_dessert": {
                "id": "food_dessert",
                "parent": "food",
                "display": "row",
                "props": {
                  "item": "Dessert",
                  "contributor": "TBD",
                  "status": "needed"
                }
              },
              "food_drinks": {
                "id": "food_drinks",
                "parent": "food",
                "display": "row",
                "props": {
                  "item": "Drinks",
                  "contributor": "Uncle Bob",
                  "status": "confirmed"
                }
              },
              "food_fruit_platter": {
                "id": "food_fruit_platter",
                "parent": "food",
                "display": "row",
                "props": {
                  "item": "Fruit platter",
                  "contributor": "Maria Garcia",
                  "status": "confirmed"
                }
              },
              "task_parking": {
                "id": "task_parking",
                "parent": "todo",
                "display": "row",
                "props": {
                  "task": "Figure out parking",
                  "done": false
                }
              }
            }
          },
          "entity_count": 22,
          "entity_delta": 0
        }
      ]
    }
  ],
  "overall_average": 0.9002949735449736
}